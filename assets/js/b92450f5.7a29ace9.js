"use strict";(self.webpackChunkquestdb_io=self.webpackChunkquestdb_io||[]).push([[721],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return g}});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(a),g=o,h=d["".concat(s,".").concat(g)]||d[g]||p[g]||r;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function g(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},82741:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var n=a(83117),o=a(80102),r=(a(67294),a(3905)),i=a(72525),l=["components"],s={title:"Exploring cryptocurrency prices with QuestDB and Google Data Studio",author:"Yitaek Hwang",author_title:"Guest",author_url:"https://github.com/Yitaek",author_image_url:"https://avatars.githubusercontent.com/Yitaek",description:"Visualizing historical prices of Ethereum, Cardano, and Solana by ingesting data into QuestDB and graphing price trends on Google Data Studio. records on the fly.",keywords:["timeseries","crypto","ethereum","solana","kaggle","googlecloud","marketdata"],tags:["tutorial","crypto","googlecloud","market data","autopilot"],image:"/img/blog/shared/og-solana-eth.png"},u={permalink:"/blog/2022/02/10/questdb-google-data-studio",source:"@site/blog/2022-02-10-questdb-google-data-studio.mdx",title:"Exploring cryptocurrency prices with QuestDB and Google Data Studio",description:"Visualizing historical prices of Ethereum, Cardano, and Solana by ingesting data into QuestDB and graphing price trends on Google Data Studio. records on the fly.",date:"2022-02-10T00:00:00.000Z",formattedDate:"February 10, 2022",tags:[{label:"tutorial",permalink:"/blog/tags/tutorial"},{label:"crypto",permalink:"/blog/tags/crypto"},{label:"googlecloud",permalink:"/blog/tags/googlecloud"},{label:"market data",permalink:"/blog/tags/market-data"},{label:"autopilot",permalink:"/blog/tags/autopilot"}],readingTime:4.635,truncated:!1,prevItem:{title:"Calling on our community members to help us support Ukraine",permalink:"/blog/2022/03/07/calling-on-our-community-members"},nextItem:{title:"Order Flow Imbalance - A High Frequency Trading Signal",permalink:"/blog/2022/02/02/order-flow-imbalance"}},c=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Building a dataset of cryptocurrency prices",id:"building-a-dataset-of-cryptocurrency-prices",children:[]},{value:"Google Data Studio setup",id:"google-data-studio-setup",children:[]},{value:"Running QuestDB on GKE using Helm",id:"running-questdb-on-gke-using-helm",children:[]},{value:"Working with Google Data Studio",id:"working-with-google-data-studio",children:[]},{value:"Next steps",id:"next-steps",children:[]}],p={toc:c};function d(e){var t=e.components,a=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(i.Z,{alt:"A series of logos of popular cryptocurrencies",height:385,src:"/img/blog/2022-02-10/banner.png",width:850,mdxType:"Screenshot"}),(0,r.kt)("p",null,"Various crypto market research websites such as\n",(0,r.kt)("a",{parentName:"p",href:"https://glassnode.com/"},"Glassnode"),", ",(0,r.kt)("a",{parentName:"p",href:"https://messari.io/"},"Messari"),", and\n",(0,r.kt)("a",{parentName:"p",href:"https://www.tradingview.com/"},"TradingView")," provide free and easy ways to\nanalyze market trends. However, not all the advanced charting functions are\navailable for free, with some of the best features locked behind a paywall. If\nyou want to explore these datasets using open-source and free alternatives, you\ncan quickly get started in less than 5 minutes of setup."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://console.cloud.google.com"},"Google Cloud")," account"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/sdk/docs/install"},"gcloud sdk")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm 3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.kaggle.com/"},"Kaggle")," account"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Optional:")," ",(0,r.kt)("a",{parentName:"li",href:"https://developers.coinbase.com/"},"Coinbase API")," access")),(0,r.kt)("h2",{id:"building-a-dataset-of-cryptocurrency-prices"},"Building a dataset of cryptocurrency prices"),(0,r.kt)("p",null,"In this tutorial, we will use the precompiled dataset of cryptocurrency prices\nfrom Kaggle, but if you would like to build your own dataset, see our\n",(0,r.kt)("a",{parentName:"p",href:"/blog/2021/02/18/realtime-crypto-tracker-with-kafka-and-questdb"},"Realtime crypto tracker"),"\ntutorial that uses Kafka and QuestDB."),(0,r.kt)("p",null,"The\n",(0,r.kt)("a",{parentName:"p",href:"https://www.kaggle.com/sudalairajkumar/cryptocurrencypricehistory"},"Cryptocurrency Historical Prices"),"\ndataset on Kaggle provides a compiled list of cryptocurrency prices pulled from\n",(0,r.kt)("a",{parentName:"p",href:"https://coinmarketcap.com/"},"CoinMarketCap"),". Log in or create a free Kaggle\naccount to download the various .CSV files of coin prices over time. Since the\noverarching narrative in 2021 was the emergence of layer 1 protocols, I will\nlook at Ethereum, Cardano, and Solana datasets."),(0,r.kt)("h2",{id:"google-data-studio-setup"},"Google Data Studio setup"),(0,r.kt)("p",null,"Although Google Data Studio can connect to any publicly-accessible PostgreSQL\nendpoint, I\u2019ll be using Google Cloud since I\u2019ve written about running\n",(0,r.kt)("a",{parentName:"p",href:"/blog/2021/03/18/questdb-and-prometheus-on-gke-autopilot"},"QuestDB on GKE Autopilot"),"\nbefore. In your Google Cloud account:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Navigate to\n",(0,r.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/kubernetes"},"Google Kubernetes Engine")),(0,r.kt)("li",{parentName:"ul"},"Enable the Kubernetes Engine API"),(0,r.kt)("li",{parentName:"ul"},"Click on ",(0,r.kt)("strong",{parentName:"li"},"Create Cluster")," (you\u2019ll need to have a billing account added)")),(0,r.kt)("p",null,"For this demo, I decided to use the ",(0,r.kt)("strong",{parentName:"p"},"Standard mode")," with one node in\n",(0,r.kt)("inlineCode",{parentName:"p"},"us-east1-c")," region with other default settings accepted:"),(0,r.kt)(i.Z,{alt:"Creating a QuestDB cluster using GKE on Google Cloud",height:385,src:"/img/blog/2022-02-10/create_cluster.png",width:650,mdxType:"Screenshot"}),(0,r.kt)("p",null,"Once the cluster is created, fetch the cluster credentials via the ",(0,r.kt)("inlineCode",{parentName:"p"},"gcloud")," CLI\nto authenticate:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ gcloud container clusters \\\n  get-credentials cluster-1 --zone us-east1-c --project <project-id>\n")),(0,r.kt)("h2",{id:"running-questdb-on-gke-using-helm"},"Running QuestDB on GKE using Helm"),(0,r.kt)("p",null,"QuestDB provides an ",(0,r.kt)("a",{parentName:"p",href:"/docs/deployment/kubernetes"},"official Helm chart")," that deploys\na single ",(0,r.kt)("inlineCode",{parentName:"p"},"StatefulSet")," pod with 50Gi PVC by default. To make the PostgreSQL wire\nendpoint accessible by Google Data Studio, we need to modify the service type\nand set the expose field to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),". Create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml")," file with the\nfollowing contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="values.yaml"',title:'"values.yaml"'},"service:\n  type: LoadBalancer\n  expose:\n    postgresql:\n    enabled: true\n")),(0,r.kt)("p",null,"Then deploy to our GKE cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm repo add questdb https://helm.questdb.io/\n$ helm upgrade -i questdb questdb/questdb -f values.yaml\n")),(0,r.kt)("p",null,"Wait for the pod to become healthy and provision a load balancer:"),(0,r.kt)(i.Z,{alt:"Viewing the state of a QuestDB cluster on Google Cloud Platform",height:385,src:"/img/blog/2022-02-10/load_balancer.png",width:650,mdxType:"Screenshot"}),(0,r.kt)("p",null,"Under Kubernetes Engine > Services & Ingress, check the IP address of the\nQuestDB service. There is a link which you can follow to port ",(0,r.kt)("inlineCode",{parentName:"p"},"9000")," which will\nbring you to the web UI for QuestDB. To insert data, click the ",(0,r.kt)("strong",{parentName:"p"},"Upload")," icon\non the left-hand panel and import the CSV data:"),(0,r.kt)(i.Z,{alt:"Importing cryptocurrency data via CSV upload in QuestDB's web UI",height:385,src:"/img/blog/2022-02-10/import_csv.png",width:1e3,mdxType:"Screenshot"}),(0,r.kt)("h2",{id:"working-with-google-data-studio"},"Working with Google Data Studio"),(0,r.kt)("p",null,"Navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://datastudio.google.com"},"Google Data Studio dashboard"),"\nand click on ",(0,r.kt)("strong",{parentName:"p"},"Create > Report"),". This will automatically bring up an ",(0,r.kt)("strong",{parentName:"p"},"Add data\nto report")," tab where we can select PostgreSQL. This tab is where you will need\nto fill out the IP address of the external load balancer provisioned by GKE as\nwell as the default port and credentials:"),(0,r.kt)(i.Z,{alt:"Authenticating with QuestDB via Google Data Studio",height:385,src:"/img/blog/2022-02-10/db_auth.png",width:300,mdxType:"Screenshot"}),(0,r.kt)("p",null,"Google will treat ",(0,r.kt)("strong",{parentName:"p"},"each table")," as a data source, so you\u2019ll have to import each\ntable separately. By default, Data Studio will create a default table with\n",(0,r.kt)("inlineCode",{parentName:"p"},"Symbol")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Record")," Count:"),(0,r.kt)(i.Z,{alt:"Mapping table schema in Google Data Studio",height:385,src:"/img/blog/2022-02-10/schema.png",width:400,mdxType:"Screenshot"}),(0,r.kt)("p",null,"You can modify the Dimension to add the other fields such as ",(0,r.kt)("inlineCode",{parentName:"p"},"Marketcap"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"High"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Low"),", etc:"),(0,r.kt)(i.Z,{alt:"A QuestDB table with multiple columns in Google Data Studio",height:385,src:"/img/blog/2022-02-10/dimensions.png",width:600,mdxType:"Screenshot"}),(0,r.kt)("p",null,"The default Date format Google Data Studio uses is not compatible with QuestDB\nas it uses the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/questdb/questdb/issues/1818"},"PostgreSQL DATE_TRUNC")," function\nthat is not yet supported. Click on ",(0,r.kt)("strong",{parentName:"p"},"Resource > Manage added data sources")," and\nchange the Date format to ",(0,r.kt)("inlineCode",{parentName:"p"},"ISO Year Week"),". This way, it's possible to create a\ncoarse timeseries chart of Marketcap over time:"),(0,r.kt)(i.Z,{alt:"A timeseries chart showing cryptocurrency market cap over time",height:385,src:"/img/blog/2022-02-10/marketcap.png",width:600,mdxType:"Screenshot"}),(0,r.kt)("p",null,"You can also add multiple dimensions to check how the market opened, what the\nhighest price of the day was as opposed to the lowest price:"),(0,r.kt)(i.Z,{alt:"A timeseries chart showing multiple cryptocurrency market caps over time",height:385,src:"/img/blog/2022-02-10/multiple_dimensions.png",width:600,mdxType:"Screenshot"}),(0,r.kt)("p",null,"The graphing capabilities are not especially advanced with Data Studio, so\nsupport for candlesticks and other common financial charts are not available,\nbut you can import multiple data sources to compare the price of Cardano vs.\nSolana over similar time period:"),(0,r.kt)(i.Z,{alt:"A timeseries chart showing Cardano versus Solana market caps over time",height:385,src:"/img/blog/2022-02-10/cardano_solana.png",width:600,mdxType:"Screenshot"}),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)("p",null,"Right now QuestDB does not natively support SSL connections. To enable SSL, we\ncan use PgBouncer to secure Google Data Studio to\n",(0,r.kt)("a",{parentName:"p",href:"https://www.pgbouncer.org/"},"PgBouncer")," and leverage a service mesh inside\nKubernetes to secure PgBouncer to QuestDB. You can also put QuestDB behind a\nfirewall and only whitelist the\n",(0,r.kt)("a",{parentName:"p",href:"https://support.google.com/datastudio/answer/7288010?hl=en#zippy=%2Cin-this-article"},"IPs that Data Studio uses"),"\nto access the database."),(0,r.kt)("p",null,"Google Data Studio might be lacking for serious data analysis needs beyond\nsimple visualizations and auto-aggregations. When we're making more complicated\nanalyses, we will connect QuestDB directly to a Jupyter Notebook to explore our\ndata in more detail using Pandas."))}d.isMDXComponent=!0},86010:function(e,t,a){function n(e){var t,a,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(o&&(o+=" "),o+=a);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function o(){for(var e,t,a=0,o="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(o&&(o+=" "),o+=t);return o}a.d(t,{Z:function(){return o}})}}]);