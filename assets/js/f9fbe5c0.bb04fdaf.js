"use strict";(self.webpackChunkquestdb_io=self.webpackChunkquestdb_io||[]).push([[9050],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=u(n),d=i,g=h["".concat(l,".").concat(d)]||h[d]||p[d]||a;return n?o.createElement(g,r(r({ref:t},c),{},{components:n})):o.createElement(g,r({ref:t},c))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},85703:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return h}});var o=n(83117),i=n(80102),a=(n(67294),n(3905)),r=n(46092),s=["components"],l={title:"Setting up Basic Authentication for QuestDB open source using Nginx",author:"Kovid Rathee",author_title:"Guest post",author_url:"https://kovidrathee.medium.com/",author_image_url:"https://miro.medium.com/fit/c/96/96/0*_CwYR2OmNap47tQO.jpg",description:"How to implement Nginx Basic Authentication for QuestDB open source.",keywords:["nginx","security","authentication","proxy","timeseries"],image:"/img/blog/2022-08-05/banner.png",tags:["tutorial","nginx","security","authentication","proxy"]},u={permalink:"/blog/2022/08/05/setting-basic-auth-nginx",source:"@site/blog/2022-08-05-setting-basic-auth-nginx.md",title:"Setting up Basic Authentication for QuestDB open source using Nginx",description:"How to implement Nginx Basic Authentication for QuestDB open source.",date:"2022-08-05T00:00:00.000Z",formattedDate:"August 5, 2022",tags:[{label:"tutorial",permalink:"/blog/tags/tutorial"},{label:"nginx",permalink:"/blog/tags/nginx"},{label:"security",permalink:"/blog/tags/security"},{label:"authentication",permalink:"/blog/tags/authentication"},{label:"proxy",permalink:"/blog/tags/proxy"}],readingTime:6.82,truncated:!0,prevItem:{title:"QuestDB 6.5 Release - CSV import",permalink:"/blog/2022/08/08/questdb-release-6.5"},nextItem:{title:"Time Series Forecasting with TensorFlow and QuestDB",permalink:"/blog/2022/06/20/forecasting-with-questdb-and-tensorflow"}},c=[{value:"Introduction",id:"introduction",children:[]},{value:"How Basic Authentication Works in Nginx",id:"how-basic-authentication-works-in-nginx",children:[]},{value:"Steps for Setting up Basic Authentication for QuestDB open source using Nginx",id:"steps-for-setting-up-basic-authentication-for-questdb-open-source-using-nginx",children:[{value:"Step 1. Install QuestDB open source",id:"step-1-install-questdb-open-source",children:[]},{value:"Step 2. Install Nginx",id:"step-2-install-nginx",children:[]},{value:"Step 3. Configure Nginx to require Basic Authentication for QuestDB open source",id:"step-3-configure-nginx-to-require-basic-authentication-for-questdb-open-source",children:[]},{value:"Step 4. Verify if Basic Authentication is working while accessing QuestDB open source",id:"step-4-verify-if-basic-authentication-is-working-while-accessing-questdb-open-source",children:[]}]},{value:"Conclusion",id:"conclusion",children:[]}],p={toc:c};function h(e){var t=e.components,l=(0,i.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)(r.Z,{alt:"QuestDB log and nginx logo",height:467,src:"/img/blog/2022-08-05/banner.png",width:650,mdxType:"Banner"}),(0,a.kt)("p",null,"This post comes from\n",(0,a.kt)("a",{parentName:"p",href:"https://towardsdatascience.com/questdb-vs-timescaledb-38160a361c0e?sk=42d1c037a6dfc3786e11eb9d9f5af2ad"},"Kovid Rathee"),",\nwho has put together a tutorial to show how to add extra security by implementing Nginx Basic Authentication for QuestDB open source."),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Data privacy and security is one of the most critical areas of concern when working with any data. This is even more true for time-series databases because a lot of time-series data deals with highly essential financial, geospatial, and medical data, among many others."),(0,a.kt)("p",null,"While QuestDB open source has already ",(0,a.kt)("a",{parentName:"p",href:"https://questdb.io/docs/reference/api/ilp/authenticate/"},"added authentication on top of the InfluxDB line protocol")," to secure your time-series data ingestion workloads into QuestDB, you might need more layers of security, mainly to prevent unauthorized access to your critical data from your QuestDB web console."),(0,a.kt)("p",null,"There are several ways to achieve this, such as ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Tunneling_protocol"},"SSH tunneling"),", ",(0,a.kt)("a",{parentName:"p",href:"https://oauth.net/"},"OAuth"),", ",(0,a.kt)("a",{parentName:"p",href:"https://www.okta.com/au/identity-101/what-is-token-based-authentication/"},"token-based auth"),", etc. However, this article will take you through the most straightforward authentication setup of them so that you can get started with basic authentication with minimal effort using Nginx."),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"While you can set up authentication for QuestDB open source, ",(0,a.kt)("a",{parentName:"p",href:"/cloud"},"QuestDB Cloud")," offers built-in authentication that offers a hassle-free, Out-of-the-Box solution."))),(0,a.kt)("h2",{id:"how-basic-authentication-works-in-nginx"},"How Basic Authentication Works in Nginx"),(0,a.kt)("p",null,"Nginx is a multi-purpose application that can be used as a ",(0,a.kt)("a",{parentName:"p",href:"https://microsoft.github.io/reverse-proxy/articles/authn-authz.html"},"reverse proxy"),", a load balancer, or an HTTP cache. This means if you direct all your incoming traffic for QuestDB to Nginx, it can decide what action to take on that request."),(0,a.kt)("p",null,"Nginx Basic Authentication is a way to implement a fundamental authentication mechanism. In case of a successful login request, you\u2019ll be redirected from the default HTTP port to the port on which your QuestDB server is running."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Note: On top of the Basic Authentication, you should also ",(0,a.kt)("a",{parentName:"p",href:"https://docs.nginx.com/nginx/admin-guide/security-controls/securing-http-traffic-upstream/"},"configure SSL/HTTPS")," on top for additional security. You can download free SSL/TLS certificates from ",(0,a.kt)("a",{parentName:"p",href:"https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/"},"LetsEncrypt"),".")),(0,a.kt)("h2",{id:"steps-for-setting-up-basic-authentication-for-questdb-open-source-using-nginx"},"Steps for Setting up Basic Authentication for QuestDB open source using Nginx"),(0,a.kt)("h3",{id:"step-1-install-questdb-open-source"},"Step 1. Install QuestDB open source"),(0,a.kt)("p",null,"You can ",(0,a.kt)("a",{parentName:"p",href:"https://questdb.io/get-questdb/"},"install QuestDB open source")," on your local instance or a production system in several ways. Your installation method doesn\u2019t impact your basic authentication setup using Nginx. You'll be good to go if you have QuestDB up and running. In this tutorial, we\u2019ll install QuestDB using ",(0,a.kt)("a",{parentName:"p",href:"https://brew.sh/"},"Homebrew"),", using the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"brew install questdb\n")),(0,a.kt)("p",null,"Once the installation is complete, QuestDB automatically starts and is available on ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:9000"},"http://localhost:9000"),". To ensure that the installation has gone right, please visit this address and see if you can access the QuestDB console."),(0,a.kt)("h3",{id:"step-2-install-nginx"},"Step 2. Install Nginx"),(0,a.kt)("p",null,"To set up Basic Authentication using Nginx, you need to install Nginx on your system. Using Homebrew, you can do that by simply running the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"brew install nginx\n")),(0,a.kt)("p",null,"After the installation, please ensure that Nginx is up and running by visiting ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080"),"."),(0,a.kt)("h3",{id:"step-3-configure-nginx-to-require-basic-authentication-for-questdb-open-source"},"Step 3. Configure Nginx to require Basic Authentication for QuestDB open source"),(0,a.kt)("h4",{id:"step-3a-create-a-username-and-password"},"Step 3a. Create a Username and Password"),(0,a.kt)("p",null,"When you configure Nginx to force authentication, you\u2019ll need a username and password combination to log into QuestDB. The first step is to create that username and password combination using the following ",(0,a.kt)("inlineCode",{parentName:"p"},"htpasswd")," command."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"sudo htpasswd -c /usr/local/etc/nginx.htpasswd questdb  \n")),(0,a.kt)("p",null,"The home directory, i.e., in this case, ",(0,a.kt)("inlineCode",{parentName:"p"},"/usr/local/etc/,")," might be something else for another platform like CentOS, Ubuntu, etc. It\u2019s best just to run the following command to test your configuration file and find out what the installation path is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nginx -t\n")),(0,a.kt)("p",null,"This command will give you an output will all the different paths that Nginx is using:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-log"},"nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /usr/local/etc/nginx/nginx.conf test is successful\n")),(0,a.kt)("p",null,"Once you're done with this basic check, you can start with the configuration."),(0,a.kt)("h4",{id:"step-3b-modify-nginxconf-to-require-basic-authentication--redirect"},"Step 3b. Modify ",(0,a.kt)("inlineCode",{parentName:"h4"},"nginx.conf")," to Require Basic Authentication & Redirect"),(0,a.kt)("p",null,"To implement Basic Authentication properly, you must understand what Nginx does. To add a layer of security, all your requests on a certain port (in this case, port 80) will go to Nginx first. They will then be redirected to port 9000, where you have a QuestDB instance running."),(0,a.kt)("p",null,"The redirection will be contingent upon whether you can provide Nginx with the correct username and password combination you had created earlier."),(0,a.kt)("p",null,"Take the default ",(0,a.kt)("inlineCode",{parentName:"p"},"nginx.conf")," file and remove all the comments. Firstly, in the ",(0,a.kt)("inlineCode",{parentName:"p"},"server")," section, change the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"listen")," from 8080 to 80 if you want to redirect to QuestDB whenever someone types ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost")," (as 80 is the default HTTP port). Secondly, replace the ",(0,a.kt)("inlineCode",{parentName:"p"},"location")," section with the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-conf"},'location / {\n            proxy_pass  http://localhost:9000;\n            index  index.html index.htm;\n            auth_basic "Restricted Content";      \n            auth_basic_user_file /usr/local/etc/nginx/.htpasswd;\n        }\n')),(0,a.kt)("p",null,"You'll probably be dealing with a lot of data in the web console, and you might need to download it to your local machine. For such use cases, you can modify the default value of the ",(0,a.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_read_timeout"},(0,a.kt)("inlineCode",{parentName:"a"},"proxy_read_timeout"))," variable from 60 to 300 (or a value that makes sense for your use case). You can, similarly, set the ",(0,a.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_send_timeout"},(0,a.kt)("inlineCode",{parentName:"a"},"proxy_send_timeout"))," and ",(0,a.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_connect_timeout"},(0,a.kt)("inlineCode",{parentName:"a"},"proxy_connect_timeout")),"."),(0,a.kt)("p",null,"This is where you\u2019re telling Nginx to force authentication based on your password stored in the ",(0,a.kt)("inlineCode",{parentName:"p"},".htpasswd")," file in your Nginx home directory. The full ","`","nginx.conf","`"," file looks something like the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-conf"},'worker_processes  1;\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n    keepalive_timeout  65;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n        location / {\n            proxy_pass  http://localhost:9000;\n            proxy_read_timeout 300;\n            proxy_connect_timeout 120;\n            proxy_send_timeout 300;\n            index  index.html index.htm;\n            auth_basic "Restricted Content";      \n            auth_basic_user_file /usr/local/etc/nginx/.htpasswd;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n    }\n    include servers/*;\n}\n')),(0,a.kt)("h4",{id:"step-3c-reload-nginx-configuration"},"Step 3c. Reload Nginx Configuration"),(0,a.kt)("p",null,"Once you make the necessary changes to your Nginx configuration file mentioned in the previous step, you\u2019ll be ready to reload or restart the Nginx server for the configuration changes to take effect. "),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Ensure that you've blocked any direct access to your QuestDB web console using a software-based firewall, such as ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Iptables"},(0,a.kt)("inlineCode",{parentName:"a"},"iptables")),". If you configure your firewall to deny traffic on a certain port, Nginx will still be able to redirect you to that.")),(0,a.kt)("p",null,"Alternatively, you can set the ",(0,a.kt)("a",{parentName:"p",href:"https://questdb.io/docs/reference/configuration/#http-server"},(0,a.kt)("inlineCode",{parentName:"a"},"http.bind.to"))," variable in your QuestDB ",(0,a.kt)("inlineCode",{parentName:"p"},"server.conf")," file to ",(0,a.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," ensuring that QuestDB rejects the requests coming directly from the internet, and only allows requests that are proxied via Nginx."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You can find your ",(0,a.kt)("inlineCode",{parentName:"p"},"server.conf")," file in your Homebrew QuestDB installation directory -- ",(0,a.kt)("inlineCode",{parentName:"p"},"/usr/local/var/questdb/conf"),". This directory might differ on different OS and Homebrew versions. ")),(0,a.kt)("p",null,"You can use one of the following commands for reloading the Nginx configuration:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"brew services restart nginx  \nbrew services reload nginx  \n")),(0,a.kt)("p",null,"Here\u2019s what the output of the commands mentioned above will look like:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(48087).Z})),(0,a.kt)("h3",{id:"step-4-verify-if-basic-authentication-is-working-while-accessing-questdb-open-source"},"Step 4. Verify if Basic Authentication is working while accessing QuestDB open source"),(0,a.kt)("p",null,"After reloading the configuration file, open a new tab in your browser to test if the redirection and authentication are working correctly."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"localhost")," points to QuestDB based on the ",(0,a.kt)("inlineCode",{parentName:"p"},"nginx.conf"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(98526).Z})),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost")," binding is working correctly, you should see the following screen asking for your username and password to log into QuestDB:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(43212).Z})),(0,a.kt)("p",null,"Once you enter your username and password, Nginx will go back to ",(0,a.kt)("inlineCode",{parentName:"p"},".htpasswd")," to verify whether you\u2019ve entered the correct credentials. If the authentication succeeds, you\u2019ll be able to log onto QuestDB and carry on with your work, as shown below:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(46917).Z})),(0,a.kt)("p",null,"However, if the authentication fails, you\u2019ll see the following screen with an HTTP 401 specifying that you need the authorization to access ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(93774).Z})),(0,a.kt)("p",null,"If you end up getting an HTTP 401, recheck your username and password combination. If it is still not working, try creating another user or resetting the password for your current user using the ",(0,a.kt)("a",{parentName:"p",href:"https://httpd.apache.org/docs/2.4/programs/htpasswd.html"},(0,a.kt)("inlineCode",{parentName:"a"},"htpasswd")," command-line tool"),"."),(0,a.kt)("h2",{id:"conclusion"},"Conclusion"),(0,a.kt)("p",null,"Nginx Basic Authentication is a short-term solution to ensure that your data is safe and protected from unauthorized access. This tutorial took you through the steps required to set up authentication for QuestDB open source by simply installing Nginx and making a few changes in the configuration file."),(0,a.kt)("p",null,"Although Nginx Basic Authentication is not the recommended method for authentication and authorization, it is the quickest to set up. In the longer term, you might want to use a solution like LDAP-based solution, OAuth/OIDC, and so on."))}h.isMDXComponent=!0},86010:function(e,t,n){function o(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:function(){return i}})},48087:function(e,t,n){t.Z=n.p+"assets/images/step_3c-1ad3196f17dfe80bc6b5b3aa17704d1a.png"},98526:function(e,t,n){t.Z=n.p+"assets/images/step_4_1-7748d6cf4ce89ed4fac0c11f7b68dd53.png"},43212:function(e,t,n){t.Z=n.p+"assets/images/step_4_2-970356a5e21307065e58cf5198f7353c.png"},46917:function(e,t,n){t.Z=n.p+"assets/images/step_4_3-005ca1794a84c357985be23ff4d1255b.png"},93774:function(e,t,n){t.Z=n.p+"assets/images/step_4_4-b9eaf43faa0ba6e0d9d79bcf37cdc616.png"}}]);