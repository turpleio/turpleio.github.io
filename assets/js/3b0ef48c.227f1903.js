"use strict";(self.webpackChunkquestdb_io=self.webpackChunkquestdb_io||[]).push([[2738],{3905:function(e,t,n){n.d(t,{Zo:function(){return h},kt:function(){return d}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},h=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,h=i(e,["components","mdxType","originalType","parentName"]),c=u(n),d=o,m=c["".concat(l,".").concat(d)]||c[d]||p[d]||r;return n?a.createElement(m,s(s({ref:t},h),{},{components:n})):a.createElement(m,s({ref:t},h))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},34407:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},metadata:function(){return l},toc:function(){return u},default:function(){return p}});var a=n(83117),o=n(80102),r=(n(67294),n(3905)),s=["components"],i={title:"Demo launch on HackerNews retrospective",author:"David G Simmons",author_title:"QuestDB Team",author_url:"https://github.com/davidgs",author_image_url:"https://avatars.githubusercontent.com/davidgs",description:"What happens when you put a SQL database on the internet? Demo launch on HackerNews retrospective.",keywords:["hackernews","retrospective","sql database","timeseries database","questdb","open source"],tags:["demo","hackernews","retrospective","community"],image:"/img/blog/placeholder.png"},l={permalink:"/blog/2020/07/01/we-put-a-sql-database-on-the-internet",source:"@site/blog/2020-07-01-we-put-a-sql-database-on-the-internet.md",title:"Demo launch on HackerNews retrospective",description:"What happens when you put a SQL database on the internet? Demo launch on HackerNews retrospective.",date:"2020-07-01T00:00:00.000Z",formattedDate:"July 1, 2020",tags:[{label:"demo",permalink:"/blog/tags/demo"},{label:"hackernews",permalink:"/blog/tags/hackernews"},{label:"retrospective",permalink:"/blog/tags/retrospective"},{label:"community",permalink:"/blog/tags/community"}],readingTime:7.755,truncated:!0,prevItem:{title:"InfluxDB line protocol on QuestDB",permalink:"/blog/2020/07/22/influxdb-lp-on-tcp"},nextItem:{title:"Querying data in a Jupyter Notebook",permalink:"/blog/2020/06/15/python-questdb-tutorial"}},u=[{value:"Why we built QuestDB",id:"why-we-built-questdb",children:[]},{value:"What makes QuestDB unique?",id:"what-makes-questdb-unique",children:[]},{value:"The HackerNews post",id:"the-hackernews-post",children:[]},{value:"What happens when you let the public query your database",id:"what-happens-when-you-let-the-public-query-your-database",children:[]},{value:"What we learned from our HackerNews launch",id:"what-we-learned-from-our-hackernews-launch",children:[]},{value:"Conclusions",id:"conclusions",children:[]},{value:"Try our live demo, query 1.6 billion rows of data",id:"try-our-live-demo-query-16-billion-rows-of-data",children:[]}],h={toc:u};function p(e){var t=e.components,i=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"If you listen to, well, pretty much anyone rational, they will tell you in no\nuncertain terms that the last thing you ever want to do is put your SQL Database\non the public internet. Even if you're crazy enough to do that, you certainly\nshould never post the address to it on a place like Hacker News. We did it\nanyway, and this post describes why we did it, what we learned and what people\ntried to do with it."),(0,r.kt)("h2",{id:"why-we-built-questdb"},"Why we built QuestDB"),(0,r.kt)("p",null,"We've built the fastest open source SQL Database and we're pretty proud of it.\nWe wanted to give anyone that wanted the opportunity a chance to take it for a\nspin. With real data. Doing real queries. Almost anyone can pull together a demo\nthat performs great under just the right conditions, with all the parameters\ntightly controlled."),(0,r.kt)("p",null,"But what happens if you unleash the hordes on it? What happens if you let anyone\nrun queries against it? Well, we can tell you, now."),(0,r.kt)("h2",{id:"what-makes-questdb-unique"},"What makes QuestDB unique?"),(0,r.kt)("p",null,"First off, it's a SQL-based Time Series database, built from the ground up for\nperformance. It's built to store and query very large amounts of data very\nquickly."),(0,r.kt)("p",null,"We deployed it on an AWS ",(0,r.kt)("inlineCode",{parentName:"p"},"c5.metal")," server in the London, UK datacenter (sorry\nall you North Americans, there's some built-in latency due to the laws of\nphysics). It was configured with 196GB of RAM, but we were only using 40GB at\npeak usage. The ",(0,r.kt)("inlineCode",{parentName:"p"},"c5.metal")," instance provides 2 24-core CPUs (48 cores), but we\nonly used one of them (24 cores) on 23 threads. We really weren't using anywhere\n",(0,r.kt)("em",{parentName:"p"},"close")," to the full potential of this AWS instance. That didn't appear to matter\nat all."),(0,r.kt)("p",null,"The data is stored on an AWS EBS volume that provides SSD access to the data.\nIt's not all in memory."),(0,r.kt)("p",null,"The data is the entire\n",(0,r.kt)("a",{parentName:"p",href:"https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page"},"NYC Taxi Database"),"\nplus associated weather data. It amounts to 1.6 billion records, weighing in at\nabout 350GB of data. That's a lot. And it's too much to store in-memory. It's\ntoo much to cache."),(0,r.kt)("p",null,"We provided some clickable queries to get people started (none of the results\nwere cached or pre-calculated) but we essentially didn't restrict the kinds of\nqueries that users could run. We wanted to see, and let users see, how well this\nperformed on whatever queries they threw at it."),(0,r.kt)("p",null,"It was not disappointing!"),(0,r.kt)("h2",{id:"the-hackernews-post"},"The HackerNews post"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"A few weeks ago, we wrote about how we implemented SIMD instructions to\naggregate a billion rows in milliseconds ","[1]"," thanks in great part to Agner\nFog\u2019s VCL library ","[2]",". Although the initial scope was limited to table-wide\naggregates into a unique scalar value, this was a first step towards very\npromising results on more complex aggregations. With the latest release of\nQuestDB, we are extending this level of performance to key-based aggregations."),(0,r.kt)("p",{parentName:"blockquote"},"To do this, we implemented Google\u2019s fast hash table aka \u201cSwisstable\u201d ","[3]"," which\ncan be found in the Abseil library ","[4]",". In all modesty, we also found room to\nslightly accelerate it for our use case. Our version of Swisstable is dubbed\n\u201crosti\u201d, after the traditional Swiss dish ","[5]",". There were also a number of\nimprovements thanks to techniques suggested by the community such as prefetch\n(which interestingly turned out to have no effect in the map code itself) ","[6]",".\nBesides C++, we used our very own queue system written in Java to parallelise\nthe execution ","[7]","."),(0,r.kt)("p",{parentName:"blockquote"},"The results are remarkable: millisecond latency on keyed aggregations that\nspan over billions of rows."),(0,r.kt)("p",{parentName:"blockquote"},"We thought it could be a good occasion to show our progress by making this\nlatest release available to try online with a pre-loaded dataset. It runs on\nan AWS instance using 23 threads. The data is stored on disk and includes a\n1.6billion row NYC taxi dataset, 10 years of weather data with around\n30-minute resolution and weekly gas prices over the last decade. The instance\nis located in London, so folks outside of Europe may experience different\nnetwork latencies. The server-side time is reported as \u201cExecute\u201d."),(0,r.kt)("p",{parentName:"blockquote"},"We provide sample queries to get started, but you are encouraged to modify\nthem. However, please be aware that not every type of query is fast yet. Some\nare still running under an old single-threaded model. If you find one of\nthese, you\u2019ll know: it will take minutes instead of milliseconds. But bear\nwith us, this is just a matter of time before we make these instantaneous as\nwell. Next in our crosshairs is time-bucket aggregations using the SAMPLE BY\nclause."),(0,r.kt)("p",{parentName:"blockquote"},"If you are interested in checking out how we did this, our code is available\nopen-source ","[8]",". We look forward to receiving your feedback on our work so\nfar. Even better, we would love to hear more ideas to further improve\nperformance. Even after decades in high performance computing, we are still\nlearning something new every day."),(0,r.kt)("p",{parentName:"blockquote"},"[1]","\n",(0,r.kt)("a",{parentName:"p",href:"https://questdb.io/blog/2020/04/02/using-simd-to-aggregate-billions-of-rows-per-second"},"https://questdb.io/blog/2020/04/02/using-simd-to-aggregate-billions-of-rows-per-second")),(0,r.kt)("p",{parentName:"blockquote"},"[2]"," ",(0,r.kt)("a",{parentName:"p",href:"https://www.agner.org/optimize/vectorclass.pdf"},"https://www.agner.org/optimize/vectorclass.pdf")),(0,r.kt)("p",{parentName:"blockquote"},"[3]"," ",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=nchmeumjzf4"},"https://www.youtube.com/watch?v=nchmeumjzf4")),(0,r.kt)("p",{parentName:"blockquote"},"[4]"," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/abseil/abseil-cpp"},"https://github.com/abseil/abseil-cpp")),(0,r.kt)("p",{parentName:"blockquote"},"[5]"," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/questdb/questdb/blob/master/core/src/main"},"https://github.com/questdb/questdb/blob/master/core/src/main")),(0,r.kt)("p",{parentName:"blockquote"},"[6]"," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/questdb/questdb/blob/master/core/src/main"},"https://github.com/questdb/questdb/blob/master/core/src/main")),(0,r.kt)("p",{parentName:"blockquote"},"[7]"," ",(0,r.kt)("a",{parentName:"p",href:"https://questdb.io/blog/2021/11/03/interthread/"},"https://questdb.io/blog/2021/11/03/interthread/")),(0,r.kt)("p",{parentName:"blockquote"},"[8]"," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/questdb/questdb"},"https://github.com/questdb/questdb"))),(0,r.kt)("p",null,"And then we posted the link to the live database."),(0,r.kt)("p",null,"And sat back."),(0,r.kt)("p",null,"And watched the incoming traffic."),(0,r.kt)("p",null,"And tried not to panic."),(0,r.kt)("h2",{id:"what-happens-when-you-let-the-public-query-your-database"},"What happens when you let the public query your database"),(0,r.kt)("p",null,"First off, we made the front page of Hacker News. Then we stayed there. For\nhours."),(0,r.kt)("p",null,"We saw a lot of traffic. I mean a lot of traffic. Somewhere over 20,000 unique\nIP addresses."),(0,r.kt)("p",null,"Excluding simple show queries, we saw 17,128 SQL queries with 2,485 syntax\nerrors in the queries. We sent back almost 40GB of data in response to the\nqueries. The response times were phenomenal. Sub-second responses to nearly all\nof the queries."),(0,r.kt)("p",null,"Someone in the HN comments suggested that column stores are bad at joins, which\nled to someone coming in and trying to join the table to itself. Ordinarily,\nthis would be a stunningly bad decision."),(0,r.kt)("p",null,"The result was ... not what they were expecting:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"query results showing unholy number of results",src:n(30318).Z})),(0,r.kt)("p",null,"Yeah, that's 2,671,914,914,060,072,000 rows. In 69ms (including network transfer\ntime). That's a lot of results in a very short amount of time. Definitely not\nwhat they were expecting."),(0,r.kt)("p",null,"We saw only a couple of bad actors try something cute:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-log"},"2020-06-23T20:59:02.958813Z I i.q.c.h.p.JsonQueryProcessorState [8536] exec [q='drop table trips'] 2020-06-24T02:56:55.782072Z I i.q.c.h.p.JsonQueryProcessorState [6318] exec [q='drop *']\n")),(0,r.kt)("p",null,"But those didn't work. We may be crazy, but we're not naive."),(0,r.kt)("h2",{id:"what-we-learned-from-our-hackernews-launch"},"What we learned from our HackerNews launch"),(0,r.kt)("p",null,"It turns out that when you do something like this, you learn a lot. You learn\nabout your strengths and your weaknesses. And you learn about what users want to\ndo with your product as well as what they will do to try to break it."),(0,r.kt)("p",null,"Joining the table to itself was one such lesson. But we also saw a lot of folks\nuse a ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," clause, which caused fairly slow results. We were not entirely\nsurprised by this result, as we are aware that we have not done the\noptimizations on that path to yield the fast results we want. But it was a great\ninsight into how often it is used, and how people use it."),(0,r.kt)("p",null,"We saw a number of people use the ",(0,r.kt)("inlineCode",{parentName:"p"},"group by")," clause as well, and then be\nsurprised that it didn't work. We probably should have warned people about that.\nIn short, ",(0,r.kt)("inlineCode",{parentName:"p"},"group by")," is automatically inferred, so it's not needed. But since\nit's not implemented at all, it causes an error. So we're looking at ways to\nhandle that."),(0,r.kt)("p",null,"We are taking all these lessons to heart, and making plans to address everything\nwe saw in upcoming releases."),(0,r.kt)("h2",{id:"conclusions"},"Conclusions"),(0,r.kt)("p",null,"It seems that the vast majority of the people that tried the demo were very\nimpressed with it. The speed is truly breathtaking."),(0,r.kt)("p",null,"Here are just a few of the comments we got in the thread:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"I abused LEFT JOIN to create a query that produces 224,964,999,650,251 rows.\nOnly 3.68ms execution time, now that's impressive!")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Very cool. Major props for putting this out there and accepting arbitrary\nqueries.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Very impressive, i think building your own (performant) database from scratch\nis one of the most impressive software engineering feats.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Very cool and impressive!! Is full PostreSQL wire compatibility on the\nroadmap? I like postgres compatibility :)")),(0,r.kt)("p",null,"(Yes, full Postgres compatibility is on the roadmap!)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Mind blowing, did not know about questDB. The back button seems broken on\nchrome mobile")),(0,r.kt)("p",null,"Yes, the demo did break the Back button on your browser. There's an actual\nreason for that, but it is true, for now. We're definitely addressing that one\nright away."),(0,r.kt)("h2",{id:"try-our-live-demo-query-16-billion-rows-of-data"},"Try our live demo, query 1.6 billion rows of data"),(0,r.kt)("p",null,"Want to try it yourself? You've read this far, you really should! got to\n",(0,r.kt)("a",{parentName:"p",href:"https://"},"https://")," to give it a whirl."),(0,r.kt)("p",null,"We'd love to have you join us on our ",(0,r.kt)("a",{parentName:"p",href:"https://"},"community Slack")," channel,\ngive us a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/questdb/questdb"},"star")," on GitHub, and\n",(0,r.kt)("a",{parentName:"p",href:"/get-questdb"},"download")," and try it yourself!"))}p.isMDXComponent=!0},30318:function(e,t,n){t.Z=n.p+"assets/images/join-4d382927a7a4051c2c2f3bd182705dad.png"}}]);