"use strict";(self.webpackChunkquestdb_io=self.webpackChunkquestdb_io||[]).push([[1765],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),m=i,h=u["".concat(s,".").concat(m)]||u[m]||p[m]||r;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var c=2;c<r;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},19878:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return p}});var a=n(83117),i=n(80102),r=(n(67294),n(3905)),l=["components"],o={title:"Indexes",sidebar_label:"Indexes",description:"Explanation on how indexes work as well as the pros and cons that you need to be aware of when using them."},s={unversionedId:"concept/indexes",id:"concept/indexes",isDocsHomePage:!1,title:"Indexes",description:"Explanation on how indexes work as well as the pros and cons that you need to be aware of when using them.",source:"@site/docs/concept/indexes.md",sourceDirName:"concept",slug:"/concept/indexes",permalink:"/docs/concept/indexes",editUrl:"https://github.com/turpleio/homepage/edit/main/docs/concept/indexes.md",version:"current",sidebar_label:"Indexes",frontMatter:{title:"Indexes",sidebar_label:"Indexes",description:"Explanation on how indexes work as well as the pros and cons that you need to be aware of when using them."},sidebar:"docs",previous:{title:"Symbol",permalink:"/docs/concept/symbol"},next:{title:"Geospatial data",permalink:"/docs/concept/geohashes"}},c=[{value:"Index creation and deletion",id:"index-creation-and-deletion",children:[]},{value:"How indexes work",id:"how-indexes-work",children:[{value:"Index capacity",id:"index-capacity",children:[]}]},{value:"Advantages",id:"advantages",children:[]},{value:"Trade-offs",id:"trade-offs",children:[]},{value:"Examples",id:"examples",children:[{value:"Table with index",id:"table-with-index",children:[]},{value:"Index capacity",id:"index-capacity-1",children:[]}]}],d={toc:c};function p(e){var t=e.components,n=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"An index stores the row locations for each value of the target column in order\nto provide faster read access. It allows you to bypass full table scans by\ndirectly accessing the relevant rows during queries with ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," conditions."),(0,r.kt)("p",null,"Indexing is available for ",(0,r.kt)("a",{parentName:"p",href:"/docs/concept/symbol"},"symbol")," columns. Index support\nfor other types will be added over time."),(0,r.kt)("h2",{id:"index-creation-and-deletion"},"Index creation and deletion"),(0,r.kt)("p",null,"The following are ways to index a ",(0,r.kt)("inlineCode",{parentName:"p"},"symbol")," column:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"At table creation time using\n",(0,r.kt)("a",{parentName:"li",href:"/docs/reference/sql/create-table#index"},"CREATE TABLE")),(0,r.kt)("li",{parentName:"ul"},"Using\n",(0,r.kt)("a",{parentName:"li",href:"/docs/reference/sql/alter-table-alter-column-add-index"},"ALTER TABLE ALTER COLUMN ADD INDEX"),"\nto index an existing ",(0,r.kt)("inlineCode",{parentName:"li"},"symbol")," column")),(0,r.kt)("p",null,"To delete an index:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/reference/sql/alter-table-alter-column-drop-index"},"ALTER TABLE ALTER COLUMN DROP INDEX"))),(0,r.kt)("h2",{id:"how-indexes-work"},"How indexes work"),(0,r.kt)("p",null,"Index creates a table of row locations for each distinct value for the target\n",(0,r.kt)("a",{parentName:"p",href:"/docs/concept/symbol"},"symbol"),". Once the index is created, inserting data into\nthe table will update the index. Lookups on indexed values will be performed in\nthe index table directly which will provide the memory locations of the items,\nthus avoiding unnecessary table scans."),(0,r.kt)("p",null,"Here is an example of a table and its index table."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"Table                                       Index\n|Row ID | Symbol    | Value |             | Symbol     | Row IDs       |\n| 1     | A         | 1     |             | A          | 1, 2, 4       |\n| 2     | A         | 0     |             | B          | 3             |\n| 3     | B         | 1     |             | C          | 5             |\n| 4     | A         | 1     |\n| 5     | C         | 0     |\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"INSERT INTO Table values(B, 1);")," would trigger two updates: one for the Table,\nand one for the Index."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"Table                                       Index\n|Row ID | Symbol    | Value |             | Symbol     | Row IDs       |\n| 1     | A         | 1     |             | A          | 1, 2, 4       |\n| 2     | A         | 0     |             | B          | 3, 6          |\n| 3     | B         | 1     |             | C          | 5             |\n| 4     | A         | 1     |\n| 5     | C         | 0     |\n| 6     | B         | 1     |\n")),(0,r.kt)("h3",{id:"index-capacity"},"Index capacity"),(0,r.kt)("p",null,"When a symbol column is indexed, an additional ",(0,r.kt)("strong",{parentName:"p"},"index capacity")," can be defined\nto specify how many row IDs to store in a single storage block on disk:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Server-wide setting: ",(0,r.kt)("inlineCode",{parentName:"li"},"cairo.index.value.block.size")," with a default of ",(0,r.kt)("inlineCode",{parentName:"li"},"256")),(0,r.kt)("li",{parentName:"ul"},"Column-wide setting: The\n",(0,r.kt)("a",{parentName:"li",href:"/docs/reference/sql/create-table/#column-indexes"},(0,r.kt)("inlineCode",{parentName:"a"},"index")," option")," for\n",(0,r.kt)("inlineCode",{parentName:"li"},"CREATE TABLE")),(0,r.kt)("li",{parentName:"ul"},"Column-wide setting:\n",(0,r.kt)("a",{parentName:"li",href:"/docs/reference/sql/alter-table-alter-column-add-index"},"ALTER TABLE COLUMN ADD INDEX"))),(0,r.kt)("p",null,"Fewer blocks used to store row IDs achieves better performance. At the same time\nover-sizing the setting will result in higher than necessary disk space usage."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("strong",{parentName:"li"},"index capacity")," and\n",(0,r.kt)("a",{parentName:"li",href:"/docs/concept/symbol#usage-of-symbols"},(0,r.kt)("strong",{parentName:"a"},"symbol capacity"))," are different\nsettings."),(0,r.kt)("li",{parentName:"ul"},"The index capacity value should not be changed, unless an user is aware of all\nthe implications.")))),(0,r.kt)("h2",{id:"advantages"},"Advantages"),(0,r.kt)("p",null,"Index allows you to greatly reduce the complexity of queries that span a subset\nof an indexed column, typically when using ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," clauses."),(0,r.kt)("p",null,"Consider the following query applied to the above table\n",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT sum(Value) FROM Table WHERE Symbol='A';")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Without Index"),", the query engine would scan the whole table in order to\nperform the query. It will need to perform 6 operations (read each of the 6\nrows once)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"With Index"),", the query engine will first scan the index table, which is\nconsiderably smaller. In our example, it will find A in the first row. Then,\nthe query engine would check the values at the specific locations 1, 2, 4 in\nthe table to read the corresponding values. As a result, it would only scan\nthe relevant rows in the table and leave irrelevant rows untouched.")),(0,r.kt)("h2",{id:"trade-offs"},"Trade-offs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Storage space"),": The index will maintain a table with each distinct symbol\nvalue and the locations where these symbols can be found. As a result, there\nis a small cost of storage associated with indexing a symbol field.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Ingestion performance"),": Each new entry in the table will trigger an entry\nin the Index table. This means that any write will now require two write\noperations, and therefore take twice as long."))),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("h3",{id:"table-with-index"},"Table with index"),(0,r.kt)("p",null,"An example of ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE TABLE")," command creating a table with an index capacity of\n128:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-questdb-sql"},"CREATE TABLE my_table(symb SYMBOL, price DOUBLE, ts TIMESTAMP),\n  INDEX (symb CAPACITY 128) timestamp(ts);\n-- equivalent to\nCREATE TABLE my_table(symb SYMBOL INDEX CAPACITY 128, price DOUBLE, ts TIMESTAMP),\n  timestamp(ts);\n")),(0,r.kt)("h3",{id:"index-capacity-1"},"Index capacity"),(0,r.kt)("p",null,"Consider an example table with 200 unique stock symbols and 1,000,000,000\nrecords over time. The index will have to store 1,000,000,000 / 200 row IDs for\neach symbol, i.e. 5,000,000 per symbol."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the index capacity is set to 1,048,576 in this case, QuestDB will use 5\nblocks to store the row IDs."),(0,r.kt)("li",{parentName:"ul"},"If the index capacity is set to 1,024 in this case, the block count will be\n4,883.")))}p.isMDXComponent=!0}}]);