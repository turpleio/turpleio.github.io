<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">How we achieved write speeds of 1.4 million rows per second | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="How we achieved write speeds of 1.4 million rows per second | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Our new ingestion framework can sort time series data before writing to disk. Here&#x27;s how we built it and how it compares to InfluxDB, ClickHouse, and TimescaleDB."><meta data-react-helmet="true" name="twitter:description" content="Our new ingestion framework can sort time series data before writing to disk. Here&#x27;s how we built it and how it compares to InfluxDB, ClickHouse, and TimescaleDB."><meta data-react-helmet="true" property="og:description" content="Our new ingestion framework can sort time series data before writing to disk. Here&#x27;s how we built it and how it compares to InfluxDB, ClickHouse, and TimescaleDB."><meta data-react-helmet="true" name="twitter:title" content="How we achieved write speeds of 1.4 million rows per second | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;How we achieved write speeds of 1.4 million rows per second | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="clickhouse,influxdb,timescaledb,tsbs,benchmark,timeseries,database"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2021-05-10/banner.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2021-05-10/banner.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">How we achieved write speeds of 1.4 million rows per second</h1><time datetime="2021-05-10T00:00:00.000Z" class="date_A31P">May 10, 2021 · 11 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/bluestreak01" alt="Vlad Ilyushchenko"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer">Vlad Ilyushchenko</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><p>The journey to today&#x27;s version of QuestDB began with the original prototype in
2013, and we&#x27;ve described what happened since in a post published during
<a href="https://news.ycombinator.com/item?id=23975807" target="_blank" rel="noopener noreferrer">our HN launch</a> last year. In the
early stages of the project, we were inspired by vector-based append-only
systems like kdb+ because of the advantages of speed and the simple code path
this model brings. We also required that row timestamps were stored in ascending
order, resulting in fast time series queries without an expensive index.</p><p>We found out that this model does not fit all data acquisition use cases, such
as out-of-order data. Although several workarounds were available, we wanted to
provide this functionality without losing the performance we spent years
building.</p><p>We studied existing approaches, and most came at a performance cost that we
weren&#x27;t happy with. Like the entirety of our codebase, the solution that we
present today is built from scratch. It took over 9 months to come to fruition
and adds a further 65k lines of code to the project.</p><p>Here&#x27;s what we built, why we built it, what we learned along the way, and
benchmarks comparing QuestDB to InfluxDB, ClickHouse and TimescaleDB.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="the-problem-with-out-of-order-data"></a>The problem with out-of-order data<a class="hash-link" href="#the-problem-with-out-of-order-data" title="Direct link to heading">#</a></h2><p>Our data model had one fatal flaw - records were discarded if they appear
out-of-order (O3) by timestamp compared to existing data. In real-world
applications, payload data doesn’t behave like this because of network jitter,
latency, or clock synchronization issues.</p><figure><img alt="A diagram with two timelines illustrating how data may be delayed from multiple applications to a single database" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="415" src="/img/blog/2021-05-10/o3-data-illustration.jpg" width="650"><figcaption class="caption_-tGK">Out-of-order data in real-world applications</figcaption></figure><p>We knew that the lack of out-of-order support was a show-stopper for some users
and we needed a solid solution. There were possible workarounds, such as using a
single table per data source or re-ordering tables periodically, but for most
users this is inconvenient and unsustainable.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-should-you-store-out-of-order-time-series-data"></a>How should you store out-of-order time series data?<a class="hash-link" href="#how-should-you-store-out-of-order-time-series-data" title="Direct link to heading">#</a></h2><p>As we reviewed our data model, one possibility was to use something radically
different from what we already had, such as including LSM trees or B-trees,
commonly used in time series databases. Adding trees would bring the benefit of
being able to order data on the fly without inventing a replacement storage
model from scratch.</p><p>What bothered us most with this approach is that every subsequent read operation
would face a performance penalty versus having data stored in arrays. We would
also introduce complexity by having a storage model for ordered data and another
for out-of-order data.</p><p>A more promising option was to introduce a sort-and-merge phase as data arrives.
This way, we could keep our storage model unchanged, while merging data on the
fly, with ordered vectors landing on disk as the output.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="early-thoughts-on-a-solution"></a>Early thoughts on a solution<a class="hash-link" href="#early-thoughts-on-a-solution" title="Direct link to heading">#</a></h2><p>Our idea of how we could handle out-of-order ingestion was to add a three-stage
approach:</p><ol><li>Keep the append model until records arrive out-of-order</li><li>Sort uncommitted records in a staging area in-memory</li><li>Reconcile and merge the sorted data and persisted data at commit time</li></ol><p>The first two steps are straightforward and easy to implement, and handling
append-only data is unchanged. The heavy commit kicks in only when there is data
in the staging area. The bonus of this design is that the output is vectors,
meaning our vector-based readers are still compatible.</p><p>This pre-commit sort-and-merge adds an extra processing phase to ingestion with
an accompanying performance penalty. We nevertheless decided to explore this
approach and see how far we could reduce the penalty by optimizing the heavy
commit.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-we-sort-merge-and-commit-out-of-order-time-series-data"></a>How we sort, merge, and commit out-of-order time series data<a class="hash-link" href="#how-we-sort-merge-and-commit-out-of-order-time-series-data" title="Direct link to heading">#</a></h2><p>Processing a staging area in bulk gives us a unique opportunity to analyze the
data holistically. Such analysis aims to avoid physical <em>merges</em> altogether
where possible and perhaps get away with fast and straightforward <code>memcpy</code> or
similar data movement methods. Such methods can be parallelized thanks to our
column-based storage. We can employ SIMD and non-temporal data access where it
makes a difference.</p><p>We sort the timestamp column from the staging area via an optimized version of
radix sort, and the resulting index is used to reshuffle the remaining columns
in the staging area in parallel:</p><figure><img alt="A diagram illustrating how sorting is applied to unordered database records based on a timestamp column order" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="452" src="/img/blog/2021-05-10/o3-radix-sort.png" width="650"><figcaption class="caption_-tGK">Applying sort order to columns in parallel</figcaption></figure><p>The now-sorted staging area is mapped relative to the existing partition data.
It may not be obvious from the start but we are trying to establish the type of
operation needed and the dimensions of each of the three groups below:</p><figure><img alt="A diagram illustrating the combinations of merge operations that can be applied to two data sets" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="400" src="/img/blog/2021-05-10/staging-area.png" width="650"><figcaption class="caption_-tGK">O3 sort and merge scenarios</figcaption></figure><p>When merging datasets in this way, the prefix and suffix groups can be persisted
data, out-of-order data, or none. The merge group is where more cases occur as
it can be occupied by persisted data, out-of-order data, both out-of-order and
persisted data, or none.</p><p>When it&#x27;s clear how to group and treat data in the staging area, a pool of
workers perform the required operations, calling <code>memcpy</code> in trivial cases and
shifting to SIMD-optimized code for everything else. With a prefix, merge, and
suffix split, the maximum <code>liveliness</code> of the commit (how susceptible it is to
add more CPU capacity) is <code>partitions_affected</code> x <code>number_of_columns</code> x <code>3</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="optimizing-copy-operations-with-simd"></a>Optimizing copy operations with SIMD<a class="hash-link" href="#optimizing-copy-operations-with-simd" title="Direct link to heading">#</a></h2><p>Because we aim to rely on <code>memcpy</code> the most, we benchmarked code that merges
variable-length columns:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">template</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token keyword" style="color:#ff79c6">typename</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">inline</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">void</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">merge_copy_var_column</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        index_t </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">merge_index</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> merge_index_size</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_data_fix</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_data_var</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_ooo_fix</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_ooo_var</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">dst_fix</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">dst_var</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> dst_var_offset</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        T mult</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_fix</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">src_ooo_fix</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> src_data_fix</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_var</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">src_ooo_var</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> src_data_var</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> l </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> l </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> merge_index_size</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> l</span><span class="token operator" style="color:#ff79c6">++</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#8be9fd">MM_PREFETCH_T0</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">merge_index </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> l </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">64</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        dst_fix</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> dst_var_offset</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">uint64_t</span><span class="token plain"> row </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> merge_index</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">uint32_t</span><span class="token plain"> bit </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">row </span><span class="token operator" style="color:#ff79c6">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">63</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">uint64_t</span><span class="token plain"> rr </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> row </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">~</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1ull</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">63</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> offset </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> src_fix</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">bit</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">rr</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">src_var_ptr </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> src_var</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">bit</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> offset</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">auto</span><span class="token plain"> len </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token keyword" style="color:#ff79c6">reinterpret_cast</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">T </span><span class="token operator" style="color:#ff79c6">*</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">src_var_ptr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">auto</span><span class="token plain"> char_count </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> len </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">?</span><span class="token plain"> len </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"> mult </span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">reinterpret_cast</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">T </span><span class="token operator" style="color:#ff79c6">*</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dst_var </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> dst_var_offset</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> len</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#8be9fd">__MEMCPY</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dst_var </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> dst_var_offset </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">sizeof</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">T</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> src_var_ptr </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">sizeof</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">T</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> char_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        dst_var_offset </span><span class="token operator" style="color:#ff79c6">+=</span><span class="token plain"> char_count </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">sizeof</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">T</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>with <code>__MEMCPY</code> as Angner Fog&#x27;s Asmlib <code>A_memcpy</code>, in one instance and glibC&#x27;s
<code>memcpy</code> in the other.</p><figure><img alt="A chart showing the performance of memory copy libraries Asmlib and gcliC by megabytes copied over time" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="361" src="/img/blog/2021-05-10/memcpy-comparison.png" width="650"><figcaption class="caption_-tGK">Xeon 8275CL CPU @ 3.00GHz, AVX 512, 3.00GHz, 36608K cache, Amzn2 Linux. Units are microseconds/Mb, lower score is better.</figcaption></figure><figure><img alt="A chart showing the performance of memory copy libraries Asmlib, gcliC and Windows CRT by megabytes copied over time" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="348" src="/img/blog/2021-05-10/memcpy-comparison-2.png" width="650"><figcaption class="caption_-tGK">i7-3770, 3.40GHz, 8Mb cache, AVX, Ubuntu 20. Units are microseconds/Mb, lower score is better.</figcaption></figure><p>The key results from this comparison are:</p><ul><li><code>glibc</code> could be slow and inconsistent on AVX512 for our use case. We
speculate that <code>A_memcpy</code> does better because it uses non-temporal copy
instructions.</li><li>Windows <code>memcpy</code> is pretty bad.</li><li><code>A_memcpy</code> and <code>memcpy</code> perform well on CPUs below AVX512.</li></ul><p><code>A_memcpy</code> uses non-temporal streaming instruction which appear to work well
with the following simple loop:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">template</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token keyword" style="color:#ff79c6">typename</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">void</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">set_memory_vanilla</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">T </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> T value</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">   </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> i </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> i </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> count</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> i</span><span class="token operator" style="color:#ff79c6">++</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">       addr</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">   </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The above is a memory buffer filled with the same 64 bit pattern. It can be
implemented as <code>memset</code> if all bytes are the same. It also can be written as
vectorized code which uses platform-specific <code>_mm??_stream_ps(p,?mm)</code> in
<code>store_nt</code> vector method, as seen below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">template</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token keyword" style="color:#ff79c6">typename</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">typename</span><span class="token plain"> </span><span class="token class-name">TVec</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">inline</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">void</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">set_memory_vanilla</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">T </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">addr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> T value</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">auto</span><span class="token plain"> l_iteration </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">addr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        addr</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> TVec </span><span class="token function" style="color:#8be9fd">vec</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">auto</span><span class="token plain"> l_bulk </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">vec</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> addr</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">int64_t</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        vec</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">store_nt</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">addr </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    run_vec_bulk</span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">T</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> TVec</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> l_iteration</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> l_bulk</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The results were quite surprising. Non-temp SIMD instructions showed the most
stable results with similar performance to <code>memset</code>.</p><figure><img alt="A chart showing the performance of non-temporal SIMD instructions, memset and loops for time taken to fill buffers with data" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="409" src="/img/blog/2021-05-10/non-temporal-memset.png" width="650"><figcaption class="caption_-tGK">Initializing a buffer with the same 64bit value</figcaption></figure><p>Unfortunately, benchmark results with other functions were less conclusive. Some
perform better with hand-written SIMD and some just as fast with GCC&#x27;s SSE4
generated code even when it is ran on AVX512 systems.</p><p>Hand-writing SIMD instructions is both time consuming and verbose. We ended up
optimizing parts of the code base with SIMD only when the performance benefits
outweighed code maintenance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-often-should-data-be-ordered-and-merged"></a>How often should data be ordered and merged?<a class="hash-link" href="#how-often-should-data-be-ordered-and-merged" title="Direct link to heading">#</a></h2><p>While being able to copy data fast is a good option, we think that heavy data
copying can be avoided in most time series ingestion scenarios. Assuming that
most real-time out-of-order situations are caused by the delivery mechanism and
hardware jitter, we can deduce that the timestamp distribution will be locally
contained by some boundary.</p><p>For example, if any new timestamp value has a high probability to fall within 10
seconds of the previously received value, the boundary is then 10 seconds, and
we call this boundary <em>lag</em>.</p><p>When timestamp values follow this pattern, deferring the commit can render
out-of-order commits a normal append operation. The out-of-order system can deal
with any variety of lateness, but if incoming data is late within the time
specified as <em>lag</em>, it will be prioritized for faster processing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="comparing-ingestion-with-clickhouse-influxdb-and-timescaledb"></a>Comparing ingestion with ClickHouse, InfluxDB and TimescaleDB<a class="hash-link" href="#comparing-ingestion-with-clickhouse-influxdb-and-timescaledb" title="Direct link to heading">#</a></h2><p>We saw the <a href="https://github.com/timescale/tsbs" target="_blank" rel="noopener noreferrer">Time Series Benchmark Suite</a>
(TSBS) regularly coming up in discussions about database performance and decided
we should provide the ability to benchmark QuestDB along with other systems.</p><p>The TSBS is a collection of Go programs to generate datasets and then benchmark
read and write performance. The suite is extensible so that different use cases
and query types can be included and compared across systems.</p><p>Here are our results of the benchmark with the <code>cpu-only</code> use case using up to
fourteen workers on an AWS EC2 <code>m5.8xlarge</code> instance with sixteen cores.</p><figure><img alt="Time series benchmark suite results showing QuestDB outperforming ClickHouse, TimescaleDB and InfluxDB when using four workers" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="377" src="/img/blog/2021-05-10/max-throughput-comparison.png" width="650"><figcaption class="caption_-tGK">TSBS results comparing the maximum ingestion throughput of QuestDB, InfluxDB, ClickHouse, and TimescaleDB</figcaption></figure><p>We reach maximum ingestion performance using four threads, whereas the other
systems require more CPU resources to hit maximum throughput. QuestDB achieves
959k rows/sec with 4 threads. We find that InfluxDB needs 14 threads to reach
its max ingestion rate (334k rows/sec), while TimescaleDB reaches 145k rows/sec
with 4 threads. ClickHouse hits 914k rows/sec with twice as many threads as
QuestDB.</p><p>When running on 4 threads, QuestDB is 1.7x faster than ClickHouse, 6.4x faster
than InfluxDB and 6.5x faster than TimescaleDB.</p><figure><img alt="A chart comparing the maximum throughput of four database systems, showing QuestDB hitting ingestion limits with less resources than other systems" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="324" src="/img/blog/2021-05-10/tsbs-benchmark-results.png" width="650"><figcaption class="caption_-tGK">TSBS benchmark results using 4 threads: rows ingested per second by QuestDB, InfluxDB, ClickHouse, and TimescaleDB.</figcaption></figure><p>Because our ingestion format (ILP) repeats tag values per row, ClickHouse and
TimescaleDB parse around two-thirds of the total volume of data as QuestDB does
in the same benchmark run. We chose to stick with ILP because of its widespread
use in time series, but we may use a more efficient format to improve ingestion
performance in the future.</p><p>Finally, degraded performance beyond 4 workers can be explained by the increased
contention beyond what the system is capable of. We think that one limiting
factor may be that we are IO bound as we scale up to 30% better on faster
AMD-based systems.</p><p>When we run the suite again using an AMD Ryzen5 processor, we found that we were
able to hit maximum throughput of 1.43 million rows per second using 5 threads.
This is compared to the
<a href="https://aws.amazon.com/ec2/instance-types/" target="_blank" rel="noopener noreferrer">Intel Xeon Platinum</a> that&#x27;s in use
by our reference benchmark <code>m5.8xlarge</code> instance on AWS.</p><figure><img alt="A chart comparing the maximum throughput of QuestDB when utilizing an Intel Xeon Platinum processor versus an AMD Ryzen5 processor." class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="410" src="/img/blog/2021-05-10/questdb-bench-amd-ryzen.png" width="650"><figcaption class="caption_-tGK">Comparing QuestDB TSBS load results on AWS EC2 using an Intel Xeon Platinum versus an AMD Ryzen5</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="adding-questdb-support-to-the-time-series-benchmark-suite"></a>Adding QuestDB support to the Time Series Benchmark Suite<a class="hash-link" href="#adding-questdb-support-to-the-time-series-benchmark-suite" title="Direct link to heading">#</a></h2><p>We have opened a pull request
(<a href="https://github.com/timescale/tsbs/issues/157" target="_blank" rel="noopener noreferrer">#157 - Questdb benchmark support</a>) in
TimescaleDB&#x27;s TSBS GitHub repository which adds the ability to run the benchmark
against QuestDB. In the meantime, readers may clone
<a href="https://github.com/questdb/tsbs" target="_blank" rel="noopener noreferrer">our fork of the benchmark suite</a> and run the
tests to see the results for themselves.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Generating the dataset</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">tsbs_generate_data --use-case</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;cpu-only&quot;</span><span class="token plain"> --seed</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">123</span><span class="token plain"> --scale</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">4000</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  --timestamp-start</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;2016-01-01T00:00:00Z&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  --timestamp-end</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;2016-01-02T00:00:00Z&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  --log-interval</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;10s&quot;</span><span class="token plain"> --format</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;influx&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> /tmp/bigcpu</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Loading the data</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">tsbs_load_questdb --file /tmp/bigcpu --workers </span><span class="token number" style="color:#50fa7b">4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To add out-of-order support, we went for a novel solution that yielded
surprisingly good performance versus well-trodden approaches such as B-trees or
LSM-based ingestion frameworks. We&#x27;re happy to have shared the journey, and
we&#x27;re eagerly awaiting feedback from the community.</p><p>For more details, the
<a href="https://github.com/questdb/questdb/releases/tag/6.0.0" target="_blank" rel="noopener noreferrer">GitHub release for version 6.0</a>
contains a changelog of additions and fixes in this release.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/engineering">engineering</a><a class="margin-horiz--sm" href="/blog/tags/benchmark">benchmark</a><a class="margin-horiz--sm" href="/blog/tags/hackernews">hackernews</a><a class="margin-horiz--sm" href="/blog/tags/clickhouse">clickhouse</a><a class="margin-horiz--sm" href="/blog/tags/timescaledb">timescaledb</a><a class="margin-horiz--sm" href="/blog/tags/influxdb">influxdb</a><a class="margin-horiz--sm" href="/blog/tags/algorithms">algorithms</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/06/16/high-cardinality-time-series-data-performance"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« How databases handle 10 million devices in high-cardinality benchmarks</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/04/20/questdb-release-6-0-alpha"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">QuestDB version 6.0 alpha »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.3e047ba9.js" defer="defer"></script>
</body>
</html>