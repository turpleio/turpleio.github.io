<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">How we built inter-thread messaging from scratch | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="How we built inter-thread messaging from scratch | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" name="twitter:description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" property="og:description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" name="twitter:title" content="How we built inter-thread messaging from scratch | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;How we built inter-thread messaging from scratch | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="performance,opensource,inter-thread messaging,questdb,database,architecture"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2020-03-15/header.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2020-03-15/header.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a><a class="navbar__item navbar__link" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">How we built inter-thread messaging from scratch</h1><time datetime="2021-11-03T00:00:00.000Z" class="date_A31P">November 3, 2021 · 7 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/bluestreak01" alt="Vlad Ilyushchenko"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer">Vlad Ilyushchenko</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><figure><img alt="Flock of birds flying in a harmonised way" class="image_1-Fc" height="360" src="/img/blog/2020-03-15/header.png" width="650"></figure><p>Inter-thread messaging is a fundamental part of any asynchronous system. It is
the component responsible for the transportation of data between threads.
Messaging forms the infrastructure, scaffolding multi-threaded applications, and
just like real-world transport infrastructure, we want it to be inexpensive,
fast, reliable, and clean. For QuestDB, we wrote our own messaging system, and
this post is about how it works and how fast it is.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="architecture"></a>Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">#</a></h2><p>Borrowing heavily from world-famous Disruptor our messaging revolves around
multiple threads accessing shared circular data structure. We call it RingQueue.
Semantically RingQueue provides unbounded, index-based, random access to its
elements. It does not coordinate concurrent access nor does it provide
guarantees on thread safety. Coordination and thread-safety is a concern of
Sequences. Sequences are responsible for providing indices that can be used to
access RingQueue concurrently and safely.</p><p>To help sequences do their magic they have to be shaped into a graph. We start
with syntax to chain sequences together:</p><p><code>a.then(b).then(c).then(d)</code></p><p>The result is a trivial sequence graph:</p><p><code>a -&gt; b -&gt; c -&gt; d</code></p><p>To branch we use helper class FanOut:</p><p><code>a.then(FanOut.to(b).and(c)).then(d)</code></p><p>The result is this sequence graph:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">     +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> B --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">A --</span><span class="token operator" style="color:#ff79c6">&gt;|</span><span class="token plain">         </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> D</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> C --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>These two pieces of syntax are flexible enough to create any desired flow. This
example shows that FanOut can have chain of sequences and other FanOuts:</p><p><code>a.then(FanOut.to(FanOut.to(b).and(c)).and(d.then(e)).then(f)</code></p><p>It is quite a mouthful but it creates this nice little graph:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">        +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> B --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    +-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">         </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">   +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> C --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">A--</span><span class="token operator" style="color:#ff79c6">&gt;|</span><span class="token plain">             </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> F</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">             </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    +-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> D -</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> E --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>FanOut can also be used as a placeholder in a chain to allow threads to
subscribe/unsubscribe on the fly. Dynamic subscription is then simply adding a
new sequence to FanOut:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// You can add as many sequences into fan out as you like.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// Sequences can be added either up front or subscribe/unsubscribe on the fly.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FanOut fanOut = new FanOut();</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// ordinary producer sequence</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Sequence seqProducer = new SPSequence(queue.getCapacity());</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// daisy chain producer and fan out and loop back producer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">seqProducer.then(fanOut).then(seqProducer);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// meanwhile in another thread ....</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">...</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// Add individual consumer sequences later as needed.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// This is thread safe non-blocking operation that can be performed from any thread.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// It is important to use current producer position as consumer starting point when subscribing on the fly.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Sequence consumer1 = fanOut.addAndGet(new SCSequence(seqProducer.current()));</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// do something useful with consumer1 sequence</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">...</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// remove sequence from fanOut to unsubscribe</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fanOut.remove(consumer1);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Typical graph must contain single producer sequence and one or more consumer
sequences. It will also have to be circular, e.g. to start and end with producer
sequence. Graph has to be circular because we use circular underlying data
structure, RingQueue. Without loop-back producer would be liable to overwrite
queue elements before consumers had a chance to read them. Worse still, queue
elements can be written to and read from concurrently. We don&#x27;t want that to
happen, right?</p><p>To help create practical sequence graph we implemented 4 types of sequences we
can play with. These sequences are better understood as combination of their
types and properties. SP - single producer, MP - multiple producer, SC - single
consumer and MC - multiple consumer. Multi- sequences allow concurrent access
and they guarantee that no two threads can retrieve same index. It is this
property adds extra fun dimension to sequence graphs. Consider this graph:</p><p><code>A -&gt; B -&gt; A</code></p><p>or in Java notations:</p><p><code>A.then(B).then(A)</code></p><p>When &quot;B&quot; is an instance of MCSequence() we have a self-balancing worker pool.
When &quot;A&quot; is MPSequence(), we have many-to-many pub-sub system. Cool, eh?</p><p>Single- sequences are faster but they are not thread-safe. They should be
preferred for single-threaded consumer models.</p><p>Lets take a look at how threads interact with sequences. This is a typical
example of publisher:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// loop until there is work to do</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// consumer thread may be able to rely on producer to</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// publish &quot;special&quot; message to indicate end of stream.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">while (true) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // Non-blocking call. Method returns immediately either with zero-based</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // ring queue index or negative long indicating one of following:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // -1 = queue is empty</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // -2 = there was a contest for queue index and this thread has lost</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  long cursor = sequence.next();</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  if (cursor &lt; 0) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // negative cursor is an error</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // thread has a choice of things to do:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // - busy spin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // - yield/park</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // - work on something else</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    LockSupport.parkNanos(1);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    continue;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // write to queue</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  try {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    queue.get(cursor).value;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  } finally {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // releasing cursor promptly is important</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    sequence.done(cursor);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><code>Sequence.next()</code> return values are:</p><p>-1 Queue is unavailable. It is either full or empty, depending on whether it is
producer or consumer sequence</p><p>-2 Temporary race condition. Sequence failed CAS and delegated decision to your
application.</p><p>Consumer sequence interaction is almost identical. The only difference would be
consumer reading queue item instead of writing it.</p><p>Performance of single-threaded sequences can benefit further from batching.
Batching relies on receiving range of indices from sequence and calling done()
at end of batch rather than for every queue item. This is what consumer code
might look like (producer code is the same):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><div tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">while (running) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  long cursor = sequence.next();</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  if (cursor &lt; 0) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    LockSupport.parkNanos(1);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    continue;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // get max index sequence can reach</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  long available = sequence.available();</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // look thru queue elements without using sequence</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  while (cursor &lt; available) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    queue.get(cursor++);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  // calling done() only once per batch can yield significant performance benefit</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  sequence.done(available - 1);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Multi-threaded sequence do not support batches.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="performance"></a>Performance<a class="hash-link" href="#performance" title="Direct link to heading">#</a></h2><p>I used Shipilev&#x27;s project that already had Disruptor benchmark and I added
QuestDB implementation of the same pipeline.</p><p>Benchmark source on <a href="https://github.com/bluestreak01/disrupting-fjp" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><strong>2 CPU MBP 2015</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Benchmark          </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">slicesK</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">threads</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">workMult</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  Mode  Cnt    Score    Error  Units</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run            </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">10.043</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.158</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">19.944</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.285</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">133.082</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">6.032</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">13.027</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.180</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">26.329</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.327</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">141.686</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">4.129</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">29.470</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.976</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">62.205</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">3.278</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">321.697</span><span class="token plain"> ± </span><span class="token number" style="color:#50fa7b">12.031</span><span class="token plain">  ms/op</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><strong>4 CPU x5960 @ 4.2Ghz</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Benchmark          </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">slicesK</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">threads</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">workMult</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  Mode  Cnt    Score    Error  Units</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run            </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">    </span><span class="token number" style="color:#50fa7b">6.892</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.654</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">10.143</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.623</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">54.084</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">4.164</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">    </span><span class="token number" style="color:#50fa7b">6.364</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.197</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">11.454</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.754</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">50.928</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">3.264</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">14.240</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">1.341</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">27.246</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">2.777</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">142.207</span><span class="token plain"> ± </span><span class="token number" style="color:#50fa7b">15.157</span><span class="token plain">  ms/op</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Disruptor and QuestDB perform essentially the same.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-to-get-it"></a>How to get it<a class="hash-link" href="#how-to-get-it" title="Direct link to heading">#</a></h2><p>Our messaging system is on Maven central as a part of QuestDB. Don&#x27;t worry about
package size though, QuestDB jar is around 3.6MB and has no dependencies. Jump
to the <a href="https:///releases" target="_blank" rel="noopener noreferrer">GitHub release page</a> for version reference.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/engineering">engineering</a><a class="margin-horiz--sm" href="/blog/tags/multithreading">multithreading</a><a class="margin-horiz--sm" href="/blog/tags/architecture">architecture</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/11/09/miguel-arregui-working-at-questdb"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Why I joined QuestDB as a core database engineer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/11/01/plotly-finnhub-realtime-dashboard"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Real-time stock price dashboard using QuestDB, Python and Plotly »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"><div class="category_Ptbh"><span class="title_HpoE">Product</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/cloud/">Cloud</a></li><li><a class="link_vx7p" href="/enterprise/">Enterprise</a></li><li><a class="link_vx7p" href="/pricing/">Pricing</a></li><li><a class="link_vx7p" href="/use-cases/">Use Cases</a></li><li><a class="link_vx7p" href="/customers/">Customers</a></li><li><a class="link_vx7p" href="https://github.com/orgs/questdb/projects/1/views/5" rel="noopener noreferrer" target="_blank">Roadmap</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Developers</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/docs/">Docs</a></li><li><a class="link_vx7p" href="/blog/tags/tutorial/">Tutorials</a></li><li><a class="link_vx7p" href="/blog/">Blog</a></li><li><a class="link_vx7p" href="https://">Discussions</a></li><li><a class="link_vx7p" href="https://">Join Slack</a></li><li><a class="link_vx7p" href="/community/">Swag</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Company</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/about-us/">About us</a></li><li><a class="link_vx7p" href="/careers/">Careers</a></li></ul></div></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.db1fdb94.js" defer="defer"></script>
</body>
</html>