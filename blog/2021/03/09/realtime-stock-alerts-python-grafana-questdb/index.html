<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Real-time stock price alerts using Python, Grafana and QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Real-time stock price alerts using Python, Grafana and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Use Python to query stock prices via REST API, stream the results to QuestDB, and configure Slack alerts based on changes in time series data using Grafana."><meta data-react-helmet="true" name="twitter:description" content="Use Python to query stock prices via REST API, stream the results to QuestDB, and configure Slack alerts based on changes in time series data using Grafana."><meta data-react-helmet="true" property="og:description" content="Use Python to query stock prices via REST API, stream the results to QuestDB, and configure Slack alerts based on changes in time series data using Grafana."><meta data-react-helmet="true" name="twitter:title" content="Real-time stock price alerts using Python, Grafana and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Real-time stock price alerts using Python, Grafana and QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,marketdata,grafana,python"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-grafana.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-grafana.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Real-time stock price alerts using Python, Grafana and QuestDB</h1><time datetime="2021-03-09T00:00:00.000Z" class="date_A31P">March 9, 2021 · 9 min read</time><div class="avatar margin-vert--md"><a href="https://gist.github.com/kovid-r" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/kovid-r" alt="Kovid Rathee"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://gist.github.com/kovid-r" target="_blank" rel="noopener noreferrer">Kovid Rathee</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A laptop showing a graph of financial data over time" class="image_1-Fc image--title_Z46g" height="433" src="/img/blog/2021-03-09/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://techdaily.ca/robinhood-canada" target="_blank" rel="noopener noreferrer">Tech Daily</a> via <a href="https://unsplash.com/photos/ztYmIQecyH4" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This submission comes from one of our community contributors
<a href="https://kovidrathee.medium.com/" target="_blank" rel="noopener noreferrer">Kovid Rathee</a> who has written a great guide
for setting up alerting via Grafana.</p><p>Thanks for your contribution, Kovid!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>There are many reasons why reacting to time series data is useful, and the
quicker you can respond to changes in this data, the better. The best tool for
this job is easily a time series database, a type of database designed to write
and read large amounts of measurements that change over time.</p><p>In this tutorial, you will learn how to read data from a REST API and stream it
to QuestDB, an open-source time series database. We will use Grafana to
visualize the data and notify Slack of changes that interest us. We use Python
to fetch data from the API and stream it to QuestDB, and you can easily
customize the scripts to check different stocks or even APIs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>Before getting started with the tutorial, you will need the following:</p><ul><li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener noreferrer">Docker</a> to run Grafana and
QuestDB with Docker Compose</li><li><a href="https://iextrading.com/developers/" target="_blank" rel="noopener noreferrer">IexFinance account</a>, which offers a free
tier for 50,000 API calls per month to poll stock prices</li><li><a href="https://slack.com/intl/en-gb/help/articles/206845317-Create-a-Slack-workspace" target="_blank" rel="noopener noreferrer">Slack workspace</a>
(optional)</li></ul><p>The Python example in this tutorial uses
<a href="https://github.com/questdb/questdb-slack-grafana-alerts/blob/main/python/stock_data_TSLA_example.py#L29" target="_blank" rel="noopener noreferrer">real-time price for a stock</a>,
using the last trade on IEX. Prices outside of market hours can be retrieved
from the <code>extendedPrice</code> field from the Quote endpoint. For more information,
see the <a href="https://iexcloud.io/docs/api/#quote" target="_blank" rel="noopener noreferrer">IexCloud quote endpoint</a></p><p>This tutorial uses Slack as an example notification channel to deliver alerts
via Grafana, but it&#x27;s simple to choose another channel you would like alerts
delivered to, such as your own REST API via webhook, Kafka, email, Pagerduty and
more. For more details on the available notification channels, see the Grafana
documentation for the
<a href="https://grafana.com/docs/grafana/latest/alerting/notifications/#list-of-supported-notifiers" target="_blank" rel="noopener noreferrer">list of supported notifiers</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="start-questdb-and-grafana"></a>Start QuestDB and Grafana<a class="hash-link" href="#start-questdb-and-grafana" title="Direct link to heading">#</a></h2><p>To clone the GitHub repository and start the example project:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> clone https://github.com/questdb/questdb-slack-grafana-alerts.git</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> questdb-slack-grafana-alerts</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker-compose up</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Running <code>docker-compose up</code> brings up two networked containers:</p><ul><li>Grafana on <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">localhost:3000</a></li><li>QuestDB on <a href="http://localhost:9000" target="_blank" rel="noopener noreferrer">localhost:9000</a> as well as a port open on
<code>8812</code>, which accepts Postgres wire protocol</li></ul><p>Running <code>docker-compose up</code> will also
<a href="https://github.com/bsmth/questdb-slack-grafana-alerts/tree/main/grafana" target="_blank" rel="noopener noreferrer">provision Grafana</a>
with the default connection credentials to QuestDB for Postgres authentication.
By provisioning credentials, you can use QuestDB as a default data source in
Grafana right away without manual configuration steps.</p><p>Verify QuestDB and Grafana are running by visiting the URLs listed above or use
<code>docker-compose ps</code> from the repository root which will show you the running
containers:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#262833" class="codeBlockTitle_oQzk">docker-compose ps</div><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">     Name                   Command               State                            Ports</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">grafana_alerts   /run.sh                          Up      </span><span class="token number" style="color:#50fa7b">0.0</span><span class="token plain">.0.0:3000-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token number" style="color:#50fa7b">3000</span><span class="token plain">/tcp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">questdb_alerts   /app/bin/java --add-export </span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.   Up      </span><span class="token number" style="color:#50fa7b">0.0</span><span class="token plain">.0.0:8812-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token number" style="color:#50fa7b">8812</span><span class="token plain">/tcp, </span><span class="token number" style="color:#50fa7b">0.0</span><span class="token plain">.0.0:9000-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token number" style="color:#50fa7b">9000</span><span class="token plain">/tcp, </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain">/tcp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="send-data-to-questdb"></a>Send data to QuestDB<a class="hash-link" href="#send-data-to-questdb" title="Direct link to heading">#</a></h2><p>The Python dependencies required for this tutorial are provided in the
<code>requirements.txt</code> file and can be installed using pip:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">pip </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> -r requirements.txt</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We will use the <a href="https://pypi.org/project/iexfinance/" target="_blank" rel="noopener noreferrer">IexFinance API</a> to fetch
real-time stock prices, but first, we can verify the configuration is correct by
using a test script that generates dummy data. The mock script generates random
prices so that we don&#x27;t deplete the API call limit during testing.</p><p>To start sending mock data to QuestDB, run the mock data script in the <code>python</code>
directory:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> python</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">python mock_stock_data_example.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The script will create a table <code>stock_prices</code>, and it will start sending mock
data to this table. The columns that we have are:</p><table><thead><tr><th>column</th><th>description</th></tr></thead><tbody><tr><td><code>stockListed</code></td><td>name of the stock, e.g., <code>TSLA</code> for Tesla</td></tr><tr><td><code>stockPrice</code></td><td>price of the stock in USD as <code>double</code></td></tr><tr><td><code>createdDateTime</code></td><td>timestamp at which stockPrice was ingested in QuestDB</td></tr></tbody></table><p>One feature of QuestDB that we are using for the stock name is the <code>symbol</code> data
type optimized for text columns with repetitive values. More information on this
type can be found on the QuestDB
<a href="/docs/concept/symbol">documentation for symbol type</a>.</p><p>To verify if data is arriving in QuestDB:</p><ol><li>Navigate to <a href="http://localhost:9000" target="_blank" rel="noopener noreferrer">localhost:9000</a></li><li>Run the following query:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT * FROM stock_prices;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We should see all rows from our table returned at the bottom panel:</p><figure><img alt="A screenshot of the QuestDB web console displaying rows of a database table" class="image_Pw1y margin_Rc0b shadow_7z-4" height="354" src="/img/blog/2021-03-09/all-rows.png" width="650"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="query-real-time-stock-prices"></a>Query real-time stock prices<a class="hash-link" href="#query-real-time-stock-prices" title="Direct link to heading">#</a></h2><p>Once you have tested the ingestion using the mock data script, we can start
making requests to an API for live market data and query real-time stock prices.
To configure IexFinance API authentication:</p><ol><li>On the <a href="https://iexcloud.io/console/tokens" target="_blank" rel="noopener noreferrer">IexFinance console</a>, create an
API token</li><li>Click <strong>Reveal Secret Token</strong> and copy the value</li></ol><figure><img alt="A screenshot of the IexFinance console with API keys" class="image_Pw1y margin_Rc0b shadow_7z-4" height="285" src="/img/blog/2021-03-09/iex-finance-api.png" width="650"></figure><p>Now we can add this token to our project, so the Python scripts have
programmatic access to the IexFinance API. To store project secrets, we are
using the <a href="https://pypi.org/project/python-dotenv/" target="_blank" rel="noopener noreferrer">Python dotenv</a> package,
which allows passing configuration to Python scripts as environment variables.
We can explicitly pass a token to each API call to IexFinance, or we can use the
<code>IEX_TOKEN</code> environment variable that the Python library will check implicitly.
To add the token:</p><ol><li>Create a new file <code>./python/.env</code></li><li>Paste the token in the <code>.env</code> file in the format <code>IEX_TOKEN=Skwf93hD...</code></li><li>Run the live market data example:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> python</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">python stock_data_TSLA_example.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>If the markets are open, real-time prices will be sent to QuestDB:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI log"><div tabindex="0" class="prism-code language-log codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Inserting rows into table &#x27;stock_prices&#x27; - press Ctrl-C to stop</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Inserting into &#x27;stock_prices&#x27;: TSLA 673.58 2021-03-10 12:37:23.147258</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="slack-incoming-webhook"></a>Slack incoming webhook<a class="hash-link" href="#slack-incoming-webhook" title="Direct link to heading">#</a></h2><p>The next step is to create an incoming webhook in Slack to send alerts as
HTTP(S) requests from Grafana. To set up the webhook:</p><ol><li>Navigate to the
<a href="https://api.slack.com/apps?new_app=1" target="_blank" rel="noopener noreferrer">create a new Slack app</a> page and
create an app called <strong>Price Alerts</strong> for your workspace</li><li>Click <strong>Incoming Webhooks</strong> in the features section</li><li>Activate incoming webhooks and click <strong>Add New Webhook to Workspace</strong></li><li>Select the Slack channel you want to receive alerts in and click <strong>Allow</strong></li><li>Copy the Webhook URL which is in the following format</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">https://hooks.slack.com/services/T123/B0123/2Fb</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="grafana-notification-channels"></a>Grafana notification channels<a class="hash-link" href="#grafana-notification-channels" title="Direct link to heading">#</a></h2><p>The final step in connecting Slack and Grafana is to create a notification
channel. To configure a Slack notification channel to send alerts to:</p><ol><li>Log in to Grafana at <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">localhost:3000</a> using the
default credentials:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><div tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">user:admin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pass:admin</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><ol start="2"><li>Navigate to
<a href="http://localhost:3000/alerting/notifications" target="_blank" rel="noopener noreferrer">notification channels</a> and
click <strong>Add channel</strong></li><li>Give it the name <strong>Stock Price Alert</strong> and choose the <code>Slack</code> type</li><li>Paste the webhook URL in the <strong>Url</strong> field</li><li>In the <strong>Notification settings</strong> dropdown, enable the <strong>Include image</strong>
checkbox</li><li>Click <strong>Test</strong> to verify that the configuration is correct and then click
<strong>Save</strong></li></ol><p>Your Slack workspace should display a test notification coming from Grafana:</p><figure><img alt="A test Slack notification from Grafana with example error information and a chart" class="image_Pw1y margin_Rc0b shadow_7z-4" height="407" src="/img/blog/2021-03-09/webhook.png" width="450"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="grafana-alerts"></a>Grafana alerts<a class="hash-link" href="#grafana-alerts" title="Direct link to heading">#</a></h2><p>Next up, we can create a new panel on Grafana and configure alerts based on
queries we&#x27;re interested in:</p><ol><li>Navigate to <a href="http://localhost:3000/dashboard/new" target="_blank" rel="noopener noreferrer">Create new Dashboard</a> and
click <strong>+ Add new panel</strong></li><li>In the <strong>Query</strong> panel, click the pencil icon or click <strong>Edit SQL</strong></li><li>Paste the following example query</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT createdDatetime time,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">       round(avg(stockPrice),2) avgPrice</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM stock_prices</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE stock = &#x27;TSLA&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY 5s;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We now have a visualization of five-second averages of Tesla&#x27;s stock price:</p><figure><img alt="A dashboard in Grafana showing Tesla stock price over time" class="image_Pw1y margin_Rc0b shadow_7z-4" height="459" src="/img/blog/2021-03-09/graphing-tsla-over-time.png" width="650"></figure><p>To make sure we don&#x27;t lose our visualization panel, click <strong>Save</strong> and give the
dashboard a name of our choice.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="rules-and-conditions"></a>Rules and conditions<a class="hash-link" href="#rules-and-conditions" title="Direct link to heading">#</a></h3><p>To understand how alerts work, let&#x27;s take a brief look at the concepts. The two
main components for setting up alerts are the alert <strong>Rule</strong> and <strong>Conditions</strong>.</p><p>The <strong>Rule</strong> has the following settings:</p><ul><li><code>Name</code> to give the alert a descriptive title</li><li><code>Evaluate every</code> is how often the scheduler will evaluate the alert rule</li><li><code>for</code> specifies how long the query needs to violate the thresholds before
triggering alert notifications</li></ul><p>The <strong>Conditions</strong> section has the following settings:</p><ul><li><code>WHEN</code> sets an aggregate function on a series</li><li><code>OF</code> is the query to alert on over a time range in the format
<code>query(query_name, from, until)</code></li><li><code>IS ...</code> allows specifying a comparison to a value or range</li></ul><p>For more information on the conditions of alerting, see the Grafana
<a href="https://grafana.com/docs/grafana/latest/alerting/create-alerts/#conditions" target="_blank" rel="noopener noreferrer">alert conditions documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-an-alert"></a>Create an alert<a class="hash-link" href="#create-an-alert" title="Direct link to heading">#</a></h3><p>The example alert we are using in this tutorial will be triggered if the minimum
value of the query named <code>5-second Avg. of TSLA</code> is below <code>762</code>, and we will set
the time range for alerting to the last thirty seconds. To set up this alert:</p><ol><li>Edit the query and select the <strong>Alert</strong> tab</li><li>Click <strong>Create Alert</strong> and give it the name <code>Tesla Stock Price alert</code></li><li>In the <strong>Rule</strong> section:<ul><li>Set <strong>Evaluate every</strong> to <code>10 seconds</code></li><li>Set <strong>for</strong> to <code>30 seconds</code></li></ul></li><li>In the <strong>Conditions</strong> section:<ul><li>Set <strong>WHEN</strong> to <code>min()</code></li><li>Set <strong>OF</strong> to <code>query(5-second Avg. of TSLA, 30s, now())</code></li><li>Click <strong>IS ABOVE</strong>, change this to <strong>IS BELOW</strong>, and set the value to <code>762</code></li></ul></li><li>Use the default values in the <strong>No Data &amp; Error Handling</strong> section</li><li>In <strong>Notifications -&gt; Send to</strong>, choose the <code>Stock Price Alerts</code> notification
channel</li><li>Add an optional message to be delivered with the alert</li></ol><figure><img alt="Configuration settings for alerting in Grafana based on Tesla stock prices over the last 30 seconds" class="image_Pw1y margin_Rc0b shadow_7z-4" height="666" src="/img/blog/2021-03-09/configuring-alert.png" width="650"></figure><p>When the conditions of the alert are met, we will see Slack notifications
arriving in the channel that we have configured:</p><figure><img alt="A Slack notification displaying an alert from Grafana that Tesla stock price has exceeded a threshold" class="image_Pw1y margin_Rc0b shadow_7z-4" height="221" src="/img/blog/2021-03-09/slack-alert.png" width="650"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>In this tutorial, we&#x27;ve shown how Grafana and QuestDB can be quite powerful for
data visualization and alerting. We learned how to ingest live ticker data from
a REST API into QuestDB and how to visualize this data in a Grafana dashboard
and set up alerts based on predefined conditions.</p><p>The next steps for improvements to the Python scripts could be command-line
arguments for multiple stock symbols, and better error handling if markets are
not open. Feel free to
<a href="https://github.com/questdb/questdb-slack-grafana-alerts" target="_blank" rel="noopener noreferrer">submit a PR</a> if you
have a suggestion or improvements to make!</p><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback or just come and say hello in the
<a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/python">python</a><a class="margin-horiz--sm" href="/blog/tags/grafana">grafana</a><a class="margin-horiz--sm" href="/blog/tags/marketdata">marketdata</a><a class="margin-horiz--sm" href="/blog/tags/alerting">alerting</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/03/18/questdb-and-prometheus-on-gke-autopilot"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Running QuestDB and Prometheus on GKE Autopilot</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/02/18/realtime-crypto-tracker-with-kafka-and-questdb"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Realtime crypto tracker with Kafka and QuestDB »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.a0cde2ea.js" defer="defer"></script>
<script src="/gitplechat.js"></script>
</body>
</html>