<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Automating ETL jobs on time series data with QuestDB on Google Cloud Platform | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Automating ETL jobs on time series data with QuestDB on Google Cloud Platform | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Learn how to build an ETL job using Cloud Functions to extract data, remove personally-identifiable information, and load the transformed time series data into QuestDB."><meta data-react-helmet="true" name="twitter:description" content="Learn how to build an ETL job using Cloud Functions to extract data, remove personally-identifiable information, and load the transformed time series data into QuestDB."><meta data-react-helmet="true" property="og:description" content="Learn how to build an ETL job using Cloud Functions to extract data, remove personally-identifiable information, and load the transformed time series data into QuestDB."><meta data-react-helmet="true" name="twitter:title" content="Automating ETL jobs on time series data with QuestDB on Google Cloud Platform | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Automating ETL jobs on time series data with QuestDB on Google Cloud Platform | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,etl,googlecloud"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-google-cloud-functions.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-google-cloud-functions.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Automating ETL jobs on time series data with QuestDB on Google Cloud Platform</h1><time datetime="2021-03-31T00:00:00.000Z" class="date_A31P">March 31, 2021 · 16 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/gabor-boros" alt="Gábor Boros"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/" target="_blank" rel="noopener noreferrer">Gábor Boros</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A display showing a dashboard with various analytics charts." class="image_1-Fc image--title_Z46g" height="467" src="/img/blog/2021-03-31/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/photos/qwtCeJ5cLYs" target="_blank" rel="noopener noreferrer">Stephen Dawson</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This submission comes from one of our community contributors
<a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer">Gábor Boros</a> who has put together another
excellent tutorial showing how to use cloud functions together with QuestDB to
build a custom ETL job that runs on time series data. The corresponding
repository for this tutorial with code examples is available to
<a href="https://github.com/gabor-boros/questdb-etl-jobs" target="_blank" rel="noopener noreferrer">browse on GitHub</a>.</p><p>Thanks for another great contribution, Gábor!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>In the world of big data, software developers and data analysts often have to
write scripts or complex software collections to process data before sending it
to a data store for further analysis. This process is commonly called ETL, which
stands for Extract, Transform and Load.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="what-are-etl-jobs-for"></a>What are ETL jobs for?<a class="hash-link" href="#what-are-etl-jobs-for" title="Direct link to heading">#</a></h2><p>Let&#x27;s consider the following example: a medium-sized webshop with a few thousand
orders per day exports order information hourly. After a while, we would like to
visualize purchase trends, and we might want to share the results between
departments or even publicly. Since the exported data contains personally
identifiable information (PII), we should anonymize it before using or exposing
it to the public.</p><p>For the example above, we can use an ETL job to extract the incoming data,
remove any PII and load the transformed data into a database used as the data
visualization backend later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>During this tutorial, we will use Python to write the cloud functions, so basic
python knowledge is essential. Aside from these skills, you will need the
following resources:</p><ul><li>A <a href="https://console.cloud.google.com/getting-started" target="_blank" rel="noopener noreferrer">Google Cloud Platform</a>
(GCP) account and a GCP Project.</li><li>Enable the
<a href="https://console.cloud.google.com/marketplace/product/google/cloudbuild.googleapis.com" target="_blank" rel="noopener noreferrer">Cloud Build API</a> -
when enabling APIs <strong>ensure that the correct GCP project is selected</strong>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="creating-an-etl-job"></a>Creating an ETL job<a class="hash-link" href="#creating-an-etl-job" title="Direct link to heading">#</a></h2><p>As an intermediate data store where the webshop exports the data, we will use
Google Storage and use Google Cloud Functions to transform it before loading it
into QuestDB.</p><figure><img alt="A diagram showing the flow of information and services used in this tutorial" class="image_Pw1y margin_Rc0b shadow_7z-4" height="118" src="/img/blog/2021-03-31/workflow.png" width="650"></figure><p>We won&#x27;t be building a webshop or a data exporter for an existing webshop, but
we will use a script to simulate the export to Google Storage. In the following
sections, we will set up the necessary components on GCP. Ensure the required
APIs mentioned in the prerequisites are enabled, and that you have selected the
GCP project in which you would like to create the tutorial resources.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-compute-engine-instance-for-questdb"></a>Create a Compute Engine instance for QuestDB<a class="hash-link" href="#create-a-compute-engine-instance-for-questdb" title="Direct link to heading">#</a></h3><p>First things first, we start with installing QuestDB on a virtual machine. To
get started, navigate to the
<a href="https://console.cloud.google.com/compute/instances" target="_blank" rel="noopener noreferrer">Compute Engine console</a>.
Visiting this page for the first time will take a few moments to initialize.
After the loading indicator has gone, start a new virtual machine:</p><ol><li>Click on <strong>create</strong> and give the instance the name <code>questdb-vm</code></li><li>Select a region that&#x27;s geographically close to you</li><li>Select the first generation &quot;N1&quot; series</li><li>Choose the <code>f1-micro</code> machine type - in a production environment you would
choose a more performant instance, but this is sufficient for example
purposes</li><li>In the &quot;Container&quot; section, check &quot;Deploy a container image to this VM
instance&quot;, and enter <code>questdb/questdb:latest</code></li><li>In the &quot;Firewall&quot; section, click on &quot;Management, security, disks, networking,
sole tenancy&quot;</li><li>In the new panel, select &quot;Networking&quot; and add <code>questdb</code> as a &quot;Network tag&quot;</li><li>Leave all other settings with their defaults, and click on &quot;create&quot;</li></ol><p>Make sure you note the &quot;External IP&quot; of the instance as we will need that later.</p><figure><img alt="The Google Cloud console UI showing QuestDB running on a Compute Engine instance" class="image_Pw1y margin_Rc0b shadow_7z-4" height="147" src="/img/blog/2021-03-31/compute-engine.png" width="650"></figure><p>After a short time, the new instance will be up and running. As soon as the
instance is provisioned, we can initiate a remote session to install QuestDB by
clicking <strong>ssh</strong> in the VM panel.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="allow-networking-on-the-instance"></a>Allow networking on the instance<a class="hash-link" href="#allow-networking-on-the-instance" title="Direct link to heading">#</a></h3><p>If we try to open the web console by opening the <code>http://&lt;EXTERNAL_IP&gt;:9000</code>
(where <code>&lt;EXTERNAL_IP&gt;</code> is the external IP of your virtual machine) it won&#x27;t load
and we will face a timeout. The reason behind this is that the firewall is not
opened for port <code>9000</code> yet.</p><p>To allow port <code>9000</code> used by QuestDB, we must allow the port by adding a new
firewall rule on the
<a href="https://console.cloud.google.com/networking/firewalls/list" target="_blank" rel="noopener noreferrer">firewall console</a>:</p><ol><li>Click on &quot;create firewall rule&quot; at the top of the page</li><li>Give the rule the name &quot;QuestDBPorts&quot;</li><li>In the &quot;Target tags&quot; field, write the same tag used for instance creation
(<code>questdb</code>)</li><li>For the &quot;Source IP ranges&quot; field, set <code>0.0.0.0/0</code></li><li>In the &quot;Protocols and ports&quot; section, select <strong>tcp</strong> and set port to
<code>9000,8812</code></li><li>Click on &quot;create&quot;</li></ol><p>Some seconds later, the rule will be applied on every instance with the matching
<code>questdb</code> tag and port <code>9000</code> will be open. You may ask what port <code>8812</code> is for;
this port will be used by the Cloud Function later to connect to the database.</p><p>If you try to open the interactive console again, you should see the
<a href="/docs/develop/web-console">QuestDB Web Console</a> and start writing queries.
As our first query, create the table in which the Cloud Function will write the
anonymized data. To create the table run the following SQL statement:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">CREATE TABLE</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    purchases(buyer STRING,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            item_id INT,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            quantity INT,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            price INT,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            purchase_date TIMESTAMP)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    timestamp(purchase_date);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The query above uses <code>timestamp(purchase_date)</code> to set a designated timestamp on
the table so we can easily perform time series analysis in QuestDB. For more
information on designated timestamps, see the official
<a href="/docs/concept/designated-timestamp">QuestDB documentation for timestamp</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-storage-bucket"></a>Create a Storage bucket<a class="hash-link" href="#create-a-storage-bucket" title="Direct link to heading">#</a></h3><p>Now, we create the bucket where we will store the simulated webshop data.
Storage buckets are in a single global namespace in GCP, which means that the
bucket&#x27;s name must be unique across all GCP customers. You can read more about
Storage and buckets on Google&#x27;s
<a href="https://cloud.google.com/storage/docs" target="_blank" rel="noopener noreferrer">documentation</a> site.</p><p>To create a new bucket:</p><ol><li>Navigate to the
<a href="https://console.cloud.google.com/storage" target="_blank" rel="noopener noreferrer">cloud storage console</a></li><li>Select your project if not selected yet</li><li>Click on &quot;create bucket&quot; and choose a unique name</li><li>Select the same region as the instance above</li><li>Leave other settings on default and click on &quot;continue&quot; to create the bucket</li></ol><p>If you successfully created the bucket, it should show up in the storage browser
as you can see below.</p><figure><img alt="A new bucket storage resource on Google Cloud Platform" class="image_Pw1y margin_Rc0b shadow_7z-4" height="120" src="/img/blog/2021-03-31/bucket-storage.png" width="650"></figure><p>At this point, we don&#x27;t set any permissions, ACLs, or visibility settings on the
bucket, but we will come back to that later.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-cloud-function"></a>Create a Cloud Function<a class="hash-link" href="#create-a-cloud-function" title="Direct link to heading">#</a></h3><p>We have the bucket to upload the data, but we have nothing to process the data
yet, and for this, we will use Cloud Functions to remove the PII.</p><p>Cloud Functions are functions as a service (FaaS) solution within GCP, similar
to AWS Lambda. The functions are triggered by an event that can come from
various sources. Our scenario Cloud Functions are convenient since we don&#x27;t need
to pay for a server to run all day, which is mostly idle; the function will be
executed when the trigger event is fired, and we only pay for the execution time
the number of function calls.</p><p>To create a Cloud Function:</p><ol><li>Navigate to
<a href="https://console.cloud.google.com/functions/list" target="_blank" rel="noopener noreferrer">cloud functions console</a></li><li>Click on &quot;create function&quot; and give it the name <code>remove-pii</code></li><li>Select the region we are using for other resources</li><li>For &quot;Trigger&quot; select &quot;Cloud Storage&quot; from the dropdown list</li><li>Set the event type to &quot;Finalise/Create&quot;</li><li>Choose the bucket created above and click &quot;variables, networking, and
advanced settings&quot;</li><li>Select &quot;environment variables&quot; on the tabbed panel</li><li>Click on &quot;add variable&quot; right below the &quot;Runtime environment variables&quot;
section</li><li>Add a new variable called <code>DATABASE_URL</code> with the value
<code>postgresql://admin:quest@&lt;EXTERNAL_IP&gt;:8812/qdb</code>, where <code>&lt;EXTERNAL_IP&gt;</code> is
the external IP of your virtual machine</li><li>Click &quot;save&quot; then &quot;next&quot;</li></ol><figure><img alt="Creating a new Cloud Function on Google Cloud Platform for an ETL job" class="image_Pw1y margin_Rc0b shadow_7z-4" height="586" src="/img/blog/2021-03-31/create-cloud-function.png" width="450"></figure><p>The next step is to select the runtime our function will use and provide the
code. On this page, we can choose between numerous runtimes, including multiple
versions of Python, Node.js, Go, Ruby, and even Java.</p><p>Since this tutorial uses Python, select <strong>Python 3.8</strong> as it is the latest
non-beta version at the time of writing. Leave the rest of the settings as
default, and write the function in the next section. Click &quot;deploy&quot; at the
bottom of the page. Some seconds later, you will see that the deployment of the
function is in progress.</p><figure><img alt="Deploying a Python3.8 Cloud Function on Google Cloud Platform" class="image_Pw1y margin_Rc0b shadow_7z-4" height="150" src="/img/blog/2021-03-31/deploying-cloud-function.png" width="550"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="generating-and-processing-data"></a>Generating and processing data<a class="hash-link" href="#generating-and-processing-data" title="Direct link to heading">#</a></h2><p>Before moving on, here&#x27;s a quick recap on what we did so far:</p><ul><li>Set up a new Google Storage bucket</li><li>Created the Cloud Function which will process the data later on</li><li>Connected the bucket with the function to trigger on a new object is created
on the bucket</li></ul><p>Now for the fun part of the tutorial: writing the data processing script and
loading the data in the database. Let&#x27;s write the function to remove PII, but
first, talk a bit about the data&#x27;s structure.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="inspecting-the-data"></a>Inspecting the data<a class="hash-link" href="#inspecting-the-data" title="Direct link to heading">#</a></h3><p>ETL jobs, by their nature, heavily depend on the structure of incoming data. A
job may process multiple data sources, and data structure can vary per source.
The data structure we will use is simple, we have a CSV file with the following
columns:</p><ul><li>customer email address</li><li>purchase date</li><li>item ID for the purchased item</li><li>quantity</li><li>the price per item</li></ul><p>As you see, there is no currency column since we will assume every price is in
one currency. To generate random data, you can use the
<a href="https://github.com/gabor-boros/questdb-etl-jobs/blob/e47b5f3191c8648f486cea207b317c92899c3bd1/data_generator.py" target="_blank" rel="noopener noreferrer">provided script</a>
written for this tutorial.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="writing-cloud-functions"></a>Writing cloud functions<a class="hash-link" href="#writing-cloud-functions" title="Direct link to heading">#</a></h3><p>By now, we have everything to write the data transformer function and test how
well the PII removal performs. We will work in the &quot;inline editor&quot; of the cloud
function, so as a first step, open the edit the cloud function created above by
navigating to the
<a href="https://console.cloud.google.com/functions/list" target="_blank" rel="noopener noreferrer">cloud functions console</a> and
clicking on the function&#x27;s name. That will open the details of the function. At
the top, click on &quot;edit&quot;, then at the bottom, click on &quot;next&quot; to open the
editor.</p><p>Let&#x27;s start with the requirements. On the left-hand side, click on the
<code>requirements.txt</code> and paste the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI txt"><div tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">google-cloud-storage==1.36.2</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">psycopg2==2.8.6</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sqlalchemy==1.4.2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Here we add the required packages to connect to Google Storage and QuestDB.
Next, click on <code>main.py</code>, remove its whole content and start adding the
following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> csv</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> hashlib</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> json</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> logging</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> os</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> dataclasses </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> dataclass</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> List</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cloud </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> storage</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> sqlalchemy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">sql </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> text</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> sqlalchemy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">engine </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Connection</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> create_engine</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">logger </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Create a database engine</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">engine </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> create_engine</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;DATABASE_URL&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As you may expect, we start with the imports, but we added two extra lines: one
for the logger and one for configuring the database engine. We will need the
logger to log warnings and exceptions during the execution, while we will use
the engine later to insert anonymized data into the database.</p><p>To make our job easier, we are going to add a data class, called <code>Record</code>. This
data class will be used to store the parsed and anonymized CSV data for a line
of the uploaded file.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@dataclass</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">class</span><span class="token plain"> </span><span class="token class-name">Record</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    buyer</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    item_id</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    quantity</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    price</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    purchase_date</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As we discussed, ETL jobs are validating the data that they receive as input. In
our case, we will trigger the function if an object is created on the storage.
This means any object, like a CSV, PDF, TXT, PNG file, or even a directory, is
created, though we only want to execute CSV files&#x27; transformation. To validate
the incoming data, we write two simple validator functions:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">is_event_valid</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">dict</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">bool</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Validate that the event has all the necessary attributes required for the</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    execution.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    attributes </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">keys</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    required_parameters </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;bucket&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;contentType&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;name&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;size&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">all</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">parameter </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> attributes </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> parameter </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> required_parameters</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">is_object_valid</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">dict</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">bool</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Validate that the finalized/created object is a CSV file and its size is</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    greater than zero.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    has_content </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;size&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    is_csv </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;contentType&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;text/csv&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> has_content </span><span class="token keyword" style="color:#ff79c6">and</span><span class="token plain"> is_csv</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The first function will validate that event has all the necessary parameters,
while the second function checks that the object created and triggered the event
is a CSV and has any content. The next function we create is used to get an
object from the storage which, in our case, the file triggered the event:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">get_content</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bucket</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> storage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Bucket</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Get the blob from the bucket and return its content as a string.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    blob </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> bucket</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get_blob</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> blob</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">download_as_string</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;utf-8&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Anonymizing the data, in this scenario, is relatively easy, though we need to
ensure we can build statistics and visualizations later based on this data, so
the anonymized parts should be consistent for a user. To achieve this, we will
hash the buyer&#x27;s email address, so nobody may track it back to the person owning
the email, but we can use it for visualization:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">anonymize_pii</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> Record</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Unpack and anonymize data.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    email</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> quantity</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> price</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> purchase_date </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> row</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Anonymize email address</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    hashed_email </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> Record</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        buyer</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">hashed_email</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        item_id</span><span class="token operator" style="color:#ff79c6">=</span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">item_id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        quantity</span><span class="token operator" style="color:#ff79c6">=</span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">quantity</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        price</span><span class="token operator" style="color:#ff79c6">=</span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">price</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        purchase_date</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">purchase_date</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>So far, we have functions to validate the data, get the file&#x27;s content which
triggered the Cloud Function, and anonymize the data. The next thing we need to
be able to do is to load the data into our database. Up to this point, every
function we have wrote was simple, and this one is no exception:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">write_to_db</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Connection</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> record</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Record</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Write the records into the database.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    INSERT INTO purchases(buyer, item_id, quantity, price, purchase_date)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    VALUES(:buyer, :item_id, :quantity, :price, to_timestamp(:purchase_date, &#x27;yyyy-MM-ddTHH:mm:ss&#x27;));</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">**</span><span class="token plain">record</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">__dict__</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> exc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># If an error occures, log the exception and continue</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">exception</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;cannot write record&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> exc_info</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">exc</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As you see, writing to the database is easy. We get the connection and the
record we need to write into the database, prepare the query and execute it. In
case of an exception, we don&#x27;t want to block the whole processing, so we catch
the exception, log it and let the script go on. If an exception occurred, we can
check it later and fix the script or load the data manually.</p><p>The last bit is the glue code, which brings together these functions. Let&#x27;s have
a look at that:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">entrypoint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">dict</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Triggered by a creation on a Cloud Storage bucket.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Check if the event has all the necessary parameters. In case any of the</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># required parameters are missing, return early not to waste execution time.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">not</span><span class="token plain"> is_event_valid</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;invalid event: %s&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> json</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    file_path </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;name&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Check if the created object is valid or not. In case the object is invalid</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># return early not to waste execution time.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">not</span><span class="token plain"> is_object_valid</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;invalid object: %s&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    storage_client </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> storage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Client</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    bucket </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> storage_client</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get_bucket</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;bucket&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    data </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> get_content</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bucket</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    reader </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> csv</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">reader</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">splitlines</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Anonymize PII and filter out invalid records</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    records</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Record</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">filter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">lambda</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">anonymize_pii</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Write the anonymized data to database</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> engine</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> record </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> records</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            write_to_db</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> record</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In the example above, we call the two validators to ensure it worth processing
the data, and we get the file path from the event. After that we initialize the
client used to connect to Google Storage, then we get the object&#x27;s content,
parse the CSV file, and anonymize the content of it.</p><p>Last but not least, we connect to the database - defined by the <code>DATABASE_URL</code>
configured for the engine and write all records to the database one by one.</p><p>As you see, the entrypoint of the function has been changed as well. In the text
box called &quot;Entrypoint&quot; set the entrypoint as a function name to call. The
entrypoint is the function that will be called by Cloud Functions when an event
is triggered.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="running-the-full-example"></a>Running the full example<a class="hash-link" href="#running-the-full-example" title="Direct link to heading">#</a></h2><p>We are close to finishing this tutorial, so it&#x27;s time to test our Cloud
Function.</p><p>To test the Cloud Function:</p><ol><li>Download the
<a href="https://github.com/gabor-boros/questdb-etl-jobs/blob/e47b5f3191c8648f486cea207b317c92899c3bd1/data_generator.py" target="_blank" rel="noopener noreferrer">pre-made script</a>
and run it to generate random data.</li><li>Navigate to the bucket you created</li><li>Above the list of objects in the bucket (which should be empty) click on
&quot;upload files&quot;</li><li>Select and upload the randomly-generated data</li><li>After the file is uploaded, visit the
<a href="https://console.cloud.google.com/functions/list" target="_blank" rel="noopener noreferrer">Cloud Functions console</a></li><li>Click on the actions button and select &quot;view logs&quot;</li><li>Navigate to <code>http://&lt;EXTERNAL_IP&gt;:9000</code>, where <code>&lt;EXTERNAL_IP&gt;</code> is the
external IP of your virtual machine</li></ol><p>We can now execute the following SQL query:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT * FROM purchases ORDER BY purchase_date;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As you can see, the data is loaded and we have no PII there. By creating a
simple chart, we can even observe trends in the generated data, how our
imaginary buyers purchased items on the webshop.</p><figure><img alt="Visualizing SQL query results in the QuestDB Web Console" class="image_Pw1y margin_Rc0b shadow_7z-4" height="320" src="/img/blog/2021-03-31/visualizing-data.png" width="650"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>We&#x27;ve installed QuestDB on Google Cloud Platform, set up a Google Storage bucket
to store the simulated purchase data exports, built an ETL job that anonymized
our buyers&#x27; data, and loaded it into a time series database, QuestDB. Data
analysts could write more jobs as Cloud Functions in multiple languages and set
up multiple sources. It&#x27;s also possible to set QuestDB&#x27;s HTTP endpoints to
read-only which would allow us to share this dashboard without worrying about
destructive commands.</p><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback, browse the
<a href="https://github.com/gabor-boros/questdb-etl-jobs" target="_blank" rel="noopener noreferrer">GitHub repository for this tutorial</a>,
or come and say hello in the <a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/etl">etl</a><a class="margin-horiz--sm" href="/blog/tags/googlecloud">googlecloud</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/04/12/stream-ethereum-data"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Streaming on-chain Ethereum data to QuestDB</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/03/18/questdb-and-prometheus-on-gke-autopilot"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Running QuestDB and Prometheus on GKE Autopilot »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.a0cde2ea.js" defer="defer"></script>
<script src="/gitplechat.js"></script>
</body>
</html>