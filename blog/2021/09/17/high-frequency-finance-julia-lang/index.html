<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">High frequency finance with Julia and QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="High frequency finance with Julia and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Learn how to use QuestDB as a time series database for high-frequency trading, calculate the limit order book, price impact, trade sign distribution, and other concepts via the Julia programming language."><meta data-react-helmet="true" name="twitter:description" content="Learn how to use QuestDB as a time series database for high-frequency trading, calculate the limit order book, price impact, trade sign distribution, and other concepts via the Julia programming language."><meta data-react-helmet="true" property="og:description" content="Learn how to use QuestDB as a time series database for high-frequency trading, calculate the limit order book, price impact, trade sign distribution, and other concepts via the Julia programming language."><meta data-react-helmet="true" name="twitter:title" content="High frequency finance with Julia and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;High frequency finance with Julia and QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="julia,finance,timeseries,database,algotrading"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2021-09-17/banner.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2021-09-17/banner.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a><a class="navbar__item navbar__link" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">High frequency finance with Julia and QuestDB</h1><time datetime="2021-09-17T00:00:00.000Z" class="date_A31P">September 17, 2021 Â· 11 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/dm13450" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/dm13450" alt="Dean Markwick"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/dm13450" target="_blank" rel="noopener noreferrer">Dean Markwick</a></h4><small class="avatar__subtitle">Guest post</small></div></div></header><div class="markdown"><p>This post was written by Dean Markwick, who has put together an excellent
example using QuestDB as a time series database for high-frequency trading. This
post shows how to use QuestDB to calculate the limit order book, price impact,
trade sign distribution, and other concepts via the Julia programming language.</p><p><em>Originally published at
<a href="https://dm13450.github.io/2021/08/12/questdb-part2.html" target="_blank" rel="noopener noreferrer">Dean&#x27;s personal blog</a>.</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="connecting-to-questdb-from-julia-lang"></a>Connecting to QuestDB from Julia lang<a class="hash-link" href="#connecting-to-questdb-from-julia-lang" title="Direct link to heading">#</a></h2><p>In my first post, I showed how to set up a producer/consumer model to build a
<code>BTCUSD</code> trades database using the CoinbasePro WebSocket feed. Now I&#x27;ll show you
how you can connect to the same database to pull out the data, use some specific
timeseries database queries and hopefully show where this type of database is
helpful by improving some of my old calculations.</p><p>I ingested just over 24 hours worth of data over the 24th and 25th of July,
2021, but I completely missed the massive rally, which is just my luck. That
would have been interesting to look at, but never mind! I&#x27;m going to repeat some
of the calculations from
<a href="http://dm13450.github.io/2021/06/25/HighFreqCrypto.html" target="_blank" rel="noopener noreferrer">older blog posts on high-frequency finance</a>
using more data this time.</p><p>Julia can connect to the database using the
<a href="https://github.com/invenia/LibPQ.jl" target="_blank" rel="noopener noreferrer">LibPQ.jl</a> package and execute queries
using all their functions. This is very handy as we don&#x27;t have to worry about
database drivers or connection methods; we can just connect and go.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">using LibPQ</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">using DataFrames, DataFramesMeta</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">using Plots</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">using Statistics, StatsBase</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">using CategoricalArrays</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The following is the default connection credentials for the database used to
connect to QuestDB:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#262833" class="codeBlockTitle_oQzk">Connection credentials in Julia</div><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">conn = LibPQ.Connection(&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">             dbname=qdb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">             host=127.0.0.1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">             password=quest</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">             port=8812</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">             user=admin&quot;&quot;&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">    PostgreSQL connection </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">CONNECTION_OK</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> with parameters:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      user </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> admin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      password </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> ********************</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      dbname </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> qdb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#8be9fd">host</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">127.0</span><span class="token plain">.0.1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      port </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">8812</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      client_encoding </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> UTF8</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      options </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> -c </span><span class="token assign-left variable" style="color:#ff79c6">DateStyle</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">ISO,YMD -c </span><span class="token assign-left variable" style="color:#ff79c6">IntervalStyle</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">iso_8601 -c </span><span class="token assign-left variable" style="color:#ff79c6">TimeZone</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">UTC</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      application_name </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> LibPQ.jl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      sslmode </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> prefer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      sslcompression </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      gssencmode </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> disable</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      krbsrvname </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> postgres</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      target_session_attrs </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> any</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It&#x27;s very easy; Julia thinks that it is a regular Postgres database. We can
quickly move on to working with the data. I started with getting all trades out
of the database:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">@time trades = execute(conn, &quot;SELECT * FROM coinbase_trades&quot;) |&gt; DataFrame</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">dropmissing!(trades);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">nrow(trades)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It takes about 5 seconds to pull 210,000 rows into the notebook:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token number" style="color:#50fa7b">4.828067</span><span class="token plain"> seconds </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">9.25</span><span class="token plain"> M allocations: </span><span class="token number" style="color:#50fa7b">335.378</span><span class="token plain"> MiB, </span><span class="token number" style="color:#50fa7b">1.64</span><span class="token plain">% gc </span><span class="token function" style="color:#8be9fd">time</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Now we can plot the results and export as a <code>.png</code>:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#262833" class="codeBlockTitle_oQzk">Plot query results in Julia</div><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(trades.timestamp, trades.price, label=:none, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting SQL query results of entire table from QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/sql-connection-via-julia.png" width="650"></figure><p>You can see that <code>Plots.jl</code> struggles a little with formatting the x-axis
correctly with a time series plot above. The timestamps are pretty long labels
which could be better if the text was angled 45 degrees. It&#x27;s a shame that I
missed the sudden rally on Sunday 25th; that was pretty unlucky, but let&#x27;s move
on to updating previous graphs with the new dataset.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="order-sign-correlation"></a>Order sign correlation<a class="hash-link" href="#order-sign-correlation" title="Direct link to heading">#</a></h2><p>The correlation between buys and sells follows a power law. Last time, I only
had 1000 trades to work on after pulling them using the REST API. Now I&#x27;ve got
200x more, which should improve the uncertainty around the previous values.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">ac = autocor(trades.side)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">acplot = plot(1:length(ac), ac, seriestype=:scatter, label = :none, xlab=&quot;Lag&quot;, ylab = &quot;Correlation&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">aclogplot = plot(log.(1:length(ac)), log.(ac), seriestype=:scatter, label=:none, xlab= &quot;log(Lag)&quot;, ylab=&quot;log(Correlation)&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(acplot, aclogplot, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting order sign correlation in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/order-sign-correlation.png" width="650"></figure><p>In the log-log plot, we can see a nice straight line which we fit a linear model
on.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">using GLM</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sideModel = lm(@formula(log(AC) ~ log(Lag)), DataFrame(AC=ac, Lag=1:length(ac)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}}}}, Matrix{Float64}}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">:(log(AC)) ~ 1 + :(log(Lag))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Coefficients:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                 Coef.  Std. Error       t  Pr(&gt;|t|)  Lower 95%  Upper 95%</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">(Intercept)  -0.439012   0.049596    -8.85    &lt;1e-11  -0.538534  -0.339491</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">log(Lag)     -0.70571    0.0156489  -45.10    &lt;1e-42  -0.737112  -0.674308</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This time we&#x27;ve got a ğ›¾ value of 0.7 with more certainty.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(log.(1:length(ac)), log.(ac), seriestype=:scatter, label=:none)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot!(log.(1:length(ac)), coef(sideModel)[1] .+ coef(sideModel)[2] .* log.(1:length(ac)),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      label=&quot;Model&quot;, xlab= &quot;log(Lag)&quot;, ylab=&quot;log(Correlation)&quot;, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting order sign correlation in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/order-sign-correlation-2.png" width="650"></figure><p>This lines up nicely with the data and is better than the previous attempt with
just 1000 trades. ğ›¾ is less than one, which means it is a &#x27;long memory&#x27; process,
so trades in the past affect trades in the future for a long time. This is
usually explained as the effect of people breaking up large trades into slices
and executing them bit by bit.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="size-distribution"></a>Size distribution<a class="hash-link" href="#size-distribution" title="Direct link to heading">#</a></h2><p>Again, the size of each trade follows a power-law distribution too. We use a
slightly different method to estimate the exponent, and last time, with just
1000 trades, we struggled to get a stable value. Now, with so much more data, we
can have another crack.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">uSizes = minimum(trades.size):0.05:maximum(trades.size)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">empF = ecdf(trades.size)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">tradesSizePlot = plot((uSizes), (1 .- empF(uSizes)), seriestype=:scatter, label=&quot;P(V &gt; x)&quot;, xlabel=&quot;Trade Size&quot;, ylabel=&quot;Probability&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">tradesSizeLogPlot = plot(log.(uSizes), log.(1 .- empF(uSizes)), seriestype=:scatter, label=&quot;P(V &gt; x)&quot;, xlabel = &quot;log(Trade Size)&quot;, ylabel=&quot;log(Probability)&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(tradesSizePlot, tradesSizeLogPlot, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting size distribution in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/size-distribution.png" width="650"></figure><p>Let&#x27;s use the same Hill estimator as last time:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">function hill_estimator(sizes_sort, k)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    N = length(sizes_sort)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    res = log.(sizes_sort[(N-k+1):N] / sizes_sort[N-k])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    k*(1/sum(res))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">end</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sizes = trades.size</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sizes_sort = sort(sizes)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">bds = 2:100:(length(sizes)-1000-1)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">alphak = [hill_estimator(sizes_sort, k) for k in bds]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(bds, alphak, xlabel=&quot;k&quot;, ylabel=&quot;Alpha&quot;, label=:none, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting size distribution in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/size-distribution-2.png" width="650"></figure><p>It&#x27;s still hard to judge whether it is converging to a value or not. It always
appears to be decreasing no matter the sample size. Maybe I still need more
data, or perhaps I need a better understanding of the Hill estimator!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="market-impact"></a>Market impact<a class="hash-link" href="#market-impact" title="Direct link to heading">#</a></h2><p>I&#x27;ve not been using QuestDB to its full potential, and repeating all my previous
graphs hasn&#x27;t fully exploited the available features. One of those features is
the ability to group by the timestamp across a bucket size (1 second, 5 minutes,
etc.) and aggregate the data. We will use that to try and come up with a better
model of a market impact than I had in my previous post.</p><p>We aggregate the trades into 1-minute buckets and calculate the total volume
traded, the total signed volume (sell trades count as negative), the last price
and also the number of trades in each bucket.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">@time marketimpact = execute(conn,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    &quot;SELECT timestamp, sum(size) as TotalVolume,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sum(size*side) as SignedVolume,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            last(price) as Close,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            count(*) as NTrades</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     FROM coinbase_trades</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    SAMPLE by 1m&quot;) |&gt; DataFrame</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">dropmissing!(marketimpact)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">marketimpact[1:3, :]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This took less than a second and is a really easy line of code to write:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">  0.223987 seconds (167.29 k allocations: 8.708 MiB, 56.20% compilation time)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><table><thead><tr><th>timestamp</th><th>TotalVolume</th><th>SignedVolume</th><th>Close</th><th>NTrades</th></tr></thead><tbody><tr><td>DateTimâ€¦</td><td>Float64</td><td>Float64</td><td>Float64</td><td>Int64</td></tr><tr><td>2021-07-24T08:50:34.365</td><td>1.75836</td><td>-0.331599</td><td>33649.0</td><td>52</td></tr><tr><td>2021-07-24T08:51:34.365</td><td>4.18169</td><td>-3.01704</td><td>33625.2</td><td>67</td></tr><tr><td>2021-07-24T08:52:34.365</td><td>0.572115</td><td>-0.325788</td><td>33620.1</td><td>46</td></tr></tbody></table><p>Now for the market impact calculation, we calculated the return bucket to bucket
and normalise the signed volume by the total volume traded to give a value of
between -1 and 1. This is taken from <a href="https://arxiv.org/pdf/1206.0682.pdf" target="_blank" rel="noopener noreferrer">https://arxiv.org/pdf/1206.0682.pdf</a> and
equation 26.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">marketimpact[!, :returns] .= 1e4.*[NaN; diff(log.(marketimpact.Close))]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">marketimpact[!, :NormVolume] .= marketimpact[!, :SignedVolume] ./ marketimpact[!, :TotalVolume]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">miModel = lm(@formula(returns ~ NormVolume + 0), marketimpact[2:end, :])</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}}}}, Matrix{Float64}}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">returns ~ 0 + NormVolume</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Coefficients:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">              Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">NormVolume  4.55478    0.290869  15.66    &lt;1e-51     3.9843    5.12526</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Here we can see that there is a positive coefficient, Î¸ in the paper, as
expected, and we can interpret this at how much the price moves after buying or
selling. Specifically, in these minute buckets, those that contained only buy
trades moved the market up by 4.5bps and the same for sells in the opposite
direction.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(marketimpact.NormVolume, marketimpact.returns, seriestype=:scatter, label=:none,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     xlab=&quot;Normalised Volume&quot;, ylab=&quot;Market Impact (log(bps))&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot!(-1:0.1:1, coef(miModel)[1] .* collect(-1:0.1:1), label=&quot;Model&quot;, linewidth=3, legend=:topleft, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting market impact in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/market-impact.png" width="650"></figure><p>You can see how the model lines of with the data, and there is a very slight
trend that is picked. So overall, a better, if still a very simple model of
market impact.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="trades-with-top-of-book"></a>Trades with top of book<a class="hash-link" href="#trades-with-top-of-book" title="Direct link to heading">#</a></h2><p>I&#x27;ve saved down the best bid and offer using the same process as Part 1 of this
series. Over the same period, the best bid and offer data has 17 million rows;
quite a bit more. I use this best bid-offer data to do an ASOF join. ASOF joins
take two tables and joins them such that the timestamps align or the previous
observation is used. In our case, we can take the trades, join it with the best
bid and best offer table to get where the mid-price was at the time of the
trade.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">@time trades2 = execute(conn, &quot;SELECT * FROM coinbase_trades ASOF JOIN coinbase_bbo&quot;) |&gt; DataFrame</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">dropmissing!(trades2);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">  9.745210 seconds (18.49 M allocations: 671.544 MiB, 1.84% gc time)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This took 11 seconds but was all done in the database, so no issue with blowing
out the memory after pulling it into your Julia session. Doing a regular join in
Julia would only match timestamps exactly, whereas we want the last observed
bid/offer price at least making the <code>ASOF</code> function very useful.</p><p>We now calculate a mid-price, how far the traded price was from the mid-price,
and add an indicator for what quantile the trade size landed. We then group by
this quantile indicator and calculate the average trade size and the average
distance from the mid-price.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">trades2[!, :Mid] .= (trades2.bid .+ trades2.ask)./2;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">trades2[!, :Cost] .= 1e4 .* trades2.side .* ((trades2.price .- trades2.Mid) ./ (trades2.Mid))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">trades2[!, :SizeBucket] .= cut(trades2[!, :size], [quantile(trades2[!, :size], 0:0.1:1); Inf])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">gdata = groupby(@where(trades2, :Cost .&gt; 0), :SizeBucket)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">costData = @combine(gdata, MeanSize = mean(:size), MeanCost = mean(:Cost))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">logCostPlot = plot(log.(costData.MeanSize),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                   log.(costData.MeanCost), seriestype=:scatter,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                   label=:none,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                   xlab=&quot;log(Size)&quot;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                   ylab=&quot;log(Cost)&quot;, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting top of book results in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/top-of-book.png" width="650"></figure><p>Unsurprisingly, we can see that larger trades are further away from the
mid-price when they execute. This is because they are eating through the posted
liquidity.</p><p>This is very similar to my <a href="https://cryptoliquiditymetrics.com/" target="_blank" rel="noopener noreferrer">https://cryptoliquiditymetrics.com/</a> sweep the book
graph, which is <em>estimating</em> the cost of eating liquidity. The graph above shows
the <em>actual cost</em> of eating liquidity for real trades that have happened on
Coinbase.</p><p>We can fit a model to this plot, and it is commonly referred to as the square
root law of market impact. We ignore the smaller trade sizes, as they aren&#x27;t
following the nice linear log-log plot.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">costModel = lm(@formula(log(MeanCost) ~ log(MeanSize)),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                     @where(costData, :MeanSize .&gt; exp(-7)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}}}}, Matrix{Float64}}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">:(log(MeanCost)) ~ 1 + :(log(MeanSize))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Coefficients:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                   Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">(Intercept)    -0.534863   0.0683721  -7.82    0.0001  -0.696537  -0.373189</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">log(MeanSize)   0.259424   0.0154468  16.79    &lt;1e-06   0.222898   0.29595</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The ğ›¾ value of 0.25 is pretty low compared to other assets, which we would
expect to be around 0.5. But we haven&#x27;t included the usual volatility
calculation, which is in front of the volume component.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI julia"><div tabindex="0" class="prism-code language-julia codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot(log.(costData.MeanSize),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     log.(costData.MeanCost), seriestype=:scatter,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     label=:none,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     xlab=&quot;log(Size)&quot;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     ylab=&quot;log(Cost)&quot;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">plot!(-8:0.1:3, coef(costModel)[1] .+ coef(costModel)[2] .* (-8:0.1:3),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      label=&quot;Model&quot;, legend=:topleft, fmt=:png)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><figure><img alt="Plotting top of book results in QuestDB via Julia" class="image_Pw1y margin_Rc0b shadow_7z-4" height="598" src="/img/blog/2021-09-17/top-of-book-2.png" width="650"></figure><p>Apart from the small trades, the model lines up well with the increasing trade
size.</p><p>Using this model, you can start to estimate how much a strategy might cost to
implement. The outcome of your strategy is unknown, but your trading costs are
known. If it costs you 1bp to enter and exit a trade (round trip), but you only
think the price will change by 0.5bps, then you&#x27;re at a loss even if you were
100% right on the price direction!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>QuestDB makes working with this data incredibly easy. Both aggregating the data
using <code>SAMPLE BY</code> and joining two datasets using <code>AS OF</code>. Connecting to the
database is a doddle using <code>LibPQ.jl</code>, so you can get up and running without any
issues. These things rarely happen straight out of the box.</p><p>Using this data, I&#x27;ve ramped up the sample sizes, and all my plots and models
look better. Again, all free data and with hopefully, very minimal technical
difficulty. As someone that usually finds themselves drowning in CSVs, QuestDB
has shown how much more efficient things can be when you use a database.</p><hr><p>If you have have feedback or questions about this article, feel free ask in our
<a href="https://slack.questdb.io/" target="_blank" rel="noopener noreferrer">Slack Community</a> or browse the
<a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer">project on GitHub</a> where we welcome
contributions of all kinds.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/finance">finance</a><a class="margin-horiz--sm" href="/blog/tags/crypto">crypto</a><a class="margin-horiz--sm" href="/blog/tags/algotrading">algotrading</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/10/01/hacktoberfest-questdb"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Join Hacktoberfest 2021 and contribute to QuestDB!</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/09/13/release-6-0-5-geospatial-data"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">QuestDB 6.0.5 September release, geospatial support Â»</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">ë¬¸ì˜í•˜ê¸°</h3><p class="description_Bwvi">ì´ë©”ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ì†Œê°œìë£Œë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">ë³´ë‚´ê¸°</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>ì¸í”„ë¼ê´€ë¦¬ë¶€í„° ì„œë¹„ìŠ¤ìš´ì˜ê¹Œì§€ í´ë¼ìš°ë“œí™˜ê²½ì— ìµœì í™”ëœ í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ í”Œë«í¼</p></div><div class="links_1SgP"><div class="category_Ptbh"><span class="title_HpoE">Product</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/cloud/">Cloud</a></li><li><a class="link_vx7p" href="/enterprise/">Enterprise</a></li><li><a class="link_vx7p" href="/pricing/">Pricing</a></li><li><a class="link_vx7p" href="/use-cases/">Use Cases</a></li><li><a class="link_vx7p" href="/customers/">Customers</a></li><li><a class="link_vx7p" href="https://github.com/orgs/questdb/projects/1/views/5" rel="noopener noreferrer" target="_blank">Roadmap</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Developers</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/docs/">Docs</a></li><li><a class="link_vx7p" href="/blog/tags/tutorial/">Tutorials</a></li><li><a class="link_vx7p" href="/blog/">Blog</a></li><li><a class="link_vx7p" href="https://">Discussions</a></li><li><a class="link_vx7p" href="https://">Join Slack</a></li><li><a class="link_vx7p" href="/community/">Swag</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Company</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/about-us/">About us</a></li><li><a class="link_vx7p" href="/careers/">Careers</a></li></ul></div></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright Â© 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.db1fdb94.js" defer="defer"></script>
</body>
</html>