<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Tracking multiple cryptocurrency exchanges using a time series database | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Tracking multiple cryptocurrency exchanges using a time series database | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Leveraging QuestDB’s data ingestion via InfluxDB line protocol to build a high-throughput cryptocurrency price tracker capable of handling out-of-order records on the fly."><meta data-react-helmet="true" name="twitter:description" content="Leveraging QuestDB’s data ingestion via InfluxDB line protocol to build a high-throughput cryptocurrency price tracker capable of handling out-of-order records on the fly."><meta data-react-helmet="true" property="og:description" content="Leveraging QuestDB’s data ingestion via InfluxDB line protocol to build a high-throughput cryptocurrency price tracker capable of handling out-of-order records on the fly."><meta data-react-helmet="true" name="twitter:title" content="Tracking multiple cryptocurrency exchanges using a time series database | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Tracking multiple cryptocurrency exchanges using a time series database | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,crypto,bitcoin,marketdata"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-bitcoin.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-bitcoin.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Tracking multiple cryptocurrency exchanges using a time series database</h1><time datetime="2021-06-18T00:00:00.000Z" class="date_A31P">June 18, 2021 · 7 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/Yitaek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/Yitaek" alt="Yitaek Hwang"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/Yitaek" target="_blank" rel="noopener noreferrer">Yitaek Hwang</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A candlestick chart showing Bitcoin prices in US Dollars" class="image_1-Fc image--title_Z46g" height="467" src="/img/blog/2021-06-18/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/@nick604" target="_blank" rel="noopener noreferrer">Nick Chong</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This submission comes from one of our community contributors
<a href="https://yitaek.medium.com/" target="_blank" rel="noopener noreferrer">Yitaek Hwang</a> who has put together another
excellent tutorial that shows how to stream blockchain data into QuestDB for
time series data visualization and analysis.</p><p>Thanks for another great contribution, Yitaek!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tracking-volatility-using-a-bitcoin-ticker"></a>Tracking volatility using a Bitcoin ticker<a class="hash-link" href="#tracking-volatility-using-a-bitcoin-ticker" title="Direct link to heading">#</a></h2><p>Crypto investors saw 1T USD wiped out of the market in May, as the price of
Bitcoin and other cryptocurrencies nosedived to their lowest in 2021. Given the
volatile nature of this asset class, traders looking to navigate the market need
fast and reliable price data from multiple exchanges. Earlier this year, I
shared a way to
<a href="/blog/2021/02/18/realtime-crypto-tracker-with-kafka-and-questdb">analyze cryptocurrency price trends in real-time</a>
via Kafka and QuestDB. That project polled the Coinbase API for the latest price
and calculated moving averages prior to sending it to a time series database for
further analysis.</p><p>Utilizing Kafka, I was able to leverage its scalability and ordering guarantees
prior to ingesting in QuestDB. However, since I was using the PostgreSQL wire
protocol interface, it was not optimized for fast ingestion. Also, the price
feed was limited to a single exchange (i.e. Coinbase Pro), reducing our ability
to react quickly to volatility such as buying or selling Bitcoin based on best
price on another exchange.</p><p>Fortunately,
<a href="https://github.com/questdb/questdb/releases" target="_blank" rel="noopener noreferrer">QuestDB team released an update</a>
with significant re-write of their InfluxDB Line Protocol for fast ingestion and
support for out-of-order data. So I decided to modify my previous project to
test out these features.</p><p><strong>Disclaimer:</strong> This tutorial is not investment or financial advice. All views
expressed here are my own.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker</a> with at least 4GB memory</li><li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">Node.js</a></li></ul><p><strong>Note:</strong> Memory can be increased on Docker Desktop in <strong>Settings -&gt; Resources
-&gt; Memory</strong> and increasing the default limit from <code>2GB</code> to <code>4GB</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="out-of-order-data-ingestion"></a>Out-of-order data ingestion<a class="hash-link" href="#out-of-order-data-ingestion" title="Direct link to heading">#</a></h2><p>With the release of v6.0.0, QuestDB no longer enforces that timeseries data is
sent in strict chronological order. This means that QuestDB can deal with
out-of-order data caused by network delays, hardware jitter, or different
delivery mechanisms, using the timestamp field instead of relying on the
received time. As shown in the example below, if a message is received by
QuestDB after the sample time (delay of 9s, 1s, 2s respectively), QuestDB can
recognize this lag and re-orders them prior to committing them to the database.</p><figure><img alt="A diagram illustrating how delays and network jitter can cause records to arrive out-of-order by time at a database" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="278" src="/img/guides/out-of-order-commit-lag/o3-data.jpeg" width="650"><figcaption class="caption_-tGK">Data arriving out-of-order due to network delays or jitter</figcaption></figure><p>This removes the burden from the programmer to design their ingestion mechanism
to deal with delays or network skew. While Kafka guarantees ordering within a
partition, it was still my responsibility to send messages in order to the
broker to consume them chronologically. Since I was polling a single endpoint,
there was little chance of records being sent out-of-order. But by adding new
exchanges to poll information from (e.g. Binance, Gemini), API response times
and network delays come into factor.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="influxdb-line-protocol-compatibility"></a>InfluxDB Line Protocol compatibility<a class="hash-link" href="#influxdb-line-protocol-compatibility" title="Direct link to heading">#</a></h2><p>QuestDB also recommends using the InfluxDB line protocol as the primary
ingestion method for highest performance. In fact, QuestDB team
<a href="/blog/2021/05/10/questdb-release-6-0-tsbs-benchmark">achieved write speeds of 1.43M rows/sec using an AMD Ryzen5</a>
when running the <a href="/time-series-benchmark-suite">Time Series Benchmark Suite</a>.</p><p>InfluxDB line protocol also provides the following benefits over using the
Postgres client (as used in the Kafka project via Kafka Connect):</p><ul><li>higher-throughput</li><li>robust ingestion from multiple sources into tables</li><li>configurable commit-lag for out-of-order data</li><li>schema-agnostic ingestion (i.e. adding new fields will dynamically create new
columns)</li></ul><p>The message format for InfluxDB looks as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI pseudo"><div tabindex="0" class="prism-code language-pseudo codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">table_name,&lt;tag&gt;=&lt;value&gt; &lt;label&gt;=&lt;value&gt;,&lt;label&gt;=&lt;value&gt; timestamp\n</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Each line of the InfluxDB record is ingested as a new row in QuestDB. For this
project, <code>table_name</code> was <code>crypto</code>, <code>tag</code> is the symbol for the cryptocurrency
(e.g. <code>BTC</code>) with other labels including columns for exchange names and prices.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="writing-data-from-multiple-cryptocurrency-exchanges"></a>Writing data from multiple cryptocurrency exchanges<a class="hash-link" href="#writing-data-from-multiple-cryptocurrency-exchanges" title="Direct link to heading">#</a></h2><p>To start, first pull the latest version of QuestDB (v6.0.3 or higher):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker pull questdb/questdb:latest</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Run the image with the following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -p </span><span class="token number" style="color:#50fa7b">9000</span><span class="token plain">:9000 -p </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain">:9009 questdb/questdb</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Port <code>9009</code> is used for sending new data to QuestDB using InfluxDB line
protocol, and the web interface for QuestDB is exposed on port <code>9000</code> to explore
data and run SQL queries.</p><p>For the purposes of the demo, I’ve decided to pull the price of Bitcoin from
Binance and Gemini every second. To test the out-of-order ingestion more
obvious, I purposely introduced a random delay between 1–5s before sending price
data from Gemini.</p><p>We do not need to create tables beforehand when using InfluxDB line protocol, so
we can directly run the following script and a table <code>crypto</code> will be created on
the fly:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> axios </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">require</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;axios&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> net </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">require</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;net&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> influxClient </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">new</span><span class="token plain"> </span><span class="token class-name">net</span><span class="token class-name punctuation" style="color:#f8f8f2">.</span><span class="token class-name">Socket</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token constant" style="color:#bd93f9">HOST</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;localhost&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token constant" style="color:#bd93f9">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">function</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">randomInt</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token parameter">low</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> high</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">floor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">random</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">high </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> low</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> low</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">function</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#ff79c6">await</span><span class="token plain"> influxClient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">connect</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token constant" style="color:#bd93f9">PORT</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token constant" style="color:#bd93f9">HOST</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">function</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">getBinanceData</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#ff79c6">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#f1fa8c">&quot;https://api.binance.us/api/v3/avgPrice?symbol=BTCUSD&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> row </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token template-string string" style="color:#f1fa8c">crypto,currency=BTC,exchange=Binance price=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">.</span><span class="token template-string interpolation">price</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#f1fa8c"> </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token template-string interpolation">      Date</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">.</span><span class="token template-string interpolation function" style="color:#8be9fd">now</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">(</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#ff79c6">*</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#50fa7b">1e6</span><span class="token template-string interpolation"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token template-string interpolation">    </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#ff79c6">await</span><span class="token plain"> influxClient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">write</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">row</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#f1fa8c">\n</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">setTimeout</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">getBinanceData</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">function</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">getGeminiData</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#ff79c6">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;https://api.gemini.com/v1/pricefeed&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> price </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">find</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token parameter">i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#ff79c6">=&gt;</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">pair</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">===</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;BTCUSD&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> row </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token template-string string" style="color:#f1fa8c">crypto,currency=BTC,exchange=Gemini price=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">price</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#f1fa8c"> </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token template-string interpolation">      Date</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">.</span><span class="token template-string interpolation function" style="color:#8be9fd">now</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">(</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#ff79c6">*</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#50fa7b">1e6</span><span class="token template-string interpolation"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token template-string interpolation">    </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">setTimeout</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#ff79c6">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#ff79c6">await</span><span class="token plain"> influxClient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">write</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">row</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#f1fa8c">\n</span><span class="token template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">randomInt</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1000</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">5000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">setTimeout</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">getGeminiData</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">getBinanceData</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">getGeminiData</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To check if the data is committed in chronological order, I can run the
<a href="/docs/reference/function/boolean">isOrdered</a> function in a query:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT isOrdered(timestamp) is_ts_ordered FROM crypto</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><table><thead><tr><th>is_ts_ordered</th></tr></thead><tbody><tr><td>true</td></tr></tbody></table><p>And despite the fact that I introduced a random network delay on the Gemini
price feed, you can see that Bitcoin price from the two exchanges are committed
in order.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>In a more realistic scenario, we would run different services on the cloud to
pull data from various exchanges without intentional network delays. Once we
figure out a pattern in terms of API response times or lags, we can optimize
this process even further by
<a href="/docs/guides/out-of-order-commit-lag">tweaking the commit lag variables</a> on
QuestDB.</p><p>Specifying this known lag interval can reduce the compute resources QuestDB uses
to sort out of order data then merging with persisted data to achieve higher
throughput:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># via env variables</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -p </span><span class="token number" style="color:#50fa7b">8812</span><span class="token plain">:8812 -p </span><span class="token number" style="color:#50fa7b">9000</span><span class="token plain">:9000 -p </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain">:9009 </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#ff79c6">QDB_CAIRO_MAX_UNCOMMITTED_ROWS</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#ff79c6">QDB_CAIRO_COMMIT_LAG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">20000</span><span class="token plain"> questdb/questdb</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- via SQL</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">ALTER TABLE crypto SET PARAM maxUncommittedRows = 10000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>For a project requiring high-throughput and performance needs, QuestDB provides
nice features to enjoy the best of both worlds: fast ingestion via InfluxDB line
protocol without worrying about data being out or order with full SQL support to
analyze and act on that data. As with
<a href="/blog/2021/02/18/realtime-crypto-tracker-with-kafka-and-questdb">the Kafka project</a>,
feel free to connect it with your account to execute trades with the price data
or build out more sophisticated statistical models.</p><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback or come and say hello in the
<a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/node-js">node.js</a><a class="margin-horiz--sm" href="/blog/tags/crypto">crypto</a><a class="margin-horiz--sm" href="/blog/tags/market-data">market data</a><a class="margin-horiz--sm" href="/blog/tags/bitcoin">bitcoin</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/07/05/comparing-questdb-timescaledb-influxdb"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Comparing InfluxDB, TimescaleDB, and QuestDB timeseries databases</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/06/16/high-cardinality-time-series-data-performance"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How databases handle 10 million devices in high-cardinality benchmarks »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.e53824dd.js" defer="defer"></script>
</body>
</html>