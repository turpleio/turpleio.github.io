<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Using Telegraf and QuestDB to store metrics in a time series database | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Using Telegraf and QuestDB to store metrics in a time series database | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="How to use the Telegraf agent to collect system metrics from DigitalOcean droplets, store the metrics in QuestDB, and perform basic data visualization and SQL queries using a time series database."><meta data-react-helmet="true" name="twitter:description" content="How to use the Telegraf agent to collect system metrics from DigitalOcean droplets, store the metrics in QuestDB, and perform basic data visualization and SQL queries using a time series database."><meta data-react-helmet="true" property="og:description" content="How to use the Telegraf agent to collect system metrics from DigitalOcean droplets, store the metrics in QuestDB, and perform basic data visualization and SQL queries using a time series database."><meta data-react-helmet="true" name="twitter:title" content="Using Telegraf and QuestDB to store metrics in a time series database | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Using Telegraf and QuestDB to store metrics in a time series database | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,questdb,telegraf"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2021-07-09/banner.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2021-07-09/banner.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Using Telegraf and QuestDB to store metrics in a time series database</h1><time datetime="2021-07-09T00:00:00.000Z" class="date_A31P">July 9, 2021 · 9 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/gabor-boros" alt="Gábor Boros"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer">Gábor Boros</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A diagram showing system metrics collected by multiple Telegraf agents sent to QuestDB as a time series database for storage" class="image_Pw1y margin_Rc0b shadow_7z-4" height="591" src="/img/blog/2021-07-09/banner.png" width="770"></figure><p>This tutorial is written by <a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer">Gábor Boros</a>, who
has put together some great examples of using Telegraf as a means of collecting
and sending system metrics as time series data to QuestDB for analysis and
visualization.</p><p>Thanks Gábor for the awesome contribution!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Telegraf is a plugin-driven server agent for collecting, processing,
aggregating, and writing metrics. With
<a href="https://docs.influxdata.com/telegraf/v1.19/plugins/" target="_blank" rel="noopener noreferrer">more than 200 plugins</a>, it
can collect almost any kind of data about the server it is running on,
application data or even filesystem changes.</p><p>Although Telegraf can collect an exceptional amount and variety of data, we need
to store and visualize this information at some point. Considering that we
collect the metrics over time, a convenient way to store time series data is
using a time series database. We&#x27;ll use QuestDB for ingestion and perform some
basic visualization for this tutorial.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="multiple-telegraf-clients-and-out-of-order-data"></a>Multiple telegraf clients and out-of-order data<a class="hash-link" href="#multiple-telegraf-clients-and-out-of-order-data" title="Direct link to heading">#</a></h2><p>When you use multiple clients, it can happen that data coming from various
sources simultaneously can arrive out-of-order by time. QuestDB used to have the
downside of dropping this kind of out-of-order data. The QuestDB team solved
this as of <a href="/blog/2021/04/20/questdb-release-6-0-alpha">the 6.0 release</a>,
meaning there is no need to apply any workarounds like sorting data ourselves
before inserting.</p><p>This tutorial will set up multiple virtual machines, install Telegraf, QuestDB
and experiment with how we can visualize the incoming data about server status
(load, CPU, swap, and memory usage) over time.</p><p>Celebrating the recent public market debut of DigitalOcean and QuestDB&#x27;s
marketplace offering, we are going to join the celebration. Therefore, we will
need the following resources for the tutorial:</p><ul><li>A DigitalOcean account (get 100 USD credit for free by signing up using
<a href="https://m.do.co/c/50d6b551562b" target="_blank" rel="noopener noreferrer">the QuestDB referral link</a>)</li><li>Basic <code>shell</code> knowledge</li><li>Basic knowledge of <code>vim</code> or <code>nano</code></li></ul><p>Enough talking, let&#x27;s jump right in and create our Droplets!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setting-up-digitalocean-droplets"></a>Setting up DigitalOcean droplets<a class="hash-link" href="#setting-up-digitalocean-droplets" title="Direct link to heading">#</a></h2><p>In total for this tutorial, we will create three droplets on DigitalOcean.
Afterwards, we will have the following resources:</p><ul><li>1 x QuestDB Droplet for storing and visualizing metrics.</li><li>2 x Droplets running the Telegraf agent collecting system metrics.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-questdb-droplet"></a>Create a QuestDB Droplet<a class="hash-link" href="#create-a-questdb-droplet" title="Direct link to heading">#</a></h3><p>Let&#x27;s get started with the database Droplet. DigitalOcean has an excellent
marketplace with 1-Click Apps reviewed by its staff. QuestDB is available on the
marketplace recently, so the setup takes about 30 seconds:</p><ol><li>Navigate to the
<a href="https://marketplace.digitalocean.com/apps/questdb?refcode=50d6b551562b" target="_blank" rel="noopener noreferrer">marketplace listing</a></li><li>Click on <strong>Create QuestDB Droplet</strong></li><li>Select the basic plan for your Droplet (4GB RAM is recommended)</li></ol><figure><img alt="Choosing the RAM and CPU capacity for a QuestDB DigitalOcean Droplet" class="image_Pw1y margin_Rc0b shadow_7z-4" height="591" src="/img/blog/2021-07-09/choosing-droplet.png" width="770"></figure><ol start="4"><li>Choose a region closest to you</li><li>At the <strong>Authentication</strong> section, enter your SSH public key, or set a
password</li><li>Set the hostname to <code>telegraf-questdb-tutorial</code></li><li>Leave all other settings with their defaults, and click <strong>Create Droplet</strong> at
the bottom of the page</li></ol><figure><img alt="Finalizing the creation step of a DigitalOcean Droplet running QuestDB" class="image_Pw1y margin_Rc0b shadow_7z-4" height="591" src="/img/blog/2021-07-09/questdb-droplet.png" width="770"></figure><p>In about 30 seconds, QuestDB is ready to use. To validate that we set everything
up successfully, copy the Droplet&#x27;s IP address by clicking on it and navigate to
<code>http://&lt;IP ADDRESS&gt;:9000/</code> where <code>&lt;IP ADDRESS&gt;</code> is the IP address you just
copied. The interactive console should load and we can start querying the
database and inserting data!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-digitalocean-droplets-with-telegraf-agent"></a>Create DigitalOcean Droplets with Telegraf agent<a class="hash-link" href="#create-digitalocean-droplets-with-telegraf-agent" title="Direct link to heading">#</a></h3><p>We don&#x27;t have any data in the database to query yet, so the next steps are to
send some metrics to QuestDB for inspection. Scripts that create dummy data are
always good to get started, but in this case, let&#x27;s use some actual data
collected on demo machines, so we have proper metrics to play with instead of
synthetic data. From the QuestDB docs:</p><blockquote><p>QuestDB exposes a reader for InfluxDB line protocol which allows using QuestDB
as a drop-in replacement for InfluxDB and other systems which implement this
protocol. – <a href="/docs/reference/api/ilp/overview">questdb.io</a></p></blockquote><p>We will utilize InfluxDB line protocol to send data via Telegraf to QuestDB
directly. The next step is to create some Droplets, start Telegraf agents, and
point them to QuestDB. Create the Droplets following these steps:</p><ol><li>Navigate to the <a href="https://cloud.digitalocean.com/droplets" target="_blank" rel="noopener noreferrer">Droplets dashboard</a></li><li>In the top-right section of the page, click <strong>Create</strong> and select
<strong>Droplets</strong></li><li>At the &quot;Choose an image&quot; section, select <code>Ubuntu</code> (<code>20.04 LTS x64</code> at the
time of writing)</li><li>Select the <strong>Basic</strong> plan for your Droplet and the minimum resource type</li><li>Choose a region of your choice that is the closest to you</li><li>At the &quot;Authentication&quot; section, select your SSH key or set a password for
the Droplet&#x27;s root account</li><li>Set the <strong>number of Droplets to 2</strong></li><li>Set the hostname to <code>telegraf-agent-1</code> and <code>telegraf-agent-2</code></li><li>Leave all other settings with their defaults, and click &quot;Create Droplet&quot; at
the bottom of the page</li></ol><p>Compared to the previous Droplet creation, DigitalOcean will create two Droplets
instead of one. In a few seconds, the Droplets are ready to start up the
Telegraf agent.</p><figure><img alt="A list of running DigitalOcean Droplets with the QuestDB application running and two demo instances" class="image_Pw1y margin_Rc0b shadow_7z-4" height="591" src="/img/blog/2021-07-09/available-droplets.png" width="770"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="configuring-telegraf-agents-to-send-metrics-to-questdb"></a>Configuring Telegraf agents to send metrics to QuestDB<a class="hash-link" href="#configuring-telegraf-agents-to-send-metrics-to-questdb" title="Direct link to heading">#</a></h2><p>In this section, we will install the Telegraf agent on all three Droplets. We
can collect the system metrics from two DigitalOcean droplets that are remote,
and we will send the local metrics of the QuestDB droplet&#x27;s host into the
database itself. To install Telegraf, we will follow the official installation
method.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="installing-telegraf-on-the-questdb-droplet"></a>Installing Telegraf on the QuestDB Droplet<a class="hash-link" href="#installing-telegraf-on-the-questdb-droplet" title="Direct link to heading">#</a></h3><p>First of all, log in to <code>telegraf-questdb-tutorial</code> Droplet by executing
<code>ssh root@&lt;IP ADDRESS&gt;</code> where <code>&lt;IP ADDRESS&gt;</code> is the Droplet&#x27;s IP address. Then,
on the server, run the following to make the Telegraf client available for
installation.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Download the signing keys from influxdata.com</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -s https://repos.influxdata.com/influxdb.key </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:#8be9fd">add</span><span class="token plain"> -</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Source release information</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> /etc/lsb-release</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Add influxdata.com APT repository to the APT repository list</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;deb https://repos.influxdata.com/</span><span class="token string variable" style="color:#ff79c6">${DISTRIB_ID</span><span class="token string variable operator" style="color:#ff79c6">,,</span><span class="token string variable" style="color:#ff79c6">}</span><span class="token string" style="color:#f1fa8c"> </span><span class="token string variable" style="color:#ff79c6">${DISTRIB_CODENAME}</span><span class="token string" style="color:#f1fa8c"> stable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">tee</span><span class="token plain"> /etc/apt/sources.list.d/influxdb.list</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Fetch available repositories and read package lists</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">apt-get</span><span class="token plain"> update</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We are running the above commands to add the APT repository to our list of
available repositories. Now, we can install the agent as we would do with any
packages by executing <code>apt-get install -y telegraf</code>. The agent is installed but
not configured yet. To configure it, let&#x27;s create a new configuration file at
<code>/etc/telegraf/telegraf.d/questdb.conf</code> with the following content:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Configuration for Telegraf agent</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">agent</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">## Default data collection interval for all inputs</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  interval = &quot;5s&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Write results to QuestDB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">outputs.socket_writer</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4"># Write metrics to a local QuestDB instance over TCP</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  address = &quot;tcp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">9009&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read metrics about CPU usage</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.cpu</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read metrics about memory usage</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.mem</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read system statistics, like load on the server</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.system</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>After saving the configuration file, we have one thing left to do: restart
Telegraf by running <code>systemctl restart telegraf</code>. In 5 seconds, the agent will
start reporting to QuestDB.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="installing-telegraf-on-demo-droplets"></a>Installing Telegraf on demo Droplets<a class="hash-link" href="#installing-telegraf-on-demo-droplets" title="Direct link to heading">#</a></h3><p>Lastly, install Telegraf on the remaining Droplets. As you may expect, we have
to perform the same process as the QuestDB droplet. SSH into both Droplets,
<code>telegraf-agent-1</code> and <code>telegraf-agent-2</code>.</p><p>Add the necessary signing keys and prepare the local APT repository list:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Download the signing keys from influxdata.com</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -s https://repos.influxdata.com/influxdb.key </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:#8be9fd">add</span><span class="token plain"> -</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Source release information</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> /etc/lsb-release</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Add influxdata.com APT repository to the APT repository list</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;deb https://repos.influxdata.com/</span><span class="token string variable" style="color:#ff79c6">${DISTRIB_ID</span><span class="token string variable operator" style="color:#ff79c6">,,</span><span class="token string variable" style="color:#ff79c6">}</span><span class="token string" style="color:#f1fa8c"> </span><span class="token string variable" style="color:#ff79c6">${DISTRIB_CODENAME}</span><span class="token string" style="color:#f1fa8c"> stable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">tee</span><span class="token plain"> /etc/apt/sources.list.d/influxdb.list</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Fetch available repositories and read package lists</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">apt-get</span><span class="token plain"> update</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Install Telegraf by executing <code>apt-get install -y telegraf</code> and edit the
configuration file <code>/etc/telegraf/telegraf.d/reporter.conf</code> as the following:</p><p>Note that below, we set the <code>socket_writer</code> address in the configuration to
<code>&lt;QUESTDB IP ADDRESS&gt;</code>, which is the IP address of the QuestDB Droplet.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Configuration for Telegraf agent</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">agent</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">## Default data collection interval for all inputs</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  interval = &quot;5s&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Write results to QuestDB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">outputs.socket_writer</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4"># Write metrics to a local QuestDB instance over TCP</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  address = &quot;tcp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">//&lt;QUESTDB IP ADDRESS</span><span class="token punctuation" style="color:#f8f8f2">&gt;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">9009&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read metrics about CPU usage</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.cpu</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read metrics about memory usage</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.mem</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Read system statistics, like load on the server</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">inputs.system</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Restart the Telegraf agents with <code>systemctl restart telegraf</code> just like the
QuestDB Droplet; in a few seconds, the agents will start reporting to our
database.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="run-sql-queries-on-telegraf-metrics"></a>Run SQL queries on Telegraf metrics<a class="hash-link" href="#run-sql-queries-on-telegraf-metrics" title="Direct link to heading">#</a></h2><p>At this point, we have every component set up and running to visualize some
incoming data. Navigate to <code>http://&lt;QUESTDB IP ADDRESS&gt;:9000</code> where the
<code>&lt;QUESTDB IP ADDRESS&gt;</code> is the IP address of your QuestDB droplet, and write the
following SQL statement in the SQL editor:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT * FROM cpu</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This will return all data in the table for CPU metrics sent by Telegraf. We can
easily create some aggregates like the average CPU usage per machine:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    host,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(usage_system) cpu_average,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    timestamp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM cpu</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>If we want to perform some more complex queries, we can perform JOINs across the
three tables:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    cpu.host,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(mem.used_percent) mem_usage_average,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(cpu.usage_system) cpu_average,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(system.load1) load1_average,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    cpu.timestamp as timestamp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM cpu</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">INNER JOIN mem ON mem.host = cpu.host</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">INNER JOIN system ON system.host = cpu.host</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY 5m</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">ORDER BY timestamp DESC</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>And to visualize this data, query memory usage using the following SQL:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    host,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(mem.used_percent) usage_average,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    timestamp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM mem</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE host = &#x27;telegraf-agent-1&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY 30s</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">ORDER BY timestamp DESC</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The basic in-built charting functionality that QuestDB has can be used like so:</p><ol><li>Click the <strong>Chart</strong> tab</li><li>Set <strong>Chart type</strong> to <code>line</code></li><li>Set <strong>Labels</strong> to <code>timestamp</code></li><li>Plot <code>usage_average</code> as a <strong>Series</strong> and click <strong>Draw</strong></li></ol><figure><img alt="Visualizing the results of a SQL query over system and CPU metrics in QuestDB as a line chart" class="image_Pw1y margin_Rc0b shadow_7z-4" height="591" src="/img/blog/2021-07-09/visualizing-sql-questdb.png" width="770"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>We&#x27;ve installed QuestDB on DigitalOcean using the new Marketplace offering for
QuestDB, set up multiple Droplets to report actual metrics to QuestDB via
Telegraf, and visualized these metrics on the interactive console. This tutorial
shows how easy it is to send real system metrics as time series data to a
database like QuestDB for reports and visualization.</p><p>For next steps, we can experiment with some of the additional integrations that
Telegraf supports to grab insights from other applications and
<a href="/blog/2020/10/19/grafana-tutorial">use the Grafana integration that QuestDB offers</a>
to set up more detailed dashboards for visualization or even alerting and
notifications.</p><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback or come and say hello in the
<a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/telegraf">telegraf</a><a class="margin-horiz--sm" href="/blog/tags/digitalocean">digitalocean</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/07/16/release-6-0-4-prometheus-metrics"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« QuestDB 6.0.4 July release, Prometheus metrics support</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/07/05/comparing-questdb-timescaledb-influxdb"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Comparing InfluxDB, TimescaleDB, and QuestDB timeseries databases »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.3e047ba9.js" defer="defer"></script>
</body>
</html>