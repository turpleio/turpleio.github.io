<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Realtime crypto tracker with Kafka and QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Realtime crypto tracker with Kafka and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Use Python to send real-time cryptocurrency metrics to Kafka topics, ingest to QuestDB, and calculate moving averages with Pandas."><meta data-react-helmet="true" name="twitter:description" content="Use Python to send real-time cryptocurrency metrics to Kafka topics, ingest to QuestDB, and calculate moving averages with Pandas."><meta data-react-helmet="true" property="og:description" content="Use Python to send real-time cryptocurrency metrics to Kafka topics, ingest to QuestDB, and calculate moving averages with Pandas."><meta data-react-helmet="true" name="twitter:title" content="Realtime crypto tracker with Kafka and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Realtime crypto tracker with Kafka and QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,crypto,kafka,pandas,python"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-kafka-bitcoin.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-kafka-bitcoin.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Realtime crypto tracker with Kafka and QuestDB</h1><time datetime="2021-02-18T00:00:00.000Z" class="date_A31P">February 18, 2021 · 9 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/Yitaek" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/Yitaek" alt="Yitaek Hwang"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/Yitaek" target="_blank" rel="noopener noreferrer">Yitaek Hwang</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A photograph of a laptop displaying candle charts of stock market data" class="image_1-Fc image--title_Z46g" height="433" src="/img/blog/2021-02-18/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/photos/ZzOa5G8hSPI" target="_blank" rel="noopener noreferrer">M. B. M.</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This submission comes from one of our community contributors
<a href="https://github.com/Yitaek" target="_blank" rel="noopener noreferrer">Yitaek Hwang</a> who has put together an excellent
tutorial that shows how to use Python to send real-time cryptocurrency metrics
into Kafka topics, store these records in QuestDB, and perform moving average
calculations on this time series data with Pandas.</p><p>Thanks for your contribution, Yitaek!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><blockquote><p>Bitcoin soars past 50,000 USD for the first time —
<a href="https://edition.cnn.com/2021/02/16/investing/bitcoin-50000-price-record/index.html" target="_blank" rel="noopener noreferrer">CNN</a></p></blockquote><blockquote><p>Tesla invests 1.5 billion USD in bitcoin, will start accepting it as payment —
<a href="https://www.washingtonpost.com/business/2021/02/08/tesla-bitcoin-musk-dogecoin/" target="_blank" rel="noopener noreferrer">Washington Post</a></p></blockquote><p>Not a day goes by without some crypto news stealing the headlines these days.
From institutional support of Bitcoin to central banks around the world
exploring some form of digital currency, interest in cryptocurrency has never
been higher. This is also reflected in the daily exchange volume:</p><figure><img alt="A chart showing cryptocurrency exchange volumes from 2017 to present" class="image_Pw1y margin_Rc0b shadow_7z-4" height="398" src="/img/blog/2021-02-18/cryptocompare.png" width="650"></figure><p>As someone interested in the future of DeFi
(<a href="https://yitaek.medium.com/intro-to-defi-b4ab2ec0f156" target="_blank" rel="noopener noreferrer">decentralized finance</a>),
I wanted to better track the price of different cryptocurrencies and store them
into a timeseries database for further analysis. I found an interesting talk by
Ludvig Sandman and Bruce Zulu at Kafka Summit London 2019,
<a href="https://www.confluent.io/kafka-summit-lon19/using-kafka-streams-analyze-trading-crypto-exchanges/" target="_blank" rel="noopener noreferrer">Using Kafka Streams to Analyze Live Trading Activity for Crypto Exchanges</a>,
so I decided to leverage Kafka and modify it for my own use.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker</a> with at least 4GB memory</li><li><a href="https://www.python.org/downloads/" target="_blank" rel="noopener noreferrer">Python 3.7+</a> and
<a href="https://pypi.org/project/pip/" target="_blank" rel="noopener noreferrer">pip</a></li><li><a href="https://github.com/Yitaek/kafka-crypto-questdb" target="_blank" rel="noopener noreferrer">GitHub repository</a> which
contains the source for the examples below</li></ul><p><strong>Note:</strong> Memory can be increased on Docker Desktop in <strong>Settings -&gt; Resources
-&gt; Memory</strong> and increasing the default limit from <code>2GB</code> to <code>4GB</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="project-setup"></a>Project setup<a class="hash-link" href="#project-setup" title="Direct link to heading">#</a></h2><p>At a high level, this project polls the public Coinbase API for the price of
Bitcoin, Ethereum, and Chainlink. This information is then published onto
individual topics on Kafka (e.g. <code>topic_BTC</code>). The raw price information is sent
to a QuestDB via Kafka Connect to populate the timeseries database. At the same
time, a separate consumer also pulls that data and calculates a moving average
for a quick trend analysis.</p><figure><img alt="A diagram showing the flow of information in this tutorial from Coinbase to Kafka and finally to QuestDB" class="image_Pw1y margin_Rc0b shadow_7z-4" height="92" src="/img/blog/2021-02-18/stack.png" width="650"></figure><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> clone git@github.com:Yitaek/kafka-crypto-questdb.git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The codebase is organized into three parts:</p><ul><li><code>./docker-compose</code>: holds docker-compose file to start QuestDB, Kafka
(zookeeper, broker &amp; kafka connect), and a JSON file to initialize Kafka
Connect</li><li><code>./docker</code>: Dockerfile to build Kafka Connect image (pre-built image is
available via docker-compose)</li><li><code>*.py</code>: Python files to grab latest pricing information from Coinbase,
publishes information to Kafka, and calculates a moving average</li></ul><p>If you would like to analyze different cryptocurrencies or extend the simple
moving average example with a more complicated algorithm like relative strength
index analysis, feel free to
<a href="https://github.com/Yitaek/kafka-crypto-questdb" target="_blank" rel="noopener noreferrer">fork the repo on GitHub</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setting-up-kafka--questdb"></a>Setting up Kafka &amp; QuestDB<a class="hash-link" href="#setting-up-kafka--questdb" title="Direct link to heading">#</a></h2><p>Before pulling data from Coinbase, we need a running instance of a Kafka cluster
and QuestDB. In the repo, I have a working docker-compose file with Confluent
Kafka components (i.e. Zookeeper, Kafka Connect, Kafka Broker) and QuestDB. If
you would like to run this on the cloud or run it locally, follow the
instructions on the
<a href="https://docs.confluent.io/platform/current/quickstart/index.html" target="_blank" rel="noopener noreferrer">Confluent website</a>.
Otherwise simply run the docker-compose file:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> docker-compose</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker-compose up</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The docker-compose file runs the following services:</p><ul><li>QuestDB</li><li><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER" target="_blank" rel="noopener noreferrer">Zookeeper</a> for Kafka
config information, distributed sync, and group services</li><li><a href="https://kafka.apache.org/documentation/#intro_nutshell" target="_blank" rel="noopener noreferrer">Kafka Broker</a> for
receiving and storing messages and for consumers to fetch messages by topic</li><li><a href="https://kafka.apache.org/documentation/#connect" target="_blank" rel="noopener noreferrer">Kafka Connect</a> with JDBC
driver for streaming data between Apache Kafka and other systems</li></ul><p>The Kafka Connect image is based on <code>confluentinc/cp-kafka-connect-base:6.1.0</code>.
If you wish to modify this image (e.g. add a new connector or modify the bootup
process), you can override the
<a href="https://github.com/Yitaek/kafka-crypto/blob/main/docker/Dockerfile" target="_blank" rel="noopener noreferrer">Dockerfile</a>
and build it locally.</p><p>Wait for the Kafka cluster to come up and check the logs in the <code>connect</code>
container until you see the following messages:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI log"><div tabindex="0" class="prism-code language-log codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">[2021-02-...] INFO [Worker clientId=connect-1 ... ] Starting connectors and tasks using config offset -1 (org.apache.kafka.connect.runtime.distributed.DistributedHerder)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">[2021-02-...] INFO [Worker clientId=connect-1 ... ] Finished starting connectors and tasks (org.apache.kafka.connect.runtime.distributed.DistributedHerder)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">[2021-02-...] INFO [Worker clientId=connect-1 ... ] Session key updated (org.apache.kafka.connect.runtime.distributed.DistributedHerder)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="postgres-sink"></a>Postgres sink<a class="hash-link" href="#postgres-sink" title="Direct link to heading">#</a></h2><p>At this point, we have a healthy Kafka cluster and a running instance of
QuestDB, but they are not connected. Since QuestDB supports the Kafka Connect
JDBC driver, we can leverage the Postgres sink to populate our database
automatically. Post this connector definition to our Kafka Connect container:</p><div class="codeBlockContainer_J+bg"><div style="color:#f8f8f2;background-color:#262833" class="codeBlockTitle_oQzk">From ./docker-compose directory</div><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar codeBlockWithTitle_ZT05"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -X POST -H </span><span class="token string" style="color:#f1fa8c">&quot;Accept:application/json&quot;</span><span class="token plain"> -H </span><span class="token string" style="color:#f1fa8c">&quot;Content-Type:application/json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--data @postgres-sink-btc.json http://localhost:8083/connectors</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The contents of the <code>postgres-sink-btc.json</code> we are sending holds the following
configuration settings:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><div tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;postgres-sink-btc&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property">&quot;config&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;connector.class&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;io.confluent.connect.jdbc.JdbcSinkConnector&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;tasks.max&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;1&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;topics&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;topic_BTC&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;key.converter&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;value.converter&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;org.apache.kafka.connect.json.JsonConverter&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;connection.url&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;jdbc:postgresql://questdb:8812/qdb?useSSL=false&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;connection.user&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;admin&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;connection.password&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;quest&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;key.converter.schemas.enable&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;false&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;value.converter.schemas.enable&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;true&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;auto.create&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;true&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;insert.mode&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;insert&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;pk.mode&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;none&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Some important fields to note:</p><ul><li><strong>topics:</strong> Kafka topic to consume and convert into Postgres format</li><li><strong>connection:</strong> Using default credentials for QuestDB (<code>admin</code>/<code>quest</code>) on
port <code>8812</code></li><li><strong>value.converter:</strong> This example uses JSON with schema, but you can also use
<a href="https://docs.oracle.com/database/nosql-12.1.3.0/GettingStartedGuide/avroschemas.html" target="_blank" rel="noopener noreferrer">Avro</a>
or raw JSON. If you would like to override the default configuration, you can
refer to
<a href="https://docs.mongodb.com/kafka-connector/v1.3/kafka-sink-data-formats/" target="_blank" rel="noopener noreferrer">the Kafka sink connector guide</a>
from MongoDB</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="polling-coinbase"></a>Polling Coinbase<a class="hash-link" href="#polling-coinbase" title="Direct link to heading">#</a></h2><p>Now our that our Kafka-QuestDB connection is made, we can start pulling data
from Coinbase. The Python code requires <code>numpy</code>, <code>kafka-python</code>, and <code>pandas</code> to
run. Using pip, install those packages and run the <code>getData.py</code> script:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">pip </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> -r requirements.txt</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">python getData.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It will now print out debug message with pricing information as well as the
schema we’re using to populate QuestDB:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Initializing Kafka producer at </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:18.655069</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Initialized Kafka producer at </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:18.812354</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">API request at </span><span class="token function" style="color:#8be9fd">time</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:19.170623Record: </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;schema&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;struct&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;fields&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;float&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;name&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;coinbase&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;payload&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> datetime.datetime</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">17</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">38</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">19</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">170617</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;BTC&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">50884.75</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">API request at </span><span class="token function" style="color:#8be9fd">time</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:19.313046</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Record: </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;schema&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;struct&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;fields&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;float&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;name&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;coinbase&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;payload&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> datetime.datetime</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">17</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">38</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">19</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">313041</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;ETH&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1809.76</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">API request at </span><span class="token function" style="color:#8be9fd">time</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:19.471573</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Record: </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;schema&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;struct&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;fields&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;float&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;name&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;coinbase&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;payload&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> datetime.datetime</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">17</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">38</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">19</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">471566</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;LINK&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">31.68216</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">API request at </span><span class="token function" style="color:#8be9fd">time</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">-02-17 </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">:38:23.978928</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Record: </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;schema&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;struct&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;fields&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;float&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;type&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;string&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;field&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;optional&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> False, </span><span class="token string" style="color:#f1fa8c">&#x27;name&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;coinbase&#x27;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;payload&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> datetime.datetime</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">2021</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">17</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">14</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">38</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">23</span><span class="token plain">, </span><span class="token number" style="color:#50fa7b">978918</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;currency&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;BTC&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#bd93f9">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">50884.75</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="querying-questdb"></a>Querying QuestDB<a class="hash-link" href="#querying-questdb" title="Direct link to heading">#</a></h2><p>QuestDB is a fast, open-source, timeseries database with SQL support. This makes
it a great candidate to store financial market data for further historical trend
analysis and generating trade signals. By default, QuestDB ships with a console
UI exposed on port 9000. Navigate to localhost:9000 and query Bitcoin tracking
topic <code>topic_BTC</code> to see price data stream in:</p><figure><img alt="The Web Console in QuestDB showing results from a table of Bitcoin records" class="image_Pw1y margin_Rc0b shadow_7z-4" height="420" src="/img/blog/2021-02-18/questdb.png" width="650"></figure><p>You can repeat this process for the other topics as well. If you prefer to run
without a UI, you can also use the REST API to check:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -G </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--data-urlencode </span><span class="token string" style="color:#f1fa8c">&quot;query=select * from topic_BTC&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">http://localhost:9000/exp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The QuestDB console UI also provides the ability to generate basic graphs:</p><ol><li>Click on the <strong>Chart</strong> tab underneath the Tables</li><li>Select <code>line</code> as the chart type, <code>timestamp</code> as the label</li><li>Click <strong>Draw</strong></li></ol><figure><img alt="The Web Console in QuestDB showing how to visualize results from a table of Bitcoin records on a graph" class="image_Pw1y margin_Rc0b shadow_7z-4" height="261" src="/img/blog/2021-02-18/questdb-chart.png" width="650"></figure><p>The QuestDB native charting capabilities are limited to a few graph types, so
for more advanced visualization, check out my previous guide on streaming heart
rate data to QuestDB under the
<a href="/blog/2021/02/05/streaming-heart-rate-data-with-iot-core-and-questdb#visualizing-data-with-grafana">Visualizing data with Grafana</a>
section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="calculate-moving-average"></a>Calculate moving average<a class="hash-link" href="#calculate-moving-average" title="Direct link to heading">#</a></h2><p>While we store the raw data on QuestDB for more sophisticated analysis, we can
also consume from the same topics to calculate a quick moving average. This may
be useful if you want to also post these records to another Kafka topic that you
may use on a dashboard or to set alerts on pricing trends.</p><p>On a separate terminal, run the moving average script:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">python movingAverage.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It will print out the moving average of 25 data points and post it to
<code>topic_&lt;crypto&gt;_ma_25</code> :</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI log"><div tabindex="0" class="prism-code language-log codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Starting Apache Kafka consumers and producer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Initializing Kafka producer at 2021-02-17 16:28:33.584649</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Initialized Kafka producer at 2021-02-17 16:28:33.699208Consume record from topic &#x27;topic_BTC&#x27; at time 2021-02-17 16:28:34.933318</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.072581</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.075352</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.077106</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.088821</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.091865</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.094458</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.096814</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.098512</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.100150</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Produce record to topic &#x27;topic_BTC_ma_25&#x27; at time 2021-02-17 16:28:35.103512</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>If you wish to also populate these data points into QuestDB, supplement the JSON
data with schema information in <code>movingAverage.py</code> similar to the way it is
defined in the new data JSON block in <code>getData.py</code>. Then create another Postgres
sink via curl with topic set as <code>topic&lt;crypto&gt;_ma_25</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="wrapping-up"></a>Wrapping up<a class="hash-link" href="#wrapping-up" title="Direct link to heading">#</a></h2><p>To stop streaming data, simply stop the Python scripts. To stop and remove the
Kafka cluster / QuestDB services, run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker-compose down</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>While this is a simple example, you can extend this to optimize the data format
with Avro, connect it with your Coinbase account to execute trades based on
trading signals, or test out different statistical methods on the raw data. Feel
free to <a href="https://github.com/Yitaek/kafka-crypto-questdb" target="_blank" rel="noopener noreferrer">submit a PR</a> if you
have a suggestion or improvements to make!</p><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback or just come and say hello in the
<a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/python">python</a><a class="margin-horiz--sm" href="/blog/tags/pandas">pandas</a><a class="margin-horiz--sm" href="/blog/tags/kafka">kafka</a><a class="margin-horiz--sm" href="/blog/tags/crypto">crypto</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/03/09/realtime-stock-alerts-python-grafana-questdb"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Real-time stock price alerts using Python, Grafana and QuestDB</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/02/05/questdb-release-5-0-6-postgres-wire"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">QuestDB 5.0.6 Release Highlights, January 2021 »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.3e047ba9.js" defer="defer"></script>
</body>
</html>