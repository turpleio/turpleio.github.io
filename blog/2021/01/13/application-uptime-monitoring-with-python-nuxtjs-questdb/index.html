<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Monitoring the uptime of an application with Python, Nuxt.js and QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Monitoring the uptime of an application with Python, Nuxt.js and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="This detailed tutorial shows how to use QuestDB in a robust application status page and includes a repository with the example code ready to deploy."><meta data-react-helmet="true" name="twitter:description" content="This detailed tutorial shows how to use QuestDB in a robust application status page and includes a repository with the example code ready to deploy."><meta data-react-helmet="true" property="og:description" content="This detailed tutorial shows how to use QuestDB in a robust application status page and includes a repository with the example code ready to deploy."><meta data-react-helmet="true" name="twitter:title" content="Monitoring the uptime of an application with Python, Nuxt.js and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Monitoring the uptime of an application with Python, Nuxt.js and QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,python,fastapi,nuxtjs,monitoring,uptime"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-python.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-python.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Monitoring the uptime of an application with Python, Nuxt.js and QuestDB</h1><time datetime="2021-01-13T00:00:00.000Z" class="date_A31P">January 13, 2021 · 18 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/gabor-boros" alt="Gábor Boros"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer">Gábor Boros</a></h4><small class="avatar__subtitle">Guest</small></div></div></header><div class="markdown"><figure><img alt="A traffic light on a street corner with a green signal" class="image_1-Fc image--title_Z46g" height="433" src="/img/blog/2021-01-13/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/photos/i3tiM7n9_CE" target="_blank" rel="noopener noreferrer">Geoffrey Hauwen</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This submission comes from one of our community contributors
<a href="https://github.com/gabor-boros" target="_blank" rel="noopener noreferrer">Gábor Boros</a> who has built an extremely robust
statuspage application which uses QuestDB as a data sink.</p><p>Thanks for your contribution, Gábor!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="why-build-a-status-page-for-an-application"></a>Why build a status page for an application?<a class="hash-link" href="#why-build-a-status-page-for-an-application" title="Direct link to heading">#</a></h2><p>Highly available services that serve millions of requests rely on the visibility
of the system status for customers and internal teams. This tutorial shows how a
lightweight and performant time-series database coupled with queued status
checks and a simple UI are key ingredients for robust application monitoring.</p><p>Even if we design the most reliable systems, incidents will occur for
hard-to-predict reasons. It&#x27;s critical to provide as much information as
possible to users, customers, and service teams. The most convenient way to
display this is through a status page.</p><p>Although the page&#x27;s responsibility is to provide information, it can reduce the
support team&#x27;s load and eliminate duplicate support tickets. Status pages are a
crucial part of incident management, and usually, other teams enjoy benefits
like client and service owners when they need to refer to SLAs. In this
tutorial, I&#x27;ll show you how to build a simple yet powerful status page that
scores well on performance and design.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="what-we-will-build"></a>What we will build<a class="hash-link" href="#what-we-will-build" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h3><p>As mentioned above, we will build a simple status page made of two parts: the
backend monitors our service, and a frontend shows our services&#x27; status on an
hourly scale.</p><figure><img alt="A screenshot of a QuestDB website status indicator showing 100% uptime" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="284" src="/img/blog/2021-01-13/end-result.png" width="650"><figcaption class="caption_-tGK">Finished statuspage indicator</figcaption></figure><p>You will need some experience in Python, JavaScript, and basic SQL knowledge. To
build our service, we will use FastAPI, an ultra-fast Python web framework,
Celery for scheduling monitoring tasks, QuestDB, the fastest open-source
time-series database, to store monitoring results, and NuxtJs to display them.</p><p>There&#x27;s a lot to learn, so let&#x27;s jump right in!</p><p><em>The containerized source code is available at <a href="https://github.com/gabor-boros/questdb-statuspage" target="_blank" rel="noopener noreferrer">https://github.com/gabor-boros/questdb-statuspage</a>.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p>You will need to have the following installed on your machine:</p><ul><li>Python 3.8</li><li>NodeJS 14.x</li><li>Docker</li><li>Docker Compose</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setting-up-the-environment"></a>Setting up the environment<a class="hash-link" href="#setting-up-the-environment" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-new-project"></a>Create a new project<a class="hash-link" href="#create-a-new-project" title="Direct link to heading">#</a></h3><p>First things first, we create a directory, called <code>status-page</code>, this is our
project root. We also need to create another directory called <code>app</code> which will
contain the backend code. After following these steps, you should have a project
structure like this.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">status-page (project root)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── app (backend service directory)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="installing-questdb--redis"></a>Installing QuestDB &amp; Redis<a class="hash-link" href="#installing-questdb--redis" title="Direct link to heading">#</a></h3><p>Now, we will install QuestDB and Redis. QuestDB is used to store the HTTP status
and the service state of our application over time, and Redis is used as a
message broker between the backend application and the workers who will do the
scheduled monitoring.</p><p>To install these services, we will use Docker and Docker Compose. We are going
to create a <code>docker-compose.yml</code> file within the project root with the following
content:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">version</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;3&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">questdb_data</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;redis:latest&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;6379:6379&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">questdb</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;questdb/questdb:latest&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4"># Map QuestDB&#x27;s data directory to the host</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;questdb_data:/root/.questdb/db&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;9000:9000&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;8812:8812&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Voila! When we run <code>docker-compose up</code>, QuestDB and Redis start, and we can
access QuestDB&#x27;s interactive console on
<a href="http://127.0.0.1:9000" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9000</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="install-backend-dependencies"></a>Install backend dependencies<a class="hash-link" href="#install-backend-dependencies" title="Direct link to heading">#</a></h3><p>Now, we have the project structure, and we can run the required services, so we
need to set up our backend service to collect data about the website or service
we would like to monitor. We will use poetry to manage Python dependencies
during this tutorial, so let&#x27;s start by installing that.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ pip </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> poetry</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To define the project requirements, create a <code>pyproject.toml</code> file with the
following content:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI toml"><div tabindex="0" class="prism-code language-toml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">[tool.poetry]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">name = &quot;status-page&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">version = &quot;0.1.0&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">description = &quot;QuestDB tutorial for creating a simple status page.&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">authors = [&quot;Your name &lt;your.email@example.com&gt;&quot;]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">license = &quot;MIT&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">[tool.poetry.dependencies]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">python = &quot;^3.8&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">[build-system]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">requires = [&quot;poetry-core&gt;=1.0.0&quot;]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">build-backend = &quot;poetry.core.masonry.api&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In order to let the application communicate with QuestDB utilizing the
<code>psycopg</code> client library, we need to install <code>libpq-dev</code> package on our
system. To install it, use your package manager; on Windows, you may need
to install PostgreSQL on your system.</p><p>Then, install the project dependencies by executing the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">poetry </span><span class="token function" style="color:#8be9fd">add</span><span class="token plain"> python fastapi pydantic uvicorn requests </span><span class="token punctuation" style="color:#f8f8f2">\</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;psycopg[c,pool]&quot;</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;celery[redis]&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As you may assume by checking the requirements, we will use QuestDB&#x27;s Postgres
interface to connect. When <code>poetry</code> finishes its job, it will add the
dependencies to <code>pyproject.toml</code> and we can now start to implement the backend
service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-simple-api"></a>Create a simple API<a class="hash-link" href="#create-a-simple-api" title="Direct link to heading">#</a></h2><p>The time has come, let&#x27;s create the backend service, but step-by-step. Within
the <code>app</code> directory, create an <code>__init__.py</code> and <code>main.py</code>. The first one is
responsible for making the <code>app</code> directory to a package, while the latter will
define the APIs our service exposes. Open <code>main.py</code> for edit and add the
following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> FastAPI</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">app </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    title</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;Status Page&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;This service gives back the status of the configured URL.&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    version</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;0.1.0&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Congratulations! You just created the backend service. You can go and try it out
by executing:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ poetry run uvicorn app.main:app --host </span><span class="token number" style="color:#50fa7b">127.0</span><span class="token plain">.0.1 --port </span><span class="token number" style="color:#50fa7b">8000</span><span class="token plain"> --reload</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">INFO:     Uvicorn running on http://127.0.0.1:8000 </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">Press CTRL+C to quit</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">INFO:     Application startup complete.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Although the service does nothing yet, it works and listens for any code change.
Add a new endpoint and watch it reload:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">path</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;/signals&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> tags</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;Monitoring&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">get_signals</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We have now created an API endpoint that will serve the system status data of
the monitored URL. If you open
<a href="http://127.0.0.1:8000/redoc" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8000/redoc</a>, you can see the
generated documentation for the endpoint, or you can check it working at
<a href="http://127.0.0.1:8000/signals" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8000/signals</a>, though it won&#x27;t
return any data yet.</p><p>It is time to have fun, we are going to integrate QuestDB with our shiny new
backend service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="integrate-questdb-with-fastapi"></a>Integrate QuestDB with FastAPI<a class="hash-link" href="#integrate-questdb-with-fastapi" title="Direct link to heading">#</a></h2><p>Integrating QuestDB with FastAPI is easier than you think. Thanks to QuestDB&#x27;s
<a href="/docs/reference/api/postgres">Postgres compatibility</a>, you can use
any standard or popular third-party libraries of any programming language which
implements Postgres wire protocol.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="set-up-the-table"></a>Set up the table<a class="hash-link" href="#set-up-the-table" title="Direct link to heading">#</a></h3><p>The very first step is to create the table in QuestDB. As said before, our
approach is simple, so that the table is simple, too. QuestDB is running from
our docker compose script so, we open the interactive console at
<a href="http://127.0.0.1:9000" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9000</a> and create a new table by running
the following query:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">TABLE</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    signals</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">url STRING</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> http_status </span><span class="token keyword" style="color:#ff79c6">INT</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> received </span><span class="token keyword" style="color:#ff79c6">TIMESTAMP</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> available </span><span class="token keyword" style="color:#ff79c6">BOOLEAN</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">timestamp</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">received</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The query executes, and after refreshing the table list on the left, you can see
the table we created.</p><figure><img alt="Running an SQL query in the web console of QuestDB" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="284" src="/img/blog/2021-01-13/interactive-console.png" width="650"><figcaption class="caption_-tGK">Finished statuspage indicator</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="connect-questdb-and-fastapi"></a>Connect QuestDB and FastAPI<a class="hash-link" href="#connect-questdb-and-fastapi" title="Direct link to heading">#</a></h3><p>As we have the table in the database, it is time to connect to QuestDB and query
some data to return through the API. To connect, we will use the Postgres
interface of QuestDB and Postgres using connection pooling to connect to it.</p><p>To be able to reuse the pool later on, create a new file in the <code>app</code> package
which is responsible for defining how to connect and name it <code>db.py</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># db.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> psycopg_pool </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> ConnectionPool</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pool </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> ConnectionPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;postgresql://admin:quest@127.0.0.1:8812/qdb&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Use a the default credentials</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    min_size</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Set pool size minimum to 1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    max_size</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">5</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Set pool size greater than 1 to not block async requests</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To set up a schema that represents the table in the database, create a <code>models.py</code>
in the <code>app</code> package, containing the schema definition:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># models.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Field</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">class</span><span class="token plain"> </span><span class="token class-name">Signal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#f1fa8c">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    Signal model stands for the results of monitoring requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token triple-quoted-string string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;The monitored URL&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    http_status</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;HTTP status code returned by upstream&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    available</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">bool</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;Represents the service availability&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    received</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> datetime </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;Timestamp when the signal received&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Let&#x27;s stop here for a moment and talk through what we did in the last steps:</p><ul><li>set up the API which will serve the requests coming from the frontend</li><li>created a table in QuestDB for our status records and provided connection
credentials for Postgres wire</li><li>implemented the schema which is used to serialize the results returned by the
database</li></ul><p>The next step is to initiate a connection and return the results from the
database. First, import the <code>pool</code> and <code>Signal</code> schema and then extend the
function which serves the <code>/signals</code> endpoint:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Other imports ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pool</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">models </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Signal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> List</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> BaseModel</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">class</span><span class="token plain"> </span><span class="token class-name">SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    records</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Signal</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># app and endpoint definitions are below...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>After adding the <code>defaultdict</code> import, the implementation of the <code>/signals</code>
endpoint should look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Other imports ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> defaultdict</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">path</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;/signals&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> response_model</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> tags</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;Monitoring&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">get_signals</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">limit</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">60</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># A simple query to return every record belongs to the website we will monitor</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    SELECT url, http_status, available, received FROM signals</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    WHERE url = &#x27;https://questdb.io&#x27; ORDER BY received DESC LIMIT </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">limit</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    signals </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> defaultdict</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#bd93f9">list</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># connect to the database</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4"># parse the results results returned by QuestDB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            signal </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Signal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                http_status</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                available</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">                received</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">3</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Return the response which is validated against the `response_model` schema</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> records</span><span class="token operator" style="color:#ff79c6">=</span><span class="token builtin" style="color:#bd93f9">list</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#bd93f9">reversed</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">records</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> records </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> signals</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">items</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Let&#x27;s recap on our code above, starting from the top:</p><ul><li>we added <code>defaultdict</code> import (we&#x27;ll explain that later)</li><li>extended the function decorator to use <code>response_model=List[SignalResponse]</code>,
the response model we defined already</li><li>changed the function signature to include a <code>limit</code> parameter and set its
default value to <code>60</code> since we will monitor HTTP status every minute</li><li>select the records from the database and prepare a dictionary for the parsed
<code>Signal</code>s.</li></ul><p>You may ask why to group the returned records per URL. Although we will monitor
only one URL for the sake of simplicity, I challenge you to change the
implementation later and explore QuestDB to handle the monitoring of multiple
URLs.</p><p>In the following lines, we are connecting to the database, executing the query,
and populates the dictionary, which we will use in the last four lines to
construct the <code>SignalResponse</code>. Our version of <code>main.py</code> at this point looks
like the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> defaultdict</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> List</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> FastAPI</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> BaseModel</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pool</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">models </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Signal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Add a response model to indicate the structure of the signals API response.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">class</span><span class="token plain"> </span><span class="token class-name">SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    records</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Signal</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">app </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    title</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;Status Page&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    description</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;This service gives back the status of the configured URL.&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    version</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;0.1.0&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">path</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;/signals&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> response_model</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">List</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> tags</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;Monitoring&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">async</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">get_signals</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">limit</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">60</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># A simple query to return every record belongs to the website we will monitor</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    SELECT * FROM signals</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    WHERE url = &#x27;https://questdb.io&#x27; ORDER BY received DESC LIMIT </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">limit</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    signals </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> defaultdict</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#bd93f9">list</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># connect to the database</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># parse the results results returned by QuestDB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        signal </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Signal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            http_status</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            available</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            received</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">3</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># Return the response which is validated against the `response_model` schema</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        SignalResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> records</span><span class="token operator" style="color:#ff79c6">=</span><span class="token builtin" style="color:#bd93f9">list</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#bd93f9">reversed</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">records</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> records </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> signals</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">items</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="schedule-monitoring-tasks"></a>Schedule monitoring tasks<a class="hash-link" href="#schedule-monitoring-tasks" title="Direct link to heading">#</a></h2><p>For scheduling the monitoring task, we will use Celery Beat, the built-in
periodic task scheduler implementation of Celery.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="scheduling-with-celery"></a>Scheduling with Celery<a class="hash-link" href="#scheduling-with-celery" title="Direct link to heading">#</a></h3><p>Before we schedule any task, we need to configure Celery. In the <code>app</code> package,
create a new <code>celery.py</code> which will contain the Celery and beat schedule
configuration. Import <code>Celery</code> for creating tasks, and <code>crontab</code> for
constructing Unix-like crontabs for our tasks. The task is the dotted path
representation of the function which is executed by Celery (<code>app.tasks.monitor</code>)
and sent to queues handled by Redis.</p><p>The only thing left is to configure the beat schedule, which is a simple
dictionary. We give a name for the schedule, define the dotted path pointing to
the task (function), and specify the schedule itself:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># celery.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> celery </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Celery</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> celery</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">schedules </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> crontab</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">MONITORING_TASK </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;app.tasks.monitor&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">celery_app </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Celery</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;tasks&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> broker</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;redis://localhost:6379/0&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Set a queue for task routes</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">celery_app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">task_routes </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  MONITORING_TASK</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;main-queue&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Schedule the monitoring task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">celery_app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">beat_schedule </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;monitor&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Name of the schedule</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#f1fa8c">&quot;task&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> MONITORING_TASK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Register the monitoring task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#f1fa8c">&quot;schedule&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> crontab</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            minute</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;*/1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># Run the task every minute</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-monitoring-task"></a>Create a monitoring task<a class="hash-link" href="#create-a-monitoring-task" title="Direct link to heading">#</a></h3><p>And the last part: creating the monitoring task. In the previous section, we
talked about the &quot;monitoring task&quot; multiple times, but we didn&#x27;t see the
concrete implementation.</p><p>In this final backend related section, you will implement the task which will
check the availability of the desired website or service and saves the results
as records in QuestDB. The monitoring task is a simple <code>HTTP HEAD</code> request and
saving the response to the database. We see the implementation in pieces of the
<code>app/tasks.py</code> referenced in celery as the dotted path before.</p><p>First, we start with imports:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># tasks.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">celery </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> celery_app</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pool</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">models </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Signal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We import <code>celery_app</code> which represents the Celery application, an <code>engine</code> to
save the results in the database, and finally <code>Signal</code> to construct the record
we will save. As the necessary imports are in place, we can define the <code>monitor</code>
task.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># tasks.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@celery_app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">task</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># register the function as a Celery task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">monitor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        response </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">head</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;https://questdb.io&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> exc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># handle any exception which may occur due to connection errors</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            INSERT INTO signals(received,url,http_status,available)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            VALUES(systimestamp(), &#x27;https://questdb.io&#x27;, -1, False);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># Open a connection and execute the query</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># Re-raise the exception to not hide issues</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">raise</span><span class="token plain"> exc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>As you can see, we send a request to the desired website and store the response
for later use. In case the website is down and unreachable, an exception will be
raised by requests or any underlying packages. As we need to log that the
request does not finish, we catch the exception, save a record in the database,
and re-raise the exception to not hide anything. Next, we construct a signal to
save.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@celery_app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">monitor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    signal </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Signal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;https://questdb.io&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        http_status</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        received</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        available</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">200</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">and</span><span class="token plain"> response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>We don&#x27;t do anything special here, though the following step is more
interesting: inserting the result in the database. Finally, we prepare and
execute the query based on the <code>signal</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@celery_app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">monitor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    INSERT INTO signals(received,url,http_status,available)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    VALUES(systimestamp(), &#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">url</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">&#x27;, </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">http_status</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">, </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">available</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The <code>tasks.py</code> should look like this now:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># tasks.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">celery </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> celery_app</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pool</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">models </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> Signal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#f8f8f2">@celery_app</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">.</span><span class="token decorator annotation punctuation" style="color:#f8f8f2">task</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># register the function as a Celery task</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">def</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">monitor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        response </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">head</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;https://questdb.io&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> exc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4"># handle any exception which may occur due to connection errors</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            INSERT INTO signals(received,url,http_status,available)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            VALUES(systimestamp(), &#x27;https://questdb.io&#x27;, -1, False);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">            &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># Open a connection and execute the query</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4"># Re-raise the exception to not hide issues</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">raise</span><span class="token plain"> exc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    signal </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> Signal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;https://questdb.io&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        http_status</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        received</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        available</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">200</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">and</span><span class="token plain"> response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#f1fa8c">f&quot;&quot;&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    INSERT INTO signals(received,url,http_status,available)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    VALUES(systimestamp(), &#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">url</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">&#x27;, </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">http_status</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">, </span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">{</span><span class="token string-interpolation interpolation">signal</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">.</span><span class="token string-interpolation interpolation">available</span><span class="token string-interpolation interpolation punctuation" style="color:#f8f8f2">}</span><span class="token string-interpolation string" style="color:#f1fa8c">);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token string-interpolation string" style="color:#f1fa8c">    &quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">with</span><span class="token plain"> pool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Congratulations! You just arrived at the last part of the backend service
implementation. We did many things and built a service that can periodically
check the website&#x27;s status, save it in the database, and expose the results
through an API.</p><p>The very last thing we need to address is to allow connections initiated by the
frontend later on. As it will run on localhost:3000 and we don&#x27;t use domain
names, the port is different hence all requests will be rejected with errors
related to
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">Cross-Origin Resource Sharing</a>.</p><p>For the sake of simplicity, we are going to allow all origins. We highly
recommended to avoid this in production for security reason but for the tutorial,
it will be sufficient for us:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># main.py</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Other imports ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">middleware</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cors </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> CORSMiddleware</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># app = FastAPI ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">add_middleware</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CORSMiddleware</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    allow_origins</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;*&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    allow_credentials</span><span class="token operator" style="color:#ff79c6">=</span><span class="token boolean" style="color:#bd93f9">True</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    allow_methods</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;*&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    allow_headers</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;*&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># rest of the code ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="implement-the-frontend"></a>Implement the frontend<a class="hash-link" href="#implement-the-frontend" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setting-up-frontend"></a>Setting up frontend<a class="hash-link" href="#setting-up-frontend" title="Direct link to heading">#</a></h3><p>To build the frontend, we will use Nuxt.js. We will use <code>yarn</code> to set up the
starter project by running <code>yarn</code> and selecting the answers detailed below.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">yarn</span><span class="token plain"> create nuxt-app frontend</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Project name: frontend</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Programming language: JavaScript</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Package manager: Yarn</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? UI framework: Tailwind CSS</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Nuxt.js modules: Axios</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Linting tools: </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">Press </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">space</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to select, </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">a</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to toggle all, </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">i</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to invert selection</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Testing framework: None</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Rendering mode: Single Page App</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Deployment target: Static </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">Static/JAMStack hosting</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Development tools: </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">Press </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">space</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to select, </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">a</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to toggle all, </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain">i</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> to invert selection</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? What is your GitHub username? gabor-boros</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">? Version control system: Git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The project root now looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">status-page</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── app/</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── frontend/</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── docker-compose.yml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── poetry.lock</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── pyproject.toml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="cleaning-up-generated-project"></a>Cleaning up generated project<a class="hash-link" href="#cleaning-up-generated-project" title="Direct link to heading">#</a></h3><p>Since we don&#x27;t need any styling delivered by the project generation, we need to
get rid of them. Open <code>frontend/layouts/default.vue</code> and replace its content
with</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI html"><div tabindex="0" class="prism-code language-html codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">&lt;!-- frontend/layouts/default.vue --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">template</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">Nuxt</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag punctuation" style="color:#f8f8f2">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">template</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Now, we will change <code>frontend/pages/index.vue</code> and call the backend service.
Let&#x27;s begin with <code>&lt;scripts&gt;</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI html"><div tabindex="0" class="prism-code language-html codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">&lt;!-- frontend/pages/index.vue --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">&lt;!-- template ... --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">script</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#ff79c6">const</span><span class="token script language-javascript"> </span><span class="token script language-javascript constant" style="color:#bd93f9">LIMIT</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#50fa7b">60</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#ff79c6">async</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:#ff79c6">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#8be9fd">fetchSignals</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript parameter">$axios</span><span class="token script language-javascript parameter punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript parameter"> limit</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#ff79c6">const</span><span class="token script language-javascript"> signals </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">await</span><span class="token script language-javascript"> $axios</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript method function property-access" style="color:#8be9fd">$get</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token script language-javascript template-string string" style="color:#f1fa8c">http://localhost:8000/signals?limit=</span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token script language-javascript template-string interpolation">limit</span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript template-string template-punctuation string" style="color:#f1fa8c">`</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">return</span><span class="token script language-javascript"> signals</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword module" style="color:#ff79c6">export</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword module" style="color:#ff79c6">default</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript function" style="color:#8be9fd">data</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">return</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">        signals</span><span class="token script language-javascript operator" style="color:#ff79c6">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">[</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">]</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#6272a4">// Handle initial call</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#ff79c6">async</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#8be9fd">asyncData</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript parameter punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript parameter"> $axios </span><span class="token script language-javascript parameter punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword" style="color:#ff79c6">const</span><span class="token script language-javascript"> signals </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">await</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#8be9fd">fetchSignals</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript">$axios</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript constant" style="color:#bd93f9">LIMIT</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">return</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"> signals </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    methods</span><span class="token script language-javascript operator" style="color:#ff79c6">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#6272a4">// Calculate uptime based on the signals belongs to a URL</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript function-variable function" style="color:#8be9fd">uptime</span><span class="token script language-javascript operator" style="color:#ff79c6">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript parameter">records</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#ff79c6">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style="color:#ff79c6">let</span><span class="token script language-javascript"> availableRecords </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> records</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript method function property-access" style="color:#8be9fd">filter</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript parameter">record</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#ff79c6">=&gt;</span><span class="token script language-javascript"> record</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript property-access">available</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">          </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript property-access">length</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">        </span><span class="token script language-javascript keyword control-flow" style="color:#ff79c6">return</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript">availableRecords </span><span class="token script language-javascript operator" style="color:#ff79c6">/</span><span class="token script language-javascript"> records</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript property-access">length</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#ff79c6">*</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#50fa7b">100</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript method function property-access" style="color:#8be9fd">toFixed</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript number" style="color:#50fa7b">2</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#6272a4">// Set up periodic calls when the component is mounted</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript function" style="color:#8be9fd">mounted</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword" style="color:#ff79c6">let</span><span class="token script language-javascript"> that </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:#ff79c6">this</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword" style="color:#ff79c6">const</span><span class="token script language-javascript"> axios </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:#ff79c6">this</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript property-access">$axios</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript function" style="color:#8be9fd">setInterval</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#ff79c6">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">        </span><span class="token script language-javascript known-class-name class-name">Promise</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript method function property-access" style="color:#8be9fd">resolve</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript function" style="color:#8be9fd">fetchSignals</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript">axios</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript constant" style="color:#bd93f9">LIMIT</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript method function property-access" style="color:#8be9fd">then</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">(</span><span class="token script language-javascript parameter">signals</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style="color:#ff79c6">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">          that</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">.</span><span class="token script language-javascript property-access">signals</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#ff79c6">=</span><span class="token script language-javascript"> signals</span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">      </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#50fa7b">1000</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#ff79c6">*</span><span class="token script language-javascript"> </span><span class="token script language-javascript constant" style="color:#bd93f9">LIMIT</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">)</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript punctuation" style="color:#f8f8f2">,</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#f8f8f2">}</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">script</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>At the first sight, it might look a lot, but if we check the most important
parts in pieces everything will be crystal clear.</p><p>We define <code>fetchSignals</code> to reduce code duplication later on. Then, we set up
initial <code>signals</code> data, where we will store the periodically fetched responses
returned by the backed. After that, as part of <code>asyncData</code>, we initiate an async
call towards the backend to get the initial signals to show.</p><p>The last part is to define a periodic call to the backend when the component is
<code>mounted</code>. Right, we have the logic which will call backend and keep the data up
to date. Now we have to display the results.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI html"><div tabindex="0" class="prism-code language-html codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">&lt;!-- frontend/pages/index.vue --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">template</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">p-8 h-screen text-center</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">h1</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">text-2xl font-light</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain">QuestDB website status</span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">h1</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">h2</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">text-lg font-thin</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain">service uptime in the past 60 minutes</span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">h2</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">h-8 mt-12 flex justify-center</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">signals.length &gt; 0</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">&lt;!-- Iterate over the signals belongs to records --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">w-1/4</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">v-for</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">(signal, s) in signals</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">:key</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">s</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">flex mb-1 text-sm</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">flex-1 text-left font-normal</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain">{{ signal.url }}</span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">flex-1 text-right font-thin</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            {{ uptime(signal.records) }}% uptime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">grid grid-flow-col auto-cols-max gap-x-1</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token comment" style="color:#6272a4">&lt;!-- Draw a green or yellow bar depending on service availability --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#f1fa8c">            </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">v-for</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">(signal, r) in signal.records</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#f1fa8c">            </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">:key</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">r</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#f1fa8c">            </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">:class</span><span class="token tag attr-value punctuation attr-equals" style="color:#f8f8f2">=</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag attr-value" style="color:#f1fa8c">`w-1 bg-${signal.available ? </span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&#x27;</span><span class="token tag attr-value" style="color:#f1fa8c">green</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&#x27;</span><span class="token tag attr-value" style="color:#f1fa8c"> : </span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&#x27;</span><span class="token tag attr-value" style="color:#f1fa8c">yellow</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&#x27;</span><span class="token tag attr-value" style="color:#f1fa8c">}-700`</span><span class="token tag attr-value punctuation" style="color:#f8f8f2">&quot;</span><span class="token tag" style="color:#f1fa8c"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#f1fa8c">          </span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token entity named-entity">&amp;nbsp;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">&lt;!-- In case we have no records yet, show an informative message --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag" style="color:#f1fa8c"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">v-else</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain">No signals found</span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">p</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">div</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token tag punctuation" style="color:#f8f8f2">&lt;/</span><span class="token tag" style="color:#f1fa8c">template</span><span class="token tag punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">&lt;!-- scripts ... --&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="run-the-project"></a>Run the project<a class="hash-link" href="#run-the-project" title="Direct link to heading">#</a></h2><p>We reached the end of the tutorial. We have both the backend and the frontend.
It is time to try everything out. Run the following commands in different shells
from the project root:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Shell 1 - Start the application</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ docker-compose up -d</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ poetry run uvicorn app.main:app --host </span><span class="token number" style="color:#50fa7b">127.0</span><span class="token plain">.0.1 --port </span><span class="token number" style="color:#50fa7b">8000</span><span class="token plain"> --reload</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Shell 2 - Start the worker process</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ poetry run celery --app</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">app.tasks worker --beat -l info -Q main-queue -c </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Shell 3 - Start the frontend</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> frontend</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">yarn</span><span class="token plain"> dev</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Navigate to <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000</a> to see the backend
reporting the status of the monitored URL. The first task to check the system
status is executed when the scheduler and worker starts and the status of the
website over time can be seen after a few minutes on the page or when you check
back at a later stage:</p><figure><img alt="An uptime indicator having fetched the status of the QuestDB website over 3 minutes" class="image_Pw1y margin_Rc0b shadow_7z-4 title_f-p+" height="284" src="/img/blog/2021-01-13/end-result-2.png" width="650"><figcaption class="caption_-tGK">Finished statuspage indicator</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>We&#x27;ve successfully built a pretty status page that can be publicly-visible to
users or used for internal teams to monitor an application&#x27;s uptime. We&#x27;ve
learned how to queue and schedule tasks and store the responses in a time-series
database and make use of low-latency queries. Engineers can modify this demo to
monitor a website&#x27;s HTTP response code or multiple endpoints or services for a
robust overview of an entire system&#x27;s status.</p><p>Thank you for your attention!</p><p><em>The containerized source code is available at
<a href="https://github.com/gabor-boros/questdb-statuspage" target="_blank" rel="noopener noreferrer">https://github.com/gabor-boros/questdb-statuspage</a>.</em></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/python">python</a><a class="margin-horiz--sm" href="/blog/tags/fastapi">fastapi</a><a class="margin-horiz--sm" href="/blog/tags/monitoring">monitoring</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/01/18/low-code-bitcoin-ticker-workflow-with-time-series-database"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« A low-code bitcoin ticker built with QuestDB and n8n.io</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/01/11/sql-extensions-for-timeseries-data"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">SQL Extensions for Time-Series Data in QuestDB »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.a0cde2ea.js" defer="defer"></script>
<script src="/gitplechat.js"></script>
</body>
</html>