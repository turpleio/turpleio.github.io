<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Querying data in a Jupyter Notebook | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Querying data in a Jupyter Notebook | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Use a Jupyter notebook to create a database, insert and query data and graph the results using Python."><meta data-react-helmet="true" name="twitter:description" content="Use a Jupyter notebook to create a database, insert and query data and graph the results using Python."><meta data-react-helmet="true" property="og:description" content="Use a Jupyter notebook to create a database, insert and query data and graph the results using Python."><meta data-react-helmet="true" name="twitter:title" content="Querying data in a Jupyter Notebook | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Querying data in a Jupyter Notebook | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="python,pandas,jupiternotebook,timeseries,questdb"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-python.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-python.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Querying data in a Jupyter Notebook</h1><time datetime="2020-06-15T00:00:00.000Z" class="date_A31P">June 15, 2020 · 6 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/davidgs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/davidgs" alt="David G. Simmons"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/davidgs" target="_blank" rel="noopener noreferrer">David G. Simmons</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><figure><img alt="A software developer typing code on a laptop" class="image_1-Fc image--title_Z46g" height="365" src="/img/blog/2020-06-15/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/photos/npxXWgQ33ZQ" target="_blank" rel="noopener noreferrer">Glenn Carstens-Peters</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>This tutorial shows how to use QuestDB with a Jupyter notebook. We will learn
how to create a database, query data and read table contents into a Pandas
dataframe, and use <code>matplotlib</code> to create charts of our table data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="getting-started"></a>Getting started<a class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><p>To get started, you&#x27;ll need a few things installed and set up. This should be
quick.</p><p><strong>QuestDB:</strong> To download QuestDB, you can find complete instructions for getting
started with <a href="/docs/get-started/docker">Docker</a>,
<a href="/docs/get-started/homebrew">Homebrew</a> on macOS, or the
<a href="/docs/get-started/binaries">binaries</a>.</p><p><strong>Jupyter Notebooks:</strong> These are interactive Python environments that will help
you run a complete version of this tutorial. To run it, you should:</p><ul><li>make sure you are running Python 3.x and not Python 2.7. If you&#x27;re in doubt,
<code>python --version</code> will tell you.</li><li>install Jupyter Notebooks with <code>pip3 install --upgrade ipython jupyter</code> make
sure that the libraries we use in this tutorial are also installed with
<code>pip3 install requests urlib matplotlib pandas</code></li><li>clone <a href="https://github.com/davidgs/QuestNotebook" target="_blank" rel="noopener noreferrer">this repository</a>
(<code>git clone https://github.com/davidgs/QuestNotebook</code>) in the repository
directory run Jupyter Notebook</li></ul><p>That will get you right back to a page that looks eerily similar to this that is
interactive, allowing you to run the code and interact with the database
yourself.</p><p>If you get errors like <code>ModuleNotFoundError: No module named &#x27;requests&#x27;</code> for any
of the libraries you installed above, double-check to make sure that you are
actually using Python 3.x <code>jupytper --path</code> will let you know if Jupyter is
using 2.7 or 3.x</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-database"></a>Create a database<a class="hash-link" href="#create-a-database" title="Direct link to heading">#</a></h2><p>We will need someplace to store our data, so let&#x27;s create a test database where
we can put some random data. We will create a simple table with 5 columns, one
of which is a timestamp.</p><p>The create operation in QuestDB appends records to the bottom of a table. If the
table has a designated new record, timestamps must be greater than, or equal to
the latest timestamp. Attempts to add a timestamp in middle of a table will
result in a timestamp out of order error.</p><ul><li><p><code>cust_id</code> is the customer identifier. It uniquely identifies a customer.</p></li><li><p><code>balance_ccy</code> balance currency. We use char in this example, but we could use
<code>SYMBOL</code> to avoid storing text against each record to save space and increase
database performance.</p></li><li><p><code>balance</code> is the current balance for customer and currency tuple.</p></li><li><p><code>inactive</code> is used to flag deleted records.</p></li><li><p><code>timestamp</code> timestamp in microseconds of the record. Note that if you receive
the timestamp data as a string, it could also be inserted using
<code>to_timestamp</code>.</p></li></ul><p>This should return a <code>200</code> status the first time you run it. If you run it more
than once, subsequent runs will return <code>400</code> because the database already
exists.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> urllib</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">parse </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> par</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  q </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;create table balances&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27;(cust_id int,&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27; balance_ccy char,&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27;balance double,&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27;inactive boolean,&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp timestamp)&#x27;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&#x27;timestamp(timestamp)&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  r </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:9000/exec?query=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> q</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="generate-some-data"></a>Generate some data<a class="hash-link" href="#generate-some-data" title="Direct link to heading">#</a></h2><p>Since we have a new setup, we should add some data to QuestDB so that we can
have something to query. We will add some random data, for now. You can re-run
this section as many times as you want to add 100 entries at a time, or simply
change the <code>range(100)</code> to add as many datapoints as you wish.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> random</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">success </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fail </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">currency </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;$&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;€&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;£&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;¥&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">random</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> x </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">range</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  cust </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> random</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">20</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">42</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  cur </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> random</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">currency</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  bal </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">round</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">random</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">10.45</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">235.15</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  act </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">bool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">random</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">getrandbits</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;insert into balances values(&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cust</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;,&#x27;&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> cur </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&#x27;,&quot;</span><span class="token plain"> \</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bal</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;,&quot;</span><span class="token plain"> \</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">act</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;,systimestamp())&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  r </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:9000/exec?query=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> query</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">200</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    success </span><span class="token operator" style="color:#ff79c6">+=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    fail </span><span class="token operator" style="color:#ff79c6">+=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Rows inserted: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">success</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> fail </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Rows Failed: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fail</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="query-data-from-questdb"></a>Query data from QuestDB<a class="hash-link" href="#query-data-from-questdb" title="Direct link to heading">#</a></h2><p>Now that we have data available, let&#x27;s try querying some of it to see what we
get back!</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> io</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">r </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:9000/exp?query=select * from balances&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rawData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">text</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rawData</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="read-the-content-into-pandas-dataframe"></a>Read the content into pandas dataframe<a class="hash-link" href="#read-the-content-into-pandas-dataframe" title="Direct link to heading">#</a></h2><p>So you&#x27;ll notice that the returned data is just a massive CSV string. If you&#x27;d
rather have JSON data, then you would change the endpoint to
<code>http://localhost:9000/exec</code>, but since we&#x27;re going to use Pandas to frame our
data, we&#x27;ll stick with CSV.</p><p>We are also telling pandas to parse the <code>timestamp</code> field as a date. This is
important since we&#x27;re dealing with time series data.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> pd</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StringIO</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rawData</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parse_dates</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pData</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="narrow-the-search"></a>Narrow the search<a class="hash-link" href="#narrow-the-search" title="Direct link to heading">#</a></h2><p>That&#x27;s just getting us all the data, but let&#x27;s narrow the search using some SQL
clauses. Let&#x27;s look for a specific <code>cust_id</code> and only balances of that customer
that are in USD.</p><p>We are also only interested in times the customer was active. Since this is SQL,
you can make this query as simple, or as complex, as you&#x27;d like. All of the data
was generated randomly, so this exact query may return no results, you may have
to adjust the <code>cust_id</code> below until you get results back.</p><p><strong>Note:</strong> The query string must be URL-encoded before it is sent.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> urllib</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">parse</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">q </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;select cust_id,&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; balance,&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; balance_ccy,&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; inactive,&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; timestamp&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; from balances&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; where cust_id = 26&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; and balance_ccy = &#x27;$&#x27;&quot;</span><span class="token plain">\</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot; and not inactive&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">query </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> urllib</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">parse</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">quote</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">q</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">r </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:9000/exp?query=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> query</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">queryData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">text</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rawData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StringIO</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">queryData</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parse_dates</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rawData</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="plot-the-data"></a>Plot the data<a class="hash-link" href="#plot-the-data" title="Direct link to heading">#</a></h2><p>We will use matplotlib to plot the data</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> matplotlib </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> pyplot </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> plt</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rawData</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;timestamp&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;balance&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> subplots</span><span class="token operator" style="color:#ff79c6">=</span><span class="token boolean" style="color:#bd93f9">True</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>From that query we should get a nice little plot of our data, like this:</p><p><img alt="Graph of the balance from the query" src="/assets/images/graph-74ca7ab3894ace758b8b488c232d2327.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="clean-up"></a>Clean up<a class="hash-link" href="#clean-up" title="Direct link to heading">#</a></h2><p>Now we will clean everything up for the next time.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">r </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:9000/exec?query=drop table balances&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">200</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Database Table dropped&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">else</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Database Table not Dropped: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">str</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>You can now stop your QuestDB instance, if you&#x27;d like, or leave it running and
find some great uses for it! If you enjoyed this tutorial, please
<a href="https://twitter.com/intent/follow?screen_name=QuestDB" target="_blank" rel="noopener noreferrer">follow us</a> on Twitter,
and make sure you give our
<a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer">GitHub repository</a> a star!</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/python">python</a><a class="margin-horiz--sm" href="/blog/tags/pandas">pandas</a><a class="margin-horiz--sm" href="/blog/tags/jupyternotebook">jupyternotebook</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/07/01/we-put-a-sql-database-on-the-internet"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Demo launch on HackerNews retrospective</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/06/05/iot-on-questdb"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Sending IoT sensor data from Arduino to QuestDB »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.e53824dd.js" defer="defer"></script>
</body>
</html>