<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">My journey making QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="My journey making QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" name="twitter:description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" property="og:description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" name="twitter:title" content="My journey making QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;My journey making QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="hackernews,story,startup,founder,cto,timeseries,database,ycombinator,open source"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2020-08-06/banner.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2020-08-06/banner.jpg"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">My journey making QuestDB</h1><time datetime="2020-08-06T00:00:00.000Z" class="date_A31P">August 6, 2020 · 6 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/bluestreak01" alt="Vlad Ilyushchenko"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/bluestreak01" target="_blank" rel="noopener noreferrer">Vlad Ilyushchenko</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><figure><img alt="A path going into the morning mist" class="image_1-Fc image--title_Z46g" height="393" src="/img/blog/2020-08-06/banner.jpg" width="650"><figcaption class="caption_VLGg"> Photo by<a href="https://unsplash.com/photos/ptSJZoEjp3M" target="_blank" rel="noopener noreferrer">Wesley Tingey</a>on<a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a> </figcaption></figure><p>A few weeks ago, I posted
<a href="https://news.ycombinator.com/item?id=23975807" target="_blank" rel="noopener noreferrer">the story of how I started QuestDB on Hacker News</a>.
Several people found the story interesting, so I thought I would post it here
and describe the passage from working at a large energy trading company,
discovering memory-mapping approaches in Java, the beginnings of building the
system as a side-project, and how we got to where we are today with companies
relying on production instances of our time-series database.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-i-started-building-an-open-source-time-series-database"></a>How I started building an open source time series database<a class="hash-link" href="#how-i-started-building-an-open-source-time-series-database" title="Direct link to heading">#</a></h2><p>It started in 2012 when an energy trading company hired me to rebuild their
real-time vessel tracking system. Management wanted me to use a well-known XML
database that they had just bought a license for. This option would have
required to take down production for about a week just to ingest the data. And a
week downtime was not an option. With no more money to spend on software, I
turned to alternatives such as OpenTSDB but they were not a fit for our data
model. There was no solution in sight to deliver the project.</p><p>Then, I stumbled upon
<a href="https://github.com/peter-lawrey/Java-Chronicle" target="_blank" rel="noopener noreferrer">Peter Lawrey’s Java Chronicle library</a>.
It loaded the same data in 2 minutes instead of a week using memory-mapped
files. Besides the performance aspect, I found it fascinating that such a simple
method was solving multiple issues simultaneously: fast write, read can happen
even before data is committed to disk, code interacts with memory rather than IO
functions, no buffers to copy. Incidentally, this was my first exposure to
zero-GC Java.</p><p>But there were several issues. First, at the time It didn’t look like the
library was going to be maintained. Second, it used Java NIO instead of using
the OS API directly. This adds overhead since it creates individual objects with
sole purpose to hold a memory address for each memory page. Third, although the
NIO allocation API was well documented, the release API was not. It was really
easy to run out of memory and hard to manage memory page release. I decided to
ditch the XML DB and then started to write a custom storage engine in Java,
similar to what Java Chronicle did. This engine used memory mapped files,
off-heap memory and a custom query system for geospatial time series.
Implementing this was a refreshing experience. I learned more in a few weeks
than in years on the job.</p><p>Throughout my career, I mostly worked at large companies where developers are
“managed” via itemized tasks sent as tickets. There was no room for creativity
or initiative. In fact, it was in one’s best interest to follow the ticket&#x27;s
exact instructions, even if it was complete nonsense. I had just been promoted
to a managerial role and regretted it after a week. After so much time hoping
for a promotion, I immediately wanted to go back to the technical side. I became
obsessed with learning new stuff again, particularly in the high performance
space.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="turning-an-open-source-idea-into-a-full-time-project"></a>Turning an open source idea into a full-time project<a class="hash-link" href="#turning-an-open-source-idea-into-a-full-time-project" title="Direct link to heading">#</a></h2><p>With some money aside, I left my job and started to work on QuestDB solo. I used
Java and a small C layer to interact directly with the OS API without passing
through a selector API. Although existing OS API wrappers would have been easier
to get started with, the overhead increases complexity and hurts performance. I
also wanted the system to be completely GC-free. To do this, I had to build
off-heap memory management myself and I could not use off-the-shelf libraries. I
had to rewrite many of the standard ones over the years to avoid producing any
garbage.</p><p>As I had my first kid, I had to take contracting gigs to make ends meet over the
following 6 years. All the stuff I had been learning boosted my confidence and I
started performing well at interviews. This allowed me to get better paying
contracts, I could take fewer jobs and free up more time to work on QuestDB
while looking after my family. I would do research during the day and implement
this into QuestDB at night. I was constantly looking for the next thing, which
would take performance closer to the limits of the hardware.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="learning-important-lessons-from-mistakes"></a>Learning important lessons from mistakes<a class="hash-link" href="#learning-important-lessons-from-mistakes" title="Direct link to heading">#</a></h2><p>A year in, I realised that my initial design was actually flawed and that it had
to be thrown away. It had no concept of separation between readers and writers
and would thus allow dirty reads. Storage was not guaranteed to be contiguous,
and pages could be of various non-64-bit-divisible sizes. It was also very much
cache-unfriendly, forcing the use of slow row-based reads instead of fast
columnar and vectorized ones. Commits were slow, and as individual column files
could be committed independently, they left the data open to corruption.</p><p>Although this was a setback, I got back to work. I wrote the new engine to allow
atomic and durable multi-column commits, provide repeatable read isolation, and
for commits to be instantaneous. To do this, I separated transaction files from
the data files. This made it possible to commit multiple columns simultaneously
as a simple update of the last committed row id. I also made storage dense by
removing overlapping memory pages and writing data byte by byte over page edges.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="turning-goals-into-a-reality"></a>Turning goals into a reality<a class="hash-link" href="#turning-goals-into-a-reality" title="Direct link to heading">#</a></h2><p>This new approach improved query performance. It made it easy to split data
across worker threads and to optimise the CPU pipeline with prefetch. It
unlocked column-based execution and additional virtual parallelism with
<a href="https://news.ycombinator.com/item?id=22803504" target="_blank" rel="noopener noreferrer">SIMD instruction sets</a> thanks to
<a href="https://www.agner.org/optimize/vectorclass.pdf" target="_blank" rel="noopener noreferrer">Agner Fog’s Vector Class Library</a>.
It made it possible to implement more recent innovations like our
<a href="https://github.com/questdb/questdb/blob/master/core/src/main/c/share/rosti.h" target="_blank" rel="noopener noreferrer">own version of Google SwissTable</a>.
I published more details when we released a demo server a few weeks ago on
<a href="https://news.ycombinator.com/item?id=23616878" target="_blank" rel="noopener noreferrer">ShowHN</a>. This
<a href="https://" target="_blank" rel="noopener noreferrer">demo</a> is still available to try online with a pre-loaded dataset
of 1.6 billion rows. Although it was hard and discouraging at first, this
rewrite turned out to be the second best thing that happened to QuestDB.</p><p>The best thing was that people started to contribute to the project. I am really
humbled that Tanc and Nic left our previous employer to build QuestDB. A few
months later, former colleagues of mine left their stable low-latency jobs at
banks to join us. I take this as a huge responsibility and I don’t want to let
these guys down. The amount of work ahead gives me headaches and goosebumps at
the same time.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/company">company</a><a class="margin-horiz--sm" href="/blog/tags/entrepreneurship">entrepreneurship</a><a class="margin-horiz--sm" href="/blog/tags/engineering">engineering</a><a class="margin-horiz--sm" href="/blog/tags/hackernews">hackernews</a><a class="margin-horiz--sm" href="/blog/tags/startup">startup</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/08/19/memory-mapping-deep-dive"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Re-examining our approach to memory mapping</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/07/24/use-questdb-for-swag"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">QuestDB swag for our community members! »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.202cfa5e.js" defer="defer"></script>
</body>
</html>