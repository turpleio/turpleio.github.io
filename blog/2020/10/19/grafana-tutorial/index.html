<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Build a monitoring dashboard with QuestDB and Grafana | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Build a monitoring dashboard with QuestDB and Grafana | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Use Grafana with QuestDB to build a monitoring dashboard for visualization of time series data."><meta data-react-helmet="true" name="twitter:description" content="Use Grafana with QuestDB to build a monitoring dashboard for visualization of time series data."><meta data-react-helmet="true" property="og:description" content="Use Grafana with QuestDB to build a monitoring dashboard for visualization of time series data."><meta data-react-helmet="true" name="twitter:title" content="Build a monitoring dashboard with QuestDB and Grafana | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Build a monitoring dashboard with QuestDB and Grafana | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="timeseries,questdb,grafana"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-grafana.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-grafana.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a><a class="navbar__item navbar__link" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Build a monitoring dashboard with QuestDB and Grafana</h1><time datetime="2020-10-19T00:00:00.000Z" class="date_A31P">October 19, 2020 · 8 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/jaugsburger" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/jaugsburger" alt="Joan Augsburger"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/jaugsburger" target="_blank" rel="noopener noreferrer">Joan Augsburger</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><figure><img alt="A dashboard showing several graphs with operationnal data" class="image_1-Fc image--title_Z46g" height="433" src="/img/blog/2020-10-19/banner.jpg" width="650"><figcaption class="caption_VLGg">Photo by <a href="https://unsplash.com/photos/JKUTrJ4vK00" target="_blank" rel="noopener noreferrer">Luke Chesser</a> via <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption></figure><p>In this tutorial, we will cover how to load demo data from <code>.CSV</code> files into
QuestDB and to use this as a data source for a Grafana dashboard. The dashboard
will have line charts as data visualizations that make use of aggregate SQL
functions and Grafana global variables for sampling data based on dashboard
settings.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="what-is-grafana"></a>What is Grafana?<a class="hash-link" href="#what-is-grafana" title="Direct link to heading">#</a></h2><p>Grafana is an open-source visualization tool consisting of a server that
connects to one or more data-sources to retrieve data, which is then visualized
by the user in a browser.</p><p>The following three Grafana features will be used in this tutorial:</p><ol><li><strong>Data source</strong> - this is how you tell Grafana where your data is stored and
how you want to access it. For this tutorial, we will have a QuestDB server
running which we will access via Postgres Wire using the PostgreSQL data
source plugin.</li><li><strong>Dashboard</strong> - A group of widgets that are displayed together on the same
screen.</li><li><strong>Panel</strong> - A single visualization which can be a graph or table.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setup"></a>Setup<a class="hash-link" href="#setup" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="start-grafana"></a>Start Grafana<a class="hash-link" href="#start-grafana" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -p </span><span class="token number" style="color:#50fa7b">3000</span><span class="token plain">:3000 grafana/grafana</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Once the Grafana server has started, you can access it via port 3000
(<a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000</a>). The default login credentials
are as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">user:admin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">password:admin</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="start-questdb"></a>Start QuestDB<a class="hash-link" href="#start-questdb" title="Direct link to heading">#</a></h3><p>The Docker version for QuestDB can be run exposing the port <code>8812</code> for the
PostgreSQL connection and port <code>9000</code> for the web and REST interface:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker run -p </span><span class="token number" style="color:#50fa7b">8812</span><span class="token plain">:8812 -p </span><span class="token number" style="color:#50fa7b">9000</span><span class="token plain">:9000 questdb/questdb</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="loading-the-dataset"></a>Loading the dataset<a class="hash-link" href="#loading-the-dataset" title="Direct link to heading">#</a></h3><p>On our <a href="https://" target="_blank" rel="noopener noreferrer">live demo</a>, uses 10+ years of taxi data. For this tutorial,
we have a subset of that data, the data for the whole of February 2018. You can
download the compressed dataset
<a href="https://s3-eu-west-1.amazonaws.com/questdb.io/datasets/grafana_tutorial_dataset.tar.gz" target="_blank" rel="noopener noreferrer">from Amazon S3</a>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> https://s3-eu-west-1.amazonaws.com/questdb.io/datasets/grafana_tutorial_dataset.tar.gz </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> grafana_data.tar.gz</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">tar</span><span class="token plain"> -xvf grafana_data.tar.gz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>There should be two datasets available as <code>.CSV</code> files:</p><ul><li><code>weather.csv</code></li><li><code>taxi_trips_feb_2018.csv</code></li></ul><p>These can be imported via curl using the <code>/imp</code> REST entrypoint:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -F </span><span class="token assign-left variable" style="color:#ff79c6">data</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">@taxi_trips_feb_2018.csv http://localhost:9000/imp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -F </span><span class="token assign-left variable" style="color:#ff79c6">data</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">@weather.csv http://localhost:9000/imp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="creating-your-first-visualization"></a>Creating your first visualization<a class="hash-link" href="#creating-your-first-visualization" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-data-source"></a>Create a data source<a class="hash-link" href="#create-a-data-source" title="Direct link to heading">#</a></h3><p>In Grafana, select to the cog icon to expand the <strong>Configuration</strong> menu, select
<strong>Data Sources</strong> and click the <strong>Add data source</strong> button. Choose PostgreSQL
plugin and configure it with the following settings:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">host:localhost:8812</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">database:qdb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">user:admin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">password:quest</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SSL mode:disable</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>If <code>localhost</code> cannot be resolved by the Grafana docker image, the local IP
address of your machine should be used for the <strong>host</strong> field, e.g.
<code>192.168.0.3:8812</code>.</p><p>Note that Grafana does not validate that queries are read-only. This means it&#x27;s
possible to run queries such as <code>drop table x</code> in Grafana which would be
destructive to a dataset.</p><p>To protect against this, set a dedicated QuestDB instance <strong>read-only mode</strong> by
setting the property <code>http.security.readonly=true</code> in your <code>server.conf</code>.
Details of setting this configuration can be found on QuestDB&#x27;s
<a href="/docs/reference/configuration">configuration page</a>.</p><p>To avoid unnecessary memory usage, it is also recommended to disable SELECT query
cache by setting the property <code>pg.select.cache.enabled=false</code> in your <code>server.conf</code>.
That&#x27;s because Grafana does not use prepared statements when sending the queries
and the query cache becomes much less efficient.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-dashboard-and-a-panel"></a>Create a dashboard and a panel<a class="hash-link" href="#create-a-dashboard-and-a-panel" title="Direct link to heading">#</a></h3><p>Now that we have a data source and a dashboard, we can add a panel. Navigate to
<strong>+ Create</strong> and select <strong>Dashboard</strong>:</p><figure><img alt="Screenshot of a new dashboard with a &#x27;Add new panel&#x27; button" class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/add-new-panel.png"></figure><p>The new panel has a graphing area on the top half of the window and a query
builder in the bottom half:</p><figure><img alt="Screenshot of a blank panel after being created" class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/blank-panel.png"></figure><p>Toggle the query editor to <strong>text edit mode</strong> by clicking the pencil icon or by
clicking the <strong>Edit SQL</strong> button. The query editor will now accept SQL
statements that we can input directly:</p><figure><img alt="Screenshot showing how to toggle text edit mode" class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/toggle-text-edit.png"></figure><p>Paste the following query into the editor:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT pickup_datetime AS time,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">       avg(trip_distance) AS distance</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM (&#x27;taxi_trips_feb_2018.csv&#x27; timestamp(pickup_datetime))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE $__timeFilter(pickup_datetime)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY $__interval</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Click the time range selector above the chart and set the following date range:</p><ul><li>Set the <strong>From</strong> value to <code>2018-02-07 00:00:00</code></li><li>Set the <strong>To</strong> value to <code>2018-02-14 23:59:59</code> and click <strong>Apply time range</strong></li></ul><p>We have built our first panel with aggregations:</p><figure><img alt="A panel showing the average distance traveled, filtered by taxi type and with dynamic sampling." class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/first-panel.png"></figure><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="query-details"></a>Query details<a class="hash-link" href="#query-details" title="Direct link to heading">#</a></h4><p>To graph the average trip distance above, we use the <code>avg()</code> function on the
<code>trip_distance</code> column. This function aggregates data over the specified
sampling interval. If the sampling interval is <strong>1-hour</strong>, we are calculating
the average distance traveled during each 1-hour interval. You can find more
information on QuestDB
<a href="/docs/reference/function/aggregation">aggregate functions on our documentation</a>.</p><p>There are also 2 key Grafana-specific expressions used which can be identified
by the <code>$__</code> prefix:</p><p><code>$__interval</code> This is a dynamic interval based on the time range applied to the
dashboard. By using this function, the sampling interval changes automatically
as the user zooms in and out of the panel.</p><p><code>$__timeFilter(pickup_datetime)</code> tells Grafana to send the start-time and
end-time defined in the dashboard to the QuestDB server. Given the settings we
have configured so far with our date range, Grafana translates this to the
following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">pickupDatetime BETWEEN &#x27;2018-02-01T00:00:00Z&#x27; AND &#x27;2018-02-28T23:59:59Z&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>These are <strong>global variables</strong> which can be used in queries and elsewhere in
panels and dashboards. To learn more about the use of these variables, refer to
the
<a href="https://grafana.com/docs/grafana/latest/variables/variable-types/global-variables/#global-variables" target="_blank" rel="noopener noreferrer">Grafana reference documentation on Global variables</a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For existing Grafana query known issue, see <a href="/docs/third-party-tools/grafana/#known-issues">Known issues</a>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="adding-multiple-queries"></a>Adding multiple queries<a class="hash-link" href="#adding-multiple-queries" title="Direct link to heading">#</a></h3><p>You can add multiple queries to the same panel which will display multiple lines
on a graph. To demonstrate this, separate the taxi data into two series, one for
cash payments and one for card payments. The first query will have a default
name of <code>A</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">--Cash</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT pickup_datetime AS time,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">       avg(trip_distance) AS cash</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM (&#x27;taxi_trips_feb_2018.csv&#x27; timestamp(pickup_datetime))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE $__timeFilter(pickup_datetime)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">AND payment_type IN (&#x27;Cash&#x27;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY $__interval</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Click <strong>+ Query</strong> to add a second query (automatically labeled <code>B</code>) and paste
the following in text mode:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">--Card</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT pickup_datetime AS time,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">       avg(trip_distance) AS card</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM (&#x27;taxi_trips_feb_2018.csv&#x27; timestamp(pickup_datetime))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE $__timeFilter(pickup_datetime)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">AND payment_type IN (&#x27;Card&#x27;)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY $__interval</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Both queries are now layered on the same panel with a green line for cash and a
yellow line for card payments:</p><figure><img alt="A panel showing the average distance travelled, filtered by taxi type and with dynamic sampling." class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/panel-filtering-by-taxi-type.png"></figure><p>We can see in this graph that the distance traveled by those paying with cards
is longer than for those paying with cash. This could be due to the fact that
users usually carry less cash than the balance in their card.</p><p>Let’s add another panel:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pickup_datetime AS &quot;time&quot;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">count()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM (&#x27;taxi_trips_feb_2018.csv&#x27; timestamp(pickup_datetime))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">WHERE $__timeFilter(pickup_datetime)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY $__interval;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This is what our query looks like when viewing a time range of 28 days:</p><figure><img alt="A panel showing the number of trips over a month using dynamic sampling." class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/panel-count-of-taxi-trips-in-whole-month.png"></figure><p>Zooming in to a single day shows more detailed data points as we are sampling by
Grafana&#x27;s <code>$__interval</code> property:</p><figure><img alt="A panel showing the number of trips in a day using dynamic sampling." class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/panel-count-of-taxi-trips-in-a-day.png"></figure><p>The daily cycle of activity is visible, with rides peaking in the early evening
and reaching a low in the middle of the night.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="asof-join"></a>ASOF JOIN<a class="hash-link" href="#asof-join" title="Direct link to heading">#</a></h2><p><code>ASOF JOIN</code> allows us to join 2 tables based on timestamp where timestamps do
not exactly match. To join the taxi trips data with weather data, enter the
following query:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pickup_datetime as &quot;time&quot;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(fare_amount) as fare_amount,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    avg(rain1H) as rain1H</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">FROM ((&#x27;taxi_trips_feb_2018.csv&#x27; timestamp(pickup_datetime)) WHERE $__timeFilter(pickup_datetime))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">ASOF JOIN (weather.csv timestamp(timestamp))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SAMPLE BY $__interval;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To view a selected week in February 2018, select the time range picker above the
chart:</p><ul><li>Set the <strong>From</strong> value to <code>2018-02-07 00:00:00</code></li><li>Set the <strong>To</strong> value to <code>2018-02-14 23:59:59</code> and click <strong>Apply time range</strong></li><li>Enable dual Y-axis in the option panel by using <strong>Overrides</strong>, simply
assgining different axis placements and units for fields <code>fare_amount</code> and
<code>rain1H</code>.</li></ul><figure><img alt="Assign different placement and units respectively for average fare amount and hourly precipitation." class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/enable-2nd-y-axis.png"></figure><p>In this graph, we have 2 series, in green we have the fare amount sampled
dynamically, and in yellow we have the average precipitation per hour in
millimeters. From the graph, it’s hard to say whether there is a correlation
between rain and the amount spent on taxi rides.</p><figure><img alt="A panel showing taxi fares plotted against rain fall" class="image_Pw1y margin_Rc0b shadow_7z-4" src="/img/blog/2020-10-19/panel-taxi-fares-and-rain.png"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>We have learned how to import time series data into QuestDB and build a
dashboard with multiple queries in Grafana. If you like this content and want to
see more tutorials about third-party integrations, let us know
<a href="https://" target="_blank" rel="noopener noreferrer">in our Slack Community</a> or drop us a
<a href="https://" target="_blank" rel="noopener noreferrer">star on GitHub</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/grafana">grafana</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/10/20/authentication-for-influx-line-protocol"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Authentication for InfluxDB line protocol</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/10/16/taxi-drivers-are-options-traders"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">NYC taxi meter and options pricing »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"><div class="category_Ptbh"><span class="title_HpoE">Product</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/cloud/">Cloud</a></li><li><a class="link_vx7p" href="/enterprise/">Enterprise</a></li><li><a class="link_vx7p" href="/pricing/">Pricing</a></li><li><a class="link_vx7p" href="/use-cases/">Use Cases</a></li><li><a class="link_vx7p" href="/customers/">Customers</a></li><li><a class="link_vx7p" href="https://github.com/orgs/questdb/projects/1/views/5" rel="noopener noreferrer" target="_blank">Roadmap</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Developers</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/docs/">Docs</a></li><li><a class="link_vx7p" href="/blog/tags/tutorial/">Tutorials</a></li><li><a class="link_vx7p" href="/blog/">Blog</a></li><li><a class="link_vx7p" href="https://">Discussions</a></li><li><a class="link_vx7p" href="https://">Join Slack</a></li><li><a class="link_vx7p" href="/community/">Swag</a></li></ul></div><div class="category_Ptbh"><span class="title_HpoE">Company</span><ul class="items_Lw7J"><li><a class="link_vx7p" href="/about-us/">About us</a></li><li><a class="link_vx7p" href="/careers/">Careers</a></li></ul></div></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.db1fdb94.js" defer="defer"></script>
</body>
</html>