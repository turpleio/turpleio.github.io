<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">SQL Extensions for Time Series Data in QuestDB - Part II | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="SQL Extensions for Time Series Data in QuestDB - Part II | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="SQL extensions for time series data in QuestDB part II"><meta data-react-helmet="true" name="twitter:description" content="SQL extensions for time series data in QuestDB part II"><meta data-react-helmet="true" property="og:description" content="SQL extensions for time series data in QuestDB part II"><meta data-react-helmet="true" name="twitter:title" content="SQL Extensions for Time Series Data in QuestDB - Part II | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;SQL Extensions for Time Series Data in QuestDB - Part II | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="tutorial,sql,questdb,timeseries"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/2022-11-23/banner.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/2022-11-23/banner.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">SQL Extensions for Time Series Data in QuestDB - Part II</h1><time datetime="2022-11-23T00:00:00.000Z" class="date_A31P">November 23, 2022 Â· 9 min read</time><div class="avatar margin-vert--md"><a href="https://kovidrathee.medium.com/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://miro.medium.com/fit/c/96/96/0*_CwYR2OmNap47tQO.jpg" alt="Kovid Rathee"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://kovidrathee.medium.com/" target="_blank" rel="noopener noreferrer">Kovid Rathee</a></h4><small class="avatar__subtitle">Guest post</small></div></div></header><div class="markdown"><p>This post comes from <a href="https://kovidrathee.medium.com/" target="_blank" rel="noopener noreferrer">Kovid Rathee</a>, who,
following up on his
<a href="https://towardsdatascience.com/sql-extensions-for-time-series-data-in-questdb-f6b53acf3213" target="_blank" rel="noopener noreferrer">first tutorial</a>,
has put together another tutorial on SQL extensions for time series data in
QuestDB.</p><figure><img alt="A screenshot of the QuestDB Web Console with a SAMPLE BY query" class="image_1-Fc" height="467" src="/img/blog/2022-11-23/banner.png" width="650"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>This tutorial follows up on our previous one, where we introduced
<a href="https://towardsdatascience.com/sql-extensions-for-time-series-data-in-questdb-f6b53acf3213" target="_blank" rel="noopener noreferrer">SQL extensions in QuestDB</a>
that make time-series analysis easier. Today, you will learn about the
<a href="/docs/reference/sql/sample-by/"><code>SAMPLE BY</code> extension</a> in detail, which will
enable you to work with time-series data efficiently because of its simplicity
and flexibility.</p><p>To get started with this tutorial, you should know that <code>SAMPLE BY</code> is a SQL
extension in QuestDB that helps you group or bucket time-series data based on
the <a href="/docs/concept/designated-timestamp">designated timestamp</a>. This removes the
need for lengthy <code>CASE WHEN</code> statements and <code>GROUP BY</code> clauses. Not only that,
the <code>SAMPLE BY</code> extension enables you to quickly deal with many other
data-related issues, such as
<a href="/docs/reference/sql/sample-by#fill-options">missing data</a>,
<a href="/docs/reference/sql/sample-by#time-zone">incorrect timezones</a>, and
<a href="/docs/reference/sql/sample-by#with-offset">offsets</a>.</p><p>This tutorial assumes you have an up-and-running QuestDB instance ready for use.
Let&#x27;s dive straight into it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="setup"></a>Setup<a class="hash-link" href="#setup" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="import-sample-data"></a>Import sample data<a class="hash-link" href="#import-sample-data" title="Direct link to heading">#</a></h3><p>Similar to the previous tutorial, we&#x27;ll use
<a href="https://s3-eu-west-1.amazonaws.com/questdb.io/datasets/grafana_tutorial_dataset.tar.gz" target="_blank" rel="noopener noreferrer">the NYC taxi rides data for February 2018</a>.
You can use the following script that utilizes the
<a href="/docs/guides/importing-data-rest/">HTTP REST API</a> to upload data into QuestDB:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><div tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">curl https://s3-eu-west-1.amazonaws.com/questdb.io/datasets/grafana_tutorial_dataset.tar.gz &gt; grafana_data.tar.gz</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">tar -xvf grafana_data.tar.gz</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">curl -F data=@taxi_trips_feb_2018.csv http://localhost:9000/imp</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">curl -F data=@weather.csv http://localhost:9000/imp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Alternatively, you can use
<a href="/docs/develop/web-console#import">the import functionality in the QuestDB console</a>,
as shown in the image below:</p><p><img src="/assets/images/EWniDQq-66f4a0c497b20788bee38b5eb061d9ca.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-an-ordered-timestamp-column"></a>Create an ordered timestamp column<a class="hash-link" href="#create-an-ordered-timestamp-column" title="Direct link to heading">#</a></h3><p>The <code>SAMPLE BY</code> keyword mandates the use of the
<a href="/docs/concept/designated-timestamp/">designated timestamp</a> column to enable
further analysis. Therefore, you&#x27;ll have to elect the <code>pickup_datetime</code> column
as the designated timestamp in a new table called <code>taxi_trips</code> with the script
below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">TABLE</span><span class="token plain"> taxi_trips </span><span class="token keyword" style="color:#ff79c6">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips_feb_2018.csv&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">   </span><span class="token keyword" style="color:#ff79c6">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> pickup_datetime</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">TIMESTAMP</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">MONTH</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>By converting the <code>pickup_datetime</code> column to <code>timestamp</code>, you are allowing
QuestDB to use it as the table&#x27;s
<a href="/docs/concept/designated-timestamp/">designated timestamp</a>. Using this
designated timestamp column, QuestDB is able to index the table to run
time-based queries more efficiently. If it all goes well, you should see the
following data after running a <code>SELECT *</code> query on the <code>taxi_trips</code> table:</p><p><img src="/assets/images/QwI0YVe-6028484a8d2aa5f338f04f0136efd9c6.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="understanding-the-basics-of-sample-by"></a>Understanding the basics of <code>SAMPLE BY</code><a class="hash-link" href="#understanding-the-basics-of-sample-by" title="Direct link to heading">#</a></h2><p>The <code>SAMPLE BY</code> extension allows you to create groups and buckets of data based
on time ranges. This is especially valuable for time-series data as you can
calculate frequently used aggregates with extreme simplicity. <code>SAMPLE BY</code> offers
you the ability to summarize or aggregate data from very fine to very coarse
<a href="/docs/reference/sql/sample-by#sample-units">units of time</a>, i.e., from
microseconds to months and everything in between (milliseconds, seconds,
minutes, hours, and days). You can also derive other units of time, such as a
week, fortnight, and year from the ones provided out of the box.</p><p>Let&#x27;s look at some examples to understand how to use <code>SAMPLE BY</code> in different
scenarios.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="hourly-count-of-trips"></a>Hourly count of trips<a class="hash-link" href="#hourly-count-of-trips" title="Direct link to heading">#</a></h3><p>You can use the <code>SAMPLE BY</code> keyword with the
<a href="/docs/reference/sql/sample-by#sample-units">sample unit</a> of <code>h</code> to get an
hour-by-hour count of trips for the whole duration of the data set. Running the
following query, you&#x27;ll get results in the console:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain">h</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>There are two ways you can read your data in the QuestDB console: using the
grid, which has a tabular form factor, or using a chart, where you can draw up a
line, bar, or an area chart to
<a href="/docs/develop/web-console#visualizing-results">visualize your data</a>. Here&#x27;s an
example of a bar chart drawn from the above query:</p><p><img src="/assets/images/JHBiCI3-3b363068924770998c826bdf96b12b2c.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="three-hourly-holistic-summary-of-trips"></a>Three-hourly holistic summary of trips<a class="hash-link" href="#three-hourly-holistic-summary-of-trips" title="Direct link to heading">#</a></h3><p>The <code>SAMPLE BY</code> extension allows you to group data by any arbitrary number of
sample units. In the following example, you&#x27;ll see that the query is calculating
a three-hourly summary of trips with multiple aggregate functions:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">3</span><span class="token plain">h</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>You can view the output of the query in the following grid on the QuestDB
console:</p><p><img src="/assets/images/NG2sDIV-aa63c96e57326f99f45e9575524934c1.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="weekly-summary-of-trips"></a>Weekly summary of trips<a class="hash-link" href="#weekly-summary-of-trips" title="Direct link to heading">#</a></h3><p>As mentioned above, although there&#x27;s no sample unit for a week, a fortnight, or
a year, you can derive them simply by utilizing the built-in sample units. If
you want to sample the data by a week, use <code>7d</code> as the sampling time, as shown
in the query below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime </span><span class="token operator" style="color:#ff79c6">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">AND</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-28&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">7</span><span class="token plain">d</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/f5lVlQL-0d7432f46f2803cf492b0ef30f860b32.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="dealing-with-missing-data"></a>Dealing with missing data<a class="hash-link" href="#dealing-with-missing-data" title="Direct link to heading">#</a></h2><p>If you&#x27;ve worked a fair bit with data, you already know that data isn&#x27;t always
in a pristine state. One of the most common issues, especially with time-series
data, is discontinuity, i.e., scenarios where data is missing for specific time
periods. You can quickly identify and deal with missing data using the advanced
functionality of the <code>SAMPLE BY</code> extension.</p><p>QuestDB offers an easy way to generate and fill in missing data with the
<code>SAMPLE BY</code> clause. Take the following example: I&#x27;ve deliberately removed data
from 4 am to 5 am for the 1st of February 2018. Notice how the
<a href="/docs/reference/sql/sample-by#fill-options"><code>FILL</code> keyword</a>, when used in
conjunction with the <code>SAMPLE BY</code> extension, can generate a row for the hour
starting at 4 am and fill it with data generated from linear interpolation of
the 2 surrounding points:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime </span><span class="token operator" style="color:#ff79c6">NOT</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01T04:00:00&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">AND</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01T04:59:59&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain">h FILL</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">LINEAR</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/8hD7Lmw-0d5a4a5392ecfc51f6b6f8ad2d690e8b.png"></p><p>The <a href="/docs/reference/sql/sample-by#fill-options"><code>FILL</code></a> keyword demands a
<code>fillOption</code> from the following:</p><table><thead><tr><th><code>fillOption</code></th><th>Usage scenario</th><th>Notes</th></tr></thead><tbody><tr><td>NONE</td><td>When you don&#x27;t want to populate missing data, and leave it as is</td><td>This is the default <code>fillOption</code></td></tr><tr><td>NULL</td><td>When you want to generate rows for missing time periods, but leave all the values as NULLs</td><td></td></tr><tr><td>PREV</td><td>When you want to copy the values of the previous row from the summarized data</td><td>This is useful when you expect the numbers to be similar to the preceding time period</td></tr><tr><td>LINEAR</td><td>When you want to normalize the missing values, you can take the average of the immediately preceding and following row</td><td></td></tr><tr><td>CONST or x</td><td>When you want to hardcode values where data is missing</td><td>FILL (column_1, column_2, column_3, ...)</td></tr></tbody></table><p>Here&#x27;s another example of hardcoding values using the FILL(x) <code>fillOption</code>:</p><p><img src="/assets/images/gN0LO6g-af0768088cb4bdda1ab7bb08d257d7d9.png"></p><p>In the example above, we&#x27;ve used an inline <code>WHERE</code> clause to emulate missing
data with the help of the <code>NOT BETWEEN</code> keyword. Alternatively, you can create a
separate table with missing trips using the same idea, as shown below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">TABLE</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips_missing&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pickup_datetime </span><span class="token operator" style="color:#ff79c6">NOT</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01T04:00:00&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">AND</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01T04:59:59&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="working-with-timezones-and-offsets"></a>Working with timezones and offsets<a class="hash-link" href="#working-with-timezones-and-offsets" title="Direct link to heading">#</a></h2><p>The <code>SAMPLE BY</code> extension also enables you to change timezones and add or
subtract offsets from your timestamp columns to adjust for any issues you might
encounter when dealing with different source systems, especially in different
geographic areas. It is important to note that, by default, QuestDB aligns its
<a href="/docs/reference/sql/sample-by#sample-calculation">sample calculation</a> based on
the <code>FIRST OBSERVATION</code>, as shown in the example below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">WHERE</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime </span><span class="token operator" style="color:#ff79c6">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-01T13:35:52&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">AND</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;2018-02-28&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain">d</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/U9m6k6s-07c174970a6908322262f9d025edd49a.png"></p><p>Note that now the <code>1d</code> sample calculation starts at <code>13:35:52</code> and ends at
<code>13:35:51</code> the next day. Apart from the option demonstrated above, there are two
other ways to align your sample calculations - to the
<a href="/docs/reference/sql/sample-by#time-zone">calendar time zone</a>, and to
<a href="/docs/reference/sql/sample-by#with-offset">calendar with offset</a>.</p><p>Let&#x27;s take a look at the other two alignment methods.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="aligning-sample-calculation-to-another-timezone"></a>Aligning sample calculation to another timezone<a class="hash-link" href="#aligning-sample-calculation-to-another-timezone" title="Direct link to heading">#</a></h3><p>When moving data across systems, pipelines, and warehouses, you can encounter
issues with time zones. For the sake of demonstration, let&#x27;s assume that you&#x27;re
working in New York City, but you&#x27;ve identified that the timestamps of the data
set you&#x27;ve loaded into the database are in Australian Eastern Time (instead of
New York&#x27;s EST). Traditionally, this could lead to extra conversion work to
ensure that this new data is comparable to the rest of your data in EST.</p><p>QuestDB allows you to easily fix this issue by aligning your data to another
timezone using the
<a href="/docs/reference/sql/sample-by#time-zone"><code>ALIGN TO CALENDAR TIME ZONE</code> option</a>
with the <code>SAMPLE BY</code> extension. In the example shown below, you can see how an
<code>ALIGN TO CALENDAR TIME ZONE (&#x27;AEST&#x27;)</code> has aligned the <code>pickup_datetime</code>, i.e.,
the designated timestamp column to the AEST timezone for Melbourne.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">3</span><span class="token plain">h ALIGN </span><span class="token keyword" style="color:#ff79c6">TO</span><span class="token plain"> CALENDAR </span><span class="token keyword" style="color:#ff79c6">TIME</span><span class="token plain"> ZONE </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&#x27;AEST&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/szB7CMD-656555952cd91e7f8ac38ce864b506e6.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="aligning-sample-calculation-with-offsets"></a>Aligning sample calculation with offsets<a class="hash-link" href="#aligning-sample-calculation-with-offsets" title="Direct link to heading">#</a></h3><p>Similar to the previous example, you can also align the sample calculation by
<a href="/docs/reference/sql/sample-by#with-offset">offsetting the designated timestamp</a>
column manually by any <code>hh:mm</code> value between -23:59 to 23:59. In the following
example, we&#x27;re offsetting the sample calculation by -5:30, i.e., negative five
hours and thirty minutes:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">SELECT</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pickup_datetime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">COUNT</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_trips</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">passenger_count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_passengers</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">AVG</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">trip_distance</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> avg_trip_distance</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_fare_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_tip_amount</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">ROUND</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">SUM</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fare_amount </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> tip_amount</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> total_earnings</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">FROM</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#f1fa8c">&#x27;taxi_trips&#x27;</span><span class="token plain"> SAMPLE </span><span class="token keyword" style="color:#ff79c6">BY</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">3</span><span class="token plain">h ALIGN </span><span class="token keyword" style="color:#ff79c6">TO</span><span class="token plain"> CALENDAR </span><span class="token keyword" style="color:#ff79c6">WITH</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">OFFSET</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;-05:30&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img src="/assets/images/3xyC6kt-9f6866625dd1890af257ec810e09177f.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>In this tutorial, you learned how to exploit the
<a href="/docs/reference/sql/sample-by/"><code>SAMPLE BY</code> extension</a> in QuestDB to work
efficiently with time-series data, especially in aggregated form. In addition,
the <code>SAMPLE BY</code> extension also allows you to fix common problems with
time-series data attributable to complex data pipelines, disparate source
systems in different geographical areas, software bugs, etc. All in all, SQL
extensions in QuestDB, like <code>SAMPLE BY</code>, provide a significant advantage when
working with time-series data by enabling you to achieve more in fewer lines of
SQL.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/sql">sql</a><a class="margin-horiz--sm" href="/blog/tags/timeseries">timeseries</a><a class="margin-horiz--sm" href="/blog/tags/questdb">questdb</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« QuestDB 6.6.1 - Dynamic Commits</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/11/14/questdb-release-6.5.5"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">QuestDB 6.5.5 Release Â»</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">ë¬¸ìíê¸°</h3><p class="description_Bwvi">ì´ë©ì¼ì ìë ¥íìë©´ ìê°ìë£ë¥¼ ë³´ë´ëë¦½ëë¤.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">ë³´ë´ê¸°</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>ì¸íë¼ê´ë¦¬ë¶í° ìë¹ì¤ì´ìê¹ì§ í´ë¼ì°ëíê²½ì ìµì íë í´ë¼ì°ë ë¤ì´í°ë¸ íë«í¼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright Â© 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.185a1183.js" defer="defer"></script>
</body>
</html>