<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="turpleio">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Turple: Cloud Native Platform" href="/opensearch.xml">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Turple: Cloud Native Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Turple: Cloud Native Platform Blog Atom Feed"><title data-react-helmet="true">Visualizing cryptocurrency data with Python, Grafana and QuestDB | Turple: Cloud Native Platform</title><meta data-react-helmet="true" property="og:title" content="Visualizing cryptocurrency data with Python, Grafana and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="description" content="Learn how to using Python to fetch cryptocurrency data from Coinbase, store it in QuestDB, and visualize the data using Grafana."><meta data-react-helmet="true" name="twitter:description" content="Learn how to using Python to fetch cryptocurrency data from Coinbase, store it in QuestDB, and visualize the data using Grafana."><meta data-react-helmet="true" property="og:description" content="Learn how to using Python to fetch cryptocurrency data from Coinbase, store it in QuestDB, and visualize the data using Grafana."><meta data-react-helmet="true" name="twitter:title" content="Visualizing cryptocurrency data with Python, Grafana and QuestDB | Turple: Cloud Native Platform"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Visualizing cryptocurrency data with Python, Grafana and QuestDB | Turple: Cloud Native Platform&quot;"><meta data-react-helmet="true" name="keywords" content="questdb,python,grafana,crypto,database"><meta data-react-helmet="true" property="og:image" content="https://turpleio.github.io/img/blog/shared/og-bitcoin-grafana.png"><meta data-react-helmet="true" name="twitter:image" content="https://turpleio.github.io/img/blog/shared/og-bitcoin-grafana.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/css/styles.4f6557e4.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Turple: Cloud Native Platform">
<meta itemprop="description" content="Turple is a cloud native platform which can help you build and operate your services on cloud.">
<meta itemprop="url" content="https://turpleio.github.io">
<meta itemprop="logo" content="https://turpleio.github.io/img/favicon.png">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">QuestDB</a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="wrapper_DIJ0 blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_q+wC thin-scrollbar"><h3 class="sidebarItemTitle_9G5K">Recent posts</h3><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/19/merry-questmas-gifts-2023">Merry Questmas! Here are your gifts for 2023...</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/12/13/using-prometheus-loki-grafana-monitor-questdb-kubernetes">Using Prometheus, Loki, and Grafana to monitor QuestDB in Kubernetes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/30/full-table-scan-are-fast">Listen to Your CPU - Full-table Scans Are Fast</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/25/questdb-6.6.1-dynamic-commits">QuestDB 6.6.1 - Dynamic Commits</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2022/11/23/sql-extensions-time-series-data-questdb-part-ii">SQL Extensions for Time Series Data in QuestDB - Part II</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="title_KBQu">Visualizing cryptocurrency data with Python, Grafana and QuestDB</h1><time datetime="2022-03-15T00:00:00.000Z" class="date_A31P">March 15, 2022 · 7 min read</time><div class="avatar margin-vert--md"><a href="https://github.com/TheTanc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/TheTanc" alt="Tancrede Collard"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/TheTanc" target="_blank" rel="noopener noreferrer">Tancrede Collard</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><div class="markdown"><figure><img alt="Grafana logo, QuestDB logo, Bitcoin logo" class="image_1-Fc" height="467" src="/img/blog/2022-03-15/banner.png" width="650"></figure><p>This post comes from Tancrede Collard, who has written an excellent tutorial
that shows how to use Python to fetch cryptocurrency data from Coinbase, store
it in QuestDB, and visualize the data using Grafana. Thanks for the submission,
Tancrede!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="visualizing-time-series-data"></a>Visualizing time series data<a class="hash-link" href="#visualizing-time-series-data" title="Direct link to heading">#</a></h2><p>When analyzing streaming data such as cryptocurrency or market metrics, the
foundation of the data processing pipeline is efficient storage and queries. To
use this data for insights and analytics, data visualization is a convenient way
to plot and convey trends, create actionable reports, or even set up alerting.</p><p>Most cryptocurrency trading projects will focus on price charts and standard
indicators like <a href="https://www.investopedia.com/terms/r/rsi.asp" target="_blank" rel="noopener noreferrer">RSI</a> or moving
averages. Derivatives are often overlooked in many cryptocurrency analytics and
visualization projects, and there&#x27;s plenty to explore, such as the underlying
pricing metrics such as volatility and funding rates.</p><p>A lot of common off-the-shelf tools can plot prices over time, but few are
available for derivative features. Having control of the underlying database,
creating custom metrics, and building dashboards based on these metrics allows
us to build our own solutions with custom pricing inputs and models for
derivatives.</p><p>In this tutorial, you&#x27;ll learn how to fetch data from the Coinbase API using a
Python script, load the data into QuestDB and run SQL queries via QuestDB for
derivatives insights. We&#x27;ll be visualizing data using Grafana so that we can
build dashboards for reporting or alerts based on metrics you care about.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>To follow with this tutorial, you&#x27;ll need the following:</p><ul><li><a href="https://www.coinbase.com/signup" target="_blank" rel="noopener noreferrer">Coinbase</a> account with an
<a href="https://developers.coinbase.com/api/v2" target="_blank" rel="noopener noreferrer">API key</a></li><li><a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Homebrew</a> for macOS users</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="installing-questdb-using-homebrew"></a>Installing QuestDB using homebrew<a class="hash-link" href="#installing-questdb-using-homebrew" title="Direct link to heading">#</a></h2><p>Before we can start storing data, we&#x27;ll need to get QuestDB up and running.
Aside from running QuestDB from
<a href="https://questdb.io/get-questdb/" target="_blank" rel="noopener noreferrer">binaries and via Docker</a>, macOS users can get
started using homebrew:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">brew </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> questdb</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Additional settings can be changes in the
<a href="https://questdb.io/docs/reference/configuration/" target="_blank" rel="noopener noreferrer">server configuration</a> file
located at <code>/opt/homebrew/var/questdb/conf/server.conf</code> for the homebrew install.
The interface we&#x27;ll be using for inserting data is ILP
(<a href="https://questdb.io/docs/reference/api/ilp/overview/" target="_blank" rel="noopener noreferrer">InfluxDB line protocol</a>)
over TCP which runs on port 9009 by default. The server configuration for these
keys looks as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI ini"><div tabindex="0" class="prism-code language-ini codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">######################### LINE TCP settings ###############################</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">line.tcp.enabled=true</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">line.tcp.net.active.connection.limit=10</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">line.tcp.net.bind.to=0.0.0.0:9009</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To avoid unnecessary memory usage when using Grafana, it&#x27;s recommended to
disable QuestDB&#x27;s <code>SELECT</code> query cache with the following PostgreSQL property in
QuestDB&#x27;s server config:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI ini"><div tabindex="0" class="prism-code language-ini codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">pg.select.cache.enabled=false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>When we&#x27;ve set these server configuration properties, we can start up the
database service with
<a href="https://questdb.io/docs/reference/command-line-options/" target="_blank" rel="noopener noreferrer">QuestDB&#x27;s CLI</a>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">questdb start</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="fetching-data-from-coinbase-using-python"></a>Fetching data from Coinbase using Python<a class="hash-link" href="#fetching-data-from-coinbase-using-python" title="Direct link to heading">#</a></h2><p>Cryptocurrency data is readily available from a variety of public APIs. Coinbase
offers a simple API endpoint to get an indicative bid and offer price which is
all we need for our use case.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI http"><div tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">https://api.coinbase.com/v2/prices/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It requires an authorization token which you should obtain from your Coinbase
account. For this tutorial, we&#x27;ll use a simple Python script to periodically
poll the endpoint for a given currency pair. The loop does 3 things:</p><ol><li>fetch SELL (bid) and BUY (ask) prices</li><li>send the current bid &amp; ask prices to QuestDB via ILP</li><li>sleep 2 seconds before looping to step 1</li></ol><p>The script uses <code>requests</code> for the HTTP requests to the Coinbase API and
<code>socket</code> for the direct TCP communication to QuestDB. Replace <code>your_token</code> by
the API key from your Coinbase account:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI python"><div tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> socket</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> time </span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> sleep</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># QuestDB settings</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">HOST </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;localhost&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">PORT </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Auth</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">token</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&#x27;your_token&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Request settings</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pair</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&#x27;BTC-USD&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sellURL</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;https://api.coinbase.com/v2/prices/&quot;</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">pair</span><span class="token operator" style="color:#ff79c6">+</span><span class="token string" style="color:#f1fa8c">&quot;/sell&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">buyURL</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&quot;https://api.coinbase.com/v2/prices/&quot;</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">pair</span><span class="token operator" style="color:#ff79c6">+</span><span class="token string" style="color:#f1fa8c">&quot;/buy&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">PARAMS</span><span class="token operator" style="color:#ff79c6">=</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#f1fa8c">&#x27;Authorization&#x27;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;Bearer &#x27;</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">token</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">while</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token operator" style="color:#ff79c6">==</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4"># Get data from the API</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sellData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">sellURL</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> params</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">PARAMS</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            buyData </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">url</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">buyURL</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> params</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">PARAMS</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sp </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> sellData</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            bp </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> buyData</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&#x27;amount&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4"># Send data to QuestDB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sock </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">socket</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sock</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">HOST</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PORT</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sock</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">sendall</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&#x27;crypto,fromCCY=BTC,toCCY=USD,exch=CB bid=&#x27;</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">sp</span><span class="token operator" style="color:#ff79c6">+</span><span class="token string" style="color:#f1fa8c">&#x27;,ask=&#x27;</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">bp</span><span class="token operator" style="color:#ff79c6">+</span><span class="token string" style="color:#f1fa8c">&#x27;\n&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            sleep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>When you start the script, prices should appear in the web console for QuestDB.
Running <code>crypto</code> (this is shorthand for <code>SELECT * FROM crypto</code>) in the SQL
editor shows the prices flowing in QuestDB:</p><p><img alt="QuestDB web console" src="/assets/images/console-439aa5b572ccd51c563bac920e0e9ea4.png"></p><p>One important thing to note is that we didn&#x27;t create a table before sending
data. QuestDB automatically creates tables using the appropriate columns
detected from the message. The currency identifiers are inserted as
<a href="https://questdb.io/docs/concept/symbol/" target="_blank" rel="noopener noreferrer">symbol types</a>, and the values are
inserted as doubles. It&#x27;s also noteworthy that the record timestamp is set as
the server time when the row was inserted and tables created from ILP ingestion
have a default <code>day</code> partitioning. The schema looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">fromCCY: symbol</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">toCCY:   symbol</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">exch:    symbol</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">bid:     double</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">ask:     double</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="building-a-grafana-dashboard"></a>Building a Grafana dashboard<a class="hash-link" href="#building-a-grafana-dashboard" title="Direct link to heading">#</a></h2><p>Grafana is an excellent tool for data visualization, and it comes in extremely
handy If you&#x27;re doing any algorithmic trading. The variety of integrations with
other services enables you to quickly set up monitoring and alerts for
conditions like irregular prices or flow and risk limits.</p><p>This tutorial is tailored for macOS users, so we&#x27;ll use Homebrew, but there are
other options covered in the
<a href="https://questdb.io/docs/third-party-tools/grafana" target="_blank" rel="noopener noreferrer">QuestDB Grafana guide</a>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">brew </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> grafana</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">brew services start grafana</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To configure Grafana, open the UI available <code>http://localhost:3000</code> and
configure QuestDB:</p><ul><li>Go to the <code>Configuration</code> section and click on <code>Data sources</code></li><li>Click <code>Add data source</code></li><li>Choose the <code>PostgreSQL</code> plugin and configure it with the following settings:</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">host: localhost:8812</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">database: qdb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">user: admin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">password: quest</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">SSL mode: disable</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="calculating-indicative-bid-offers"></a>Calculating indicative bid offers<a class="hash-link" href="#calculating-indicative-bid-offers" title="Direct link to heading">#</a></h2><p>Let&#x27;s craft a query in Grafana that will allow us to plot the metrics we&#x27;re
interested in. Start off by creating a new dashboard and click on <code>new panel</code>.
The pencil icon allows you to provide a query to run against QuestDB for Grafana
to plot:</p><p><img alt="The edit icon in Grafana panel" src="/assets/images/grafana-pencil-53fe69687162bc0259815220bce0decc.png"></p><p>Paste the following query to create a time series of the bid-offer and mid
price:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI questdb-sql"><div tabindex="0" class="prism-code language-questdb-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">select</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  timestamp as time,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  avg(ask) as ask,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  avg(ask+bid)/2 as mid,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  avg(bid) as bid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">from crypto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">where $__timeFilter(timestamp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">and fromCCY=&#x27;BTC&#x27; and toCCY=&#x27;USD&#x27; and exch=&#x27;CB&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sample by $__interval</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>To simplify queries which have dynamic elements such as date ranges, the query
contains
<a href="https://grafana.com/docs/grafana/latest/variables/variable-types/global-variables/#global-variables" target="_blank" rel="noopener noreferrer">global variables</a>.
We&#x27;re using two:</p><ul><li><code>$__timeFilter(timestamp)</code> - allows filtering results by sending a start-time
and end-time to QuestDB; generates a <code>BETWEEN</code> clause.</li><li><code>$__interval</code> - calculates a dynamic interval based on the time range applied
to the dashboard. By using this function, the sampling interval changes
automatically as the user zooms in and out of the panel.</li></ul><p>At this point, we have a dashboard with ticking prices. We can start
experimenting with other parameters such as the colors or the sample frequency
for each of the series. The Grafana UI can be used to change the chart range and
resolution:</p><p><img alt="Low-resolution Cryptocurrency trade data in Grafana" src="/assets/images/grafana-low-res-45207b9bb9b1a43a2a852a37c2aef204.png"></p><p><img alt="High-resolution Cryptocurrency trade data in Grafana" src="/assets/images/grafana-high-res-c68024099461c29dda476925acba0b67.png"></p><p>Although our data is very simplistic right now (indicative bid an offer from one
platform on one pair), the nice thing about building this from scratch is that
we can calculate derived metrics such as the spread over time:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">select</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">timestamp</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">as</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">time</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">avg</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ask</span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain">bid</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#ff79c6">/</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">avg</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bid</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">ask</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#ff79c6">/</span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#ff79c6">*</span><span class="token number" style="color:#50fa7b">100</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">from</span><span class="token plain"> crypto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">where</span><span class="token plain"> $__timeFilter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">timestamp</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#ff79c6">and</span><span class="token plain"> fromCCY</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&#x27;BTC&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">and</span><span class="token plain"> toCCY</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&#x27;USD&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">and</span><span class="token plain"> exch</span><span class="token operator" style="color:#ff79c6">=</span><span class="token string" style="color:#f1fa8c">&#x27;CB&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">sample </span><span class="token keyword" style="color:#ff79c6">by</span><span class="token plain"> $__interval</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img alt="Spread prices visualized in Grafana" src="/assets/images/grafana-spread-2f94018473c20804979d101b91081fd8.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="next-steps"></a>Next steps<a class="hash-link" href="#next-steps" title="Direct link to heading">#</a></h2><p>There are many other things to do, such as pulling prices from various venues or
fetching order book data rather than indicative top-of-book. The next steps we
can take with this project that would be interesting to explore would be:</p><ul><li>Deriving forward curve and implied funding on cryptocurrency using futures
prices</li><li>Plotting crypto volatility smiles</li></ul><p>If you like this content, we&#x27;d love to know your thoughts! Feel free to share
your feedback or just come and say hello in the
<a href="https://" target="_blank" rel="noopener noreferrer">QuestDB Community Slack</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tutorial">tutorial</a><a class="margin-horiz--sm" href="/blog/tags/crypto">crypto</a><a class="margin-horiz--sm" href="/blog/tags/trading">trading</a><a class="margin-horiz--sm" href="/blog/tags/python">python</a><a class="margin-horiz--sm" href="/blog/tags/grafana">grafana</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/03/29/crypto-volumes-julia-questdb"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Crypto Volume Profiles with QuestDB and Julia</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/03/14/mock-sql-timeseries-data-questdb"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How to generate time-series data in QuestDB »</div></a></div></nav></div></main></div></div><div class="root_0lLS"><div class="cards_xeZk"><div class="root_R798 skinPrimary_JHOH"><svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="38" cy="38" r="38" fill="#1E1F27"></circle><path d="M56.99 18.792a.817.817 0 00-.117-.303c-.01-.02-.02-.05-.03-.069-.01-.02-.029-.029-.048-.049a.912.912 0 00-.137-.136l-.117-.088c-.02-.01-.03-.03-.05-.04-.029-.01-.068-.029-.107-.039a.85.85 0 00-.146-.049 1.075 1.075 0 00-.176-.019h-.147a1.15 1.15 0 00-.196.049c-.029.01-.068.01-.097.02L12.59 36.67a.979.979 0 00-.509 1.29c.098.216.264.401.48.5l16.07 7.556v15.025c0 .537.44.977.978.977a.964.964 0 00.831-.469l6.794-11.046 10.499 5.533a.974.974 0 001.408-.655l7.84-36.2v-.058c.01-.058.01-.107.019-.156 0-.059 0-.117-.01-.176zM29.413 44.208L15.376 37.6l36.326-15.68-22.289 22.288zm1.174 13.363V47.004l4.917 2.59-4.917 7.977zm16.92-3.87l-9.237-4.86-1.662-1.026-.068.118-5.289-2.786 23.1-23.12L47.508 53.7z" fill="#fff"></path></svg><h3 class="title_BHe0">문의하기</h3><p class="description_Bwvi">이메일을 입력하시면 소개자료를 보내드립니다.</p><div class="content_gAr2"><form class="root_teCd"><div><div class="inputs_0wQ8"><input type="email" class="input_cjQx input_a6pP" name="email" required="" pattern="^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$" placeholder="Email address" title="Email address should be valid"><button class="submit_poRs button_f7Ff button--tertiary_vtfp button--uppercase_ESEN" type="submit">보내기</button></div></div></form></div></div></div></div></div><footer class="root_JnvJ"><div class="content_-gfC center_S24y"><img alt="QuestDB logo" class="logo_JrwJ" src="/img/navbar/tp_brand.png" width="108" height="27"><div class="tagline_T1tH"><p>인프라관리부터 서비스운영까지 클라우드환경에 최적화된 클라우드 네이티브 플랫폼</p></div><div class="links_1SgP"></div></div><div class="border_PW0V"><div class="bottom_wPs3 center_S24y">Copyright © 2023 Gitple. All rights are reserved.</div></div></footer></div>
<script src="/assets/js/main.185a1183.js" defer="defer"></script>
</body>
</html>